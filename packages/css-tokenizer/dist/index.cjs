"use strict";class Reader{cursor;stringSource="";codePointSource=[];length=0;representationStart=0;representationEnd=-1;peekedOne;peekedTwo;peekedThree;constructor(e){this.cursor=0,this.stringSource=e,this.length=e.length,this.codePointSource=new Array(this.length);for(let e=0;e<this.length;e++)this.codePointSource[e]=this.stringSource.charCodeAt(e);this.peekedOne=this.codePointSource[this.cursor],this.peekedTwo=this.codePointSource[this.cursor+1],this.peekedThree=this.codePointSource[this.cursor+2],this.peekedFour=this.codePointSource[this.cursor+3]}peekedFour;cursorPositionOfLastReadCodePoint(){return this.cursor-1}readCodePoint(e=1){const t=this.codePointSource[this.cursor];return void 0!==t&&(this.cursor+=e,this.representationEnd=this.cursor-1,this.peekedOne=this.codePointSource[this.cursor],this.peekedTwo=this.codePointSource[this.cursor+1],this.peekedThree=this.codePointSource[this.cursor+2],this.peekedFour=this.codePointSource[this.cursor+3],t)}unreadCodePoint(){return 0!==this.cursor&&(this.representationEnd=this.cursor-1,this.cursor-=1,this.peekedOne=this.codePointSource[this.cursor],this.peekedTwo=this.codePointSource[this.cursor+1],this.peekedThree=this.codePointSource[this.cursor+2],this.peekedFour=this.codePointSource[this.cursor+3],!0)}representationString(){return-1===this.representationEnd?"":this.stringSource.slice(this.representationStart,this.representationEnd+1)}resetRepresentation(){this.representationStart=this.cursor,this.representationEnd=-1}slice(e,t){return this.stringSource.slice(e,t)}}var e,t,n;exports.TokenType=void 0,(e=exports.TokenType||(exports.TokenType={})).Comment="comment",e.AtKeyword="at-keyword-token",e.BadString="bad-string-token",e.BadURL="bad-url-token",e.CDC="CDC-token",e.CDO="CDO-token",e.Colon="colon-token",e.Comma="comma-token",e.Delim="delim-token",e.Dimension="dimension-token",e.EOF="EOF-token",e.Function="function-token",e.Hash="hash-token",e.Ident="ident-token",e.Number="number-token",e.Percentage="percentage-token",e.Semicolon="semicolon-token",e.String="string-token",e.URL="url-token",e.Whitespace="whitespace-token",e.OpenParen="(-token",e.CloseParen=")-token",e.OpenSquare="[-token",e.CloseSquare="]-token",e.OpenCurly="{-token",e.CloseCurly="}-token",exports.NumberType=void 0,(t=exports.NumberType||(exports.NumberType={})).Integer="integer",t.Number="number",function(e){e.Unrestricted="unrestricted",e.ID="id"}(n||(n={}));const r="'".charCodeAt(0),o="*".charCodeAt(0),i="\b".charCodeAt(0),s="\r".charCodeAt(0),a="\t".charCodeAt(0),d=":".charCodeAt(0),p=",".charCodeAt(0),c="@".charCodeAt(0),u="".charCodeAt(0),C="!".charCodeAt(0),h="\f".charCodeAt(0),k=".".charCodeAt(0),T=">".charCodeAt(0),S="-".charCodeAt(0),l="".charCodeAt(0),m="E".charCodeAt(0),f="e".charCodeAt(0),P="{".charCodeAt(0),g="(".charCodeAt(0),O="[".charCodeAt(0),E="<".charCodeAt(0),A="\n".charCodeAt(0),x="\v".charCodeAt(0),y="_".charCodeAt(0),v="􏿿".charCodeAt(0),I="\0".charCodeAt(0),w="#".charCodeAt(0),D="%".charCodeAt(0),U="+".charCodeAt(0),N='"'.charCodeAt(0),b="�".charCodeAt(0),L="\\".charCodeAt(0),R="}".charCodeAt(0),F=")".charCodeAt(0),W="]".charCodeAt(0),q=";".charCodeAt(0),V="".charCodeAt(0),B="/".charCodeAt(0),H=" ".charCodeAt(0);function checkIfFourCodePointsWouldStartCDO(e,t){return t.peekedOne===E&&t.peekedTwo===C&&t.peekedThree===S&&t.peekedFour===S}const M="0".charCodeAt(0),z="9".charCodeAt(0);function isDigitCodePoint(e){return M<=e&&e<=z}const K="A".charCodeAt(0),J="Z".charCodeAt(0);function isUppercaseLetterCodePoint(e){return K<=e&&e<=J}const Q="a".charCodeAt(0),Z="z".charCodeAt(0);function isLowercaseLetterCodePoint(e){return Q<=e&&e<=Z}const $="F".charCodeAt(0),_="f".charCodeAt(0);function isHexDigitCodePoint(e){return!!isDigitCodePoint(e)||(K<=e&&e<=$||Q<=e&&e<=_)}function isLetterCodePoint(e){return!(!isUppercaseLetterCodePoint(e)&&!isLowercaseLetterCodePoint(e))}const j="".charCodeAt(0);function isNonASCIICodePoint(e){return e>=j}function isIdentStartCodePoint(e){return!!isLetterCodePoint(e)||(!!isNonASCIICodePoint(e)||e===y)}function isIdentCodePoint(e){return!!isIdentStartCodePoint(e)||(!!isDigitCodePoint(e)||e===S)}function isNewLine(e){switch(e){case A:case s:case h:return!0;default:return!1}}function isWhitespace(e){switch(e){case A:case s:case h:case a:case H:return!0;default:return!1}}const G="\ud800".charCodeAt(0),X="\udfff".charCodeAt(0);function checkIfTwoCodePointsAreAValidEscape(e,t){return t.peekedOne===L&&t.peekedTwo!==A}function checkIfThreeCodePointsWouldStartAnIdentSequence(e,t){return t.peekedOne===S?t.peekedTwo===S||(!!isIdentStartCodePoint(t.peekedTwo)||t.peekedTwo===L&&t.peekedThree!==A):!!isIdentStartCodePoint(t.peekedOne)||t.peekedOne===L&&checkIfTwoCodePointsAreAValidEscape(0,t)}function checkIfThreeCodePointsWouldStartANumber(e,t){return t.peekedOne===U||t.peekedOne===S?!!isDigitCodePoint(t.peekedTwo)||t.peekedTwo===k&&isDigitCodePoint(t.peekedThree):t.peekedOne===k?isDigitCodePoint(t.peekedTwo):!!isDigitCodePoint(t.peekedOne)}function checkIfTwoCodePointsStartAComment(e,t){return t.peekedOne===B&&t.peekedTwo===o}function checkIfThreeCodePointsWouldStartCDC(e,t){return t.peekedOne===S&&t.peekedTwo===S&&t.peekedThree===T}function consumeComment(e,t){for(t.readCodePoint(2);;){const n=t.readCodePoint();if(!1===n){e.onParseError({message:"Unexpected EOF while consuming a comment.",start:t.representationStart,end:t.representationEnd,state:["4.3.2. Consume comments","Unexpected EOF"]});break}if(n===o&&(void 0!==t.peekedOne&&t.peekedOne===B)){t.readCodePoint();break}}return[exports.TokenType.Comment,t.representationString(),t.representationStart,t.representationEnd,void 0]}function consumeEscapedCodePoint(e,t){const n=t.readCodePoint();if(!1===n)return e.onParseError({message:"Unexpected EOF while consuming an escaped code point.",start:t.representationStart,end:t.representationEnd,state:["4.3.7. Consume an escaped code point","Unexpected EOF"]}),b;if(isHexDigitCodePoint(n)){const e=[n];for(;void 0!==t.peekedOne&&isHexDigitCodePoint(t.peekedOne)&&e.length<6;)e.push(t.peekedOne),t.readCodePoint();isWhitespace(t.peekedOne)&&t.readCodePoint();const o=parseInt(String.fromCharCode(...e),16);return 0===o?b:G<=(r=o)&&r<=X||o>v?b:o}var r;return n}function consumeIdentSequence(e,t){const n=[];for(;;){if(void 0===t.peekedOne)return n;if(isIdentCodePoint(t.peekedOne))n.push(t.peekedOne),t.readCodePoint();else{if(t.peekedOne!==L||!checkIfTwoCodePointsAreAValidEscape(0,t))return n;t.readCodePoint(),n.push(consumeEscapedCodePoint(e,t))}}}function consumeHashToken(e,t){if(t.readCodePoint(),void 0!==t.peekedOne&&isIdentCodePoint(t.peekedOne)||checkIfTwoCodePointsAreAValidEscape(0,t)){let r=n.Unrestricted;checkIfThreeCodePointsWouldStartAnIdentSequence(0,t)&&(r=n.ID);const o=consumeIdentSequence(e,t);return[exports.TokenType.Hash,t.representationString(),t.representationStart,t.representationEnd,{value:String.fromCharCode(...o),type:r}]}return[exports.TokenType.Delim,t.representationString(),t.representationStart,t.representationEnd,{value:"#"}]}function consumeNumber(e,t){let n=exports.NumberType.Integer;const r=[];{t.peekedOne!==U&&t.peekedOne!==S||(r.push(t.peekedOne),t.readCodePoint());const e=consumeDigits(t);for(let t=0;t<e.length;t++)r.push(e[t])}if(t.peekedOne===k&&isDigitCodePoint(t.peekedTwo)){r.push(t.peekedOne),r.push(t.peekedTwo),t.readCodePoint(2),n=exports.NumberType.Number;const e=consumeDigits(t);for(let t=0;t<e.length;t++)r.push(e[t])}if((t.peekedOne===f||t.peekedOne===m)&&isDigitCodePoint(t.peekedTwo)){r.push(t.peekedOne),r.push(t.peekedTwo),t.readCodePoint(2),n=exports.NumberType.Number;const e=consumeDigits(t);for(let t=0;t<e.length;t++)r.push(e[t])}if((t.peekedOne===f||t.peekedOne===m)&&(t.peekedTwo===S||t.peekedTwo===U)&&isDigitCodePoint(t.peekedThree)){r.push(t.peekedOne),r.push(t.peekedTwo),r.push(t.peekedThree),t.readCodePoint(3),n=exports.NumberType.Number;const e=consumeDigits(t);for(let t=0;t<e.length;t++)r.push(e[t])}return[convertCodePointsToNumber(r),n]}function consumeDigits(e){const t=[];for(;;){if(void 0===e.peekedOne)return t;if(!isDigitCodePoint(e.peekedOne))return t;t.push(e.peekedOne),e.readCodePoint()}}function convertCodePointsToNumber(e){let t=1;const n=[];let r=0,o=0;const i=[];let s=0,a=1;const d=[];let p=0,c=0;for(e[c]===S?(c++,t=-1):e[c]===U&&c++;c<e.length&&isDigitCodePoint(e[c]);)n.push(e[c]),c++;for(r=digitCodePointsToInteger(n),e[c]===k&&c++;c<e.length&&isDigitCodePoint(e[c]);)i.push(e[c]),c++;for(o=i.length,s=digitCodePointsToInteger(i)/Math.pow(10,o),e[c]!==f&&e[c]!==m||c++,e[c]===S?(c++,a=-1):e[c]===U&&c++;c<e.length&&isDigitCodePoint(e[c]);)d.push(e[c]),c++;return p=digitCodePointsToInteger(d),t*(r+s)*Math.pow(10,a*p)}function digitCodePointsToInteger(e){if(0===e.length)return 0;const t=String.fromCharCode(...e),n=Number.parseInt(t,10);if(Number.isNaN(n))throw new Error(`Unexpected "NaN" result when parsing a number from digit code points: "${t}"`);return n}function consumeNumericToken(e,t){const n=consumeNumber(0,t);if(checkIfThreeCodePointsWouldStartAnIdentSequence(0,t)){const r=consumeIdentSequence(e,t);return[exports.TokenType.Dimension,t.representationString(),t.representationStart,t.representationEnd,{value:n[0],type:n[1],unit:String.fromCharCode(...r)}]}return t.peekedOne===D?(t.readCodePoint(),[exports.TokenType.Percentage,t.representationString(),t.representationStart,t.representationEnd,{value:n[0]}]):[exports.TokenType.Number,t.representationString(),t.representationStart,t.representationEnd,{value:n[0],type:n[1]}]}function consumeWhiteSpace(e,t,n=-1){let r=0;for(;;){if(-1!==n&&r===n)return[exports.TokenType.Whitespace,t.representationString(),t.representationStart,t.representationEnd,void 0];if(r++,void 0===t.peekedOne)return[exports.TokenType.Whitespace,t.representationString(),t.representationStart,t.representationEnd,void 0];if(!isWhitespace(t.peekedOne))break;t.readCodePoint()}return[exports.TokenType.Whitespace,t.representationString(),t.representationStart,t.representationEnd,void 0]}function consumeStringToken(e,t){let n="";const r=t.readCodePoint();if(!1===r)throw new Error("Unexpected EOF");for(;;){const o=t.readCodePoint();if(!1===o)return e.onParseError({message:"Unexpected EOF while consuming a string token.",start:t.representationStart,end:t.representationEnd,state:["4.3.5. Consume a string token","Unexpected EOF"]}),[exports.TokenType.String,t.representationString(),t.representationStart,t.representationEnd,{value:n}];if(isNewLine(o))return e.onParseError({message:"Unexpected newline while consuming a string token.",start:t.representationStart,end:t.representationEnd,state:["4.3.5. Consume a string token","Unexpected newline"]}),t.unreadCodePoint(),[exports.TokenType.BadString,t.representationString(),t.representationStart,t.representationEnd,void 0];if(o===r)return[exports.TokenType.String,t.representationString(),t.representationStart,t.representationEnd,{value:n}];if(o!==L)n+=String.fromCharCode(o);else{if(void 0===t.peekedOne)continue;if(isNewLine(t.peekedOne)){t.readCodePoint();continue}n+=String.fromCharCode(consumeEscapedCodePoint(e,t))}}}const Y="u".charCodeAt(0),ee="U".charCodeAt(0),te="r".charCodeAt(0),ne="R".charCodeAt(0),re="l".charCodeAt(0),oe="L".charCodeAt(0);function checkIfCodePointsMatchURLIdent(e,t){return 3===t.length&&((t[0]===Y||t[0]===ee)&&((t[1]===te||t[1]===ne)&&(t[2]===re||t[2]===oe)))}function consumeBadURL(e,t){for(;;){if(void 0===t.peekedOne)return;if(t.peekedOne===F)return void t.readCodePoint();checkIfTwoCodePointsAreAValidEscape(0,t)?(t.readCodePoint(),consumeEscapedCodePoint(e,t)):t.readCodePoint()}}function consumeUrlToken(e,t){consumeWhiteSpace(0,t);let n="";for(;;){if(void 0===t.peekedOne)return e.onParseError({message:"Unexpected EOF while consuming a url token.",start:t.representationStart,end:t.representationEnd,state:["4.3.6. Consume a url token","Unexpected EOF"]}),[exports.TokenType.URL,t.representationString(),t.representationStart,t.representationEnd,{value:n}];if(t.peekedOne===F)return t.readCodePoint(),[exports.TokenType.URL,t.representationString(),t.representationStart,t.representationEnd,{value:n}];if(isWhitespace(t.peekedOne))return consumeWhiteSpace(0,t),void 0===t.peekedOne?(e.onParseError({message:"Unexpected EOF while consuming a url token.",start:t.representationStart,end:t.representationEnd,state:["4.3.6. Consume a url token","Consume as much whitespace as possible","Unexpected EOF"]}),[exports.TokenType.URL,t.representationString(),t.representationStart,t.representationEnd,{value:n}]):t.peekedOne===F?(t.readCodePoint(),[exports.TokenType.URL,t.representationString(),t.representationStart,t.representationEnd,{value:n}]):(consumeBadURL(e,t),[exports.TokenType.BadURL,t.representationString(),t.representationStart,t.representationEnd,void 0]);if(t.peekedOne===N||t.peekedOne===r||t.peekedOne===g||((o=t.peekedOne)===x||o===u||I<=o&&o<=i||V<=o&&o<=l))return consumeBadURL(e,t),e.onParseError({message:"Unexpected character while consuming a url token.",start:t.representationStart,end:t.representationEnd,state:["4.3.6. Consume a url token","Unexpected U+0022 QUOTATION MARK (\"), U+0027 APOSTROPHE ('), U+0028 LEFT PARENTHESIS (() or non-printable code point"]}),[exports.TokenType.BadURL,t.representationString(),t.representationStart,t.representationEnd,void 0];if(t.peekedOne===L){if(checkIfTwoCodePointsAreAValidEscape(0,t)){n+=String.fromCharCode(consumeEscapedCodePoint(e,t));continue}return consumeBadURL(e,t),e.onParseError({message:"Invalid escape sequence while consuming a url token.",start:t.representationStart,end:t.representationEnd,state:["4.3.6. Consume a url token","U+005C REVERSE SOLIDUS (\\)","The input stream does not start with a valid escape sequence"]}),[exports.TokenType.BadURL,t.representationString(),t.representationStart,t.representationEnd,void 0]}n+=String.fromCharCode(t.peekedOne),t.readCodePoint()}var o}function consumeIdentLikeToken(e,t){const n=consumeIdentSequence(e,t);if(t.peekedOne===g){if(checkIfCodePointsMatchURLIdent(0,n)){t.readCodePoint();let o=0;for(;;){const e=isWhitespace(t.peekedOne),i=isWhitespace(t.peekedTwo);if(e&&i){o+=2,t.readCodePoint(2);continue}const s=e?t.peekedTwo:t.peekedOne;if(s===N||s===r){for(let e=0;e<o;e++)t.unreadCodePoint();return[exports.TokenType.Function,t.representationString(),t.representationStart,t.representationEnd,{value:String.fromCharCode(...n)}]}break}for(let e=0;e<o;e++)t.unreadCodePoint();return consumeUrlToken(e,t)}return t.readCodePoint(),[exports.TokenType.Function,t.representationString(),t.representationStart,t.representationEnd,{value:String.fromCharCode(...n)}]}return[exports.TokenType.Ident,t.representationString(),t.representationStart,t.representationEnd,{value:String.fromCharCode(...n)}]}exports.Reader=Reader,exports.cloneTokens=function cloneTokens(e){return"undefined"!=typeof globalThis&&"structuredClone"in globalThis?structuredClone(e):JSON.parse(JSON.stringify(e))},exports.isToken=function isToken(e){return!!Array.isArray(e)&&(!(e.length<4)&&(e[0]in exports.TokenType&&("string"==typeof e[1]&&("number"==typeof e[2]&&"number"==typeof e[3]))))},exports.mirrorVariantType=function mirrorVariantType(e){switch(e){case exports.TokenType.OpenParen:return exports.TokenType.CloseParen;case exports.TokenType.CloseParen:return exports.TokenType.OpenParen;case exports.TokenType.OpenCurly:return exports.TokenType.CloseCurly;case exports.TokenType.CloseCurly:return exports.TokenType.OpenCurly;case exports.TokenType.OpenSquare:return exports.TokenType.CloseSquare;case exports.TokenType.CloseSquare:return exports.TokenType.OpenSquare;default:return null}},exports.stringify=function stringify(...e){let t="";for(let n=0;n<e.length;n++)t+=e[n][1];return t},exports.tokenizer=function tokenizer(e,t){const n=e.css.valueOf(),o=new Reader(n),i={onParseError:(null==t?void 0:t.onParseError)??(()=>{})};return{nextToken:function nextToken(){if(o.resetRepresentation(),checkIfTwoCodePointsStartAComment(0,o)){if(null!=t&&t.commentsAreTokens)return consumeComment(i,o);consumeComment(i,o)}o.resetRepresentation();const e=o.peekedOne;if(void 0===e)return[exports.TokenType.EOF,"",-1,-1,void 0];switch(e){case p:return o.readCodePoint(),[exports.TokenType.Comma,o.representationString(),o.representationStart,o.representationEnd,void 0];case d:return o.readCodePoint(),[exports.TokenType.Colon,o.representationString(),o.representationStart,o.representationEnd,void 0];case q:return o.readCodePoint(),[exports.TokenType.Semicolon,o.representationString(),o.representationStart,o.representationEnd,void 0];case g:return o.readCodePoint(),[exports.TokenType.OpenParen,o.representationString(),o.representationStart,o.representationEnd,void 0];case F:return o.readCodePoint(),[exports.TokenType.CloseParen,o.representationString(),o.representationStart,o.representationEnd,void 0];case O:return o.readCodePoint(),[exports.TokenType.OpenSquare,o.representationString(),o.representationStart,o.representationEnd,void 0];case W:return o.readCodePoint(),[exports.TokenType.CloseSquare,o.representationString(),o.representationStart,o.representationEnd,void 0];case P:return o.readCodePoint(),[exports.TokenType.OpenCurly,o.representationString(),o.representationStart,o.representationEnd,void 0];case R:return o.readCodePoint(),[exports.TokenType.CloseCurly,o.representationString(),o.representationStart,o.representationEnd,void 0];case r:case N:return consumeStringToken(i,o);case w:return consumeHashToken(i,o);case U:case k:return checkIfThreeCodePointsWouldStartANumber(0,o)?consumeNumericToken(i,o):(o.readCodePoint(),[exports.TokenType.Delim,o.representationString(),o.representationStart,o.representationEnd,{value:String.fromCharCode(e)}]);case S:return checkIfThreeCodePointsWouldStartANumber(0,o)?consumeNumericToken(i,o):checkIfThreeCodePointsWouldStartCDC(0,o)?(o.readCodePoint(3),[exports.TokenType.CDC,o.representationString(),o.representationStart,o.representationEnd,void 0]):checkIfThreeCodePointsWouldStartAnIdentSequence(0,o)?consumeIdentLikeToken(i,o):(o.readCodePoint(),[exports.TokenType.Delim,o.representationString(),o.representationStart,o.representationEnd,{value:"-"}]);case E:return checkIfFourCodePointsWouldStartCDO(0,o)?(o.readCodePoint(4),[exports.TokenType.CDO,o.representationString(),o.representationStart,o.representationEnd,void 0]):(o.readCodePoint(),[exports.TokenType.Delim,o.representationString(),o.representationStart,o.representationEnd,{value:"<"}]);case c:if(o.readCodePoint(),checkIfThreeCodePointsWouldStartAnIdentSequence(0,o)){const e=consumeIdentSequence(i,o);return[exports.TokenType.AtKeyword,o.representationString(),o.representationStart,o.representationEnd,{value:String.fromCharCode(...e)}]}return[exports.TokenType.Delim,o.representationString(),o.representationStart,o.representationEnd,{value:"@"}];case L:return checkIfTwoCodePointsAreAValidEscape(0,o)?consumeIdentLikeToken(i,o):(o.readCodePoint(),i.onParseError({message:'Invalid escape sequence after "\\"',start:o.representationStart,end:o.representationEnd,state:["4.3.1. Consume a token","U+005C REVERSE SOLIDUS (\\)","The input stream does not start with a valid escape sequence"]}),[exports.TokenType.Delim,o.representationString(),o.representationStart,o.representationEnd,{value:"\\"}])}return isWhitespace(e)?consumeWhiteSpace(0,o):isDigitCodePoint(e)?consumeNumericToken(i,o):isIdentStartCodePoint(e)?consumeIdentLikeToken(i,o):(o.readCodePoint(),[exports.TokenType.Delim,o.representationString(),o.representationStart,o.representationEnd,{value:String.fromCharCode(e)}])},endOfFile:function endOfFile(){return void 0===o.peekedOne}}};
