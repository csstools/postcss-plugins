"use strict";class Reader{#e;#t="";#n=[];#o=0;#r=0;#i=-1;constructor(e){this.#e=0,this.#t=e,this.#o=e.length,this.#n=new Array(this.#o);for(let e=0;e<this.#o;e++)this.#n[e]=this.#t.charCodeAt(e)}cursorPositionOfLastReadCodePoint(){return this.#e-1}peekOneCodePoint(){const e=this.#n[this.#e];return void 0!==e&&e}peekTwoCodePoints(){const e=this.#n[this.#e];if(void 0===e)return[];const t=this.#n[this.#e+1];return void 0===t?[e]:[e,t]}peekThreeCodePoints(){const e=this.#n[this.#e];if(void 0===e)return[];const t=this.#n[this.#e+1];if(void 0===t)return[e];const n=this.#n[this.#e+2];return void 0===n?[e,t]:[e,t,n]}peekFourCodePoints(){const e=this.#n[this.#e];if(void 0===e)return[];const t=this.#n[this.#e+1];if(void 0===t)return[e];const n=this.#n[this.#e+2];if(void 0===n)return[e,t];const o=this.#n[this.#e+2];return void 0===o?[e,t,n]:[e,t,n,o]}readCodePoint(){const e=this.#n[this.#e];return void 0!==e&&(this.#i=this.#e,this.#e+=1,e)}unreadCodePoint(){return 0!==this.#e&&(this.#i=this.#e-1,this.#e-=1,!0)}representation(){return[this.#r,this.#i]}representationString(){const e=this.representation();return-1===e[1]?"":this.slice(e[0],e[1]+1)}resetRepresentation(){this.#r=this.#e,this.#i=-1}slice(e,t){return this.#t.slice(e,t)}}var e,t,n;exports.TokenType=void 0,(e=exports.TokenType||(exports.TokenType={})).Comment="comment",e.AtKeyword="at-keyword-token",e.BadString="bad-string-token",e.BadURL="bad-url-token",e.CDC="CDC-token",e.CDO="CDO-token",e.Colon="colon-token",e.Comma="comma-token",e.Delim="delim-token",e.Dimension="dimension-token",e.EOF="EOF-token",e.Function="function-token",e.Hash="hash-token",e.Ident="ident-token",e.Number="number-token",e.Percentage="percentage-token",e.Semicolon="semicolon-token",e.String="string-token",e.URL="url-token",e.Whitespace="whitespace-token",e.OpenParen="(-token",e.CloseParen=")-token",e.OpenSquare="[-token",e.CloseSquare="]-token",e.OpenCurly="{-token",e.CloseCurly="}-token",exports.NumberType=void 0,(t=exports.NumberType||(exports.NumberType={})).Integer="integer",t.Number="number",function(e){e.Unrestricted="unrestricted",e.ID="id"}(n||(n={}));const o="'".charCodeAt(0),r="*".charCodeAt(0),i="\b".charCodeAt(0),s="\r".charCodeAt(0),c="\t".charCodeAt(0),a=":".charCodeAt(0),d=",".charCodeAt(0),u="@".charCodeAt(0),p="".charCodeAt(0),C="!".charCodeAt(0),h="\f".charCodeAt(0),P=".".charCodeAt(0),T=">".charCodeAt(0),k="-".charCodeAt(0),f="".charCodeAt(0),l="E".charCodeAt(0),m="e".charCodeAt(0),g="{".charCodeAt(0),S="(".charCodeAt(0),A="[".charCodeAt(0),x="<".charCodeAt(0),y="\n".charCodeAt(0),I="\v".charCodeAt(0),v="_".charCodeAt(0),O="ô¿¿".charCodeAt(0),E="\0".charCodeAt(0),w="#".charCodeAt(0),D="%".charCodeAt(0),U="+".charCodeAt(0),N='"'.charCodeAt(0),b="ï¿½".charCodeAt(0),L="\\".charCodeAt(0),R="}".charCodeAt(0),W=")".charCodeAt(0),F="]".charCodeAt(0),q=";".charCodeAt(0),V="".charCodeAt(0),B="/".charCodeAt(0),H=" ".charCodeAt(0);function checkIfFourCodePointsWouldStartCDO(e,t){const n=t.peekFourCodePoints(),[o,r,i,s]=n;return o===x&&r===C&&i===k&&s===k}const M="0".charCodeAt(0),z="9".charCodeAt(0);function isDigitCodePoint(e){return M<=e&&e<=z}const K="A".charCodeAt(0),J="Z".charCodeAt(0);function isUppercaseLetterCodePoint(e){return K<=e&&e<=J}const Q="a".charCodeAt(0),Z="z".charCodeAt(0);function isLowercaseLetterCodePoint(e){return Q<=e&&e<=Z}const $="F".charCodeAt(0),_="f".charCodeAt(0);function isHexDigitCodePoint(e){return!!isDigitCodePoint(e)||(K<=e&&e<=$||Q<=e&&e<=_)}function isLetterCodePoint(e){return!(!isUppercaseLetterCodePoint(e)&&!isLowercaseLetterCodePoint(e))}const j="Â€".charCodeAt(0);function isNonASCIICodePoint(e){return e>=j}function isIdentStartCodePoint(e){return!!isLetterCodePoint(e)||(!!isNonASCIICodePoint(e)||e===v)}function isIdentCodePoint(e){return!!isIdentStartCodePoint(e)||(!!isDigitCodePoint(e)||e===k)}function isNewLine(e){switch(e){case y:case s:case h:return!0;default:return!1}}function isWhitespace(e){switch(e){case y:case s:case h:case c:case H:return!0;default:return!1}}const G="\ud800".charCodeAt(0),X="\udfff".charCodeAt(0);function checkIfTwoCodePointsAreAValidEscape(e,t){const n=t.peekTwoCodePoints();return n[0]===L&&n[1]!==y}function checkIfThreeCodePointsWouldStartAnIdentSequence(e,t){const n=t.peekThreeCodePoints(),[o,r,i]=n;return o===k?r===k||(!!isIdentStartCodePoint(r)||r===L&&i!==y):!!isIdentStartCodePoint(o)||o===L&&checkIfTwoCodePointsAreAValidEscape(0,t)}function checkIfThreeCodePointsWouldStartANumber(e,t){const n=t.peekThreeCodePoints(),[o,r,i]=n;return o===U||o===k?!!isDigitCodePoint(r)||r===P&&isDigitCodePoint(i):o===P?isDigitCodePoint(r):!!isDigitCodePoint(o)}function checkIfTwoCodePointsStartAComment(e,t){const n=t.peekTwoCodePoints();return n[0]===B&&n[1]===r}function checkIfThreeCodePointsWouldStartCDC(e,t){const n=t.peekThreeCodePoints(),[o,r,i]=n;return o===k&&r===k&&i===T}function consumeComment(e,t){for(t.readCodePoint(),t.readCodePoint();;){const n=t.readCodePoint();if(!1===n){const n=t.representation();e.onParseError({message:"Unexpected EOF while consuming a comment.",start:n[0],end:n[1],state:["4.3.2. Consume comments","Unexpected EOF"]});break}if(n!==r)continue;const o=t.peekOneCodePoint();if(!1!==o&&o===B){t.readCodePoint();break}}const n=t.representation();return[exports.TokenType.Comment,t.representationString(),n[0],n[1],void 0]}function codePointsToString(e){let t="";for(let n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t}function consumeEscapedCodePoint(e,t){const n=t.readCodePoint();if(!1===n){const n=t.representation();return e.onParseError({message:"Unexpected EOF while consuming an escaped code point.",start:n[0],end:n[1],state:["4.3.7. Consume an escaped code point","Unexpected EOF"]}),b}if(isHexDigitCodePoint(n)){const e=[n];let r=t.peekOneCodePoint();for(;!1!==r&&isHexDigitCodePoint(r)&&e.length<6;)t.readCodePoint(),e.push(r),r=t.peekOneCodePoint();!1!==r&&isWhitespace(r)&&t.readCodePoint();const i=parseInt(codePointsToString(e),16);return 0===i?b:G<=(o=i)&&o<=X||i>O?b:i}var o;return n}function consumeIdentSequence(e,t){const n=[];for(;;){const o=t.peekOneCodePoint();if(!1===o)return n;if(isIdentCodePoint(o))t.readCodePoint(),n.push(o);else{if(o!==L||!checkIfTwoCodePointsAreAValidEscape(0,t))return n;t.readCodePoint(),n.push(consumeEscapedCodePoint(e,t))}}}function consumeHashToken(e,t){t.readCodePoint();const o=t.peekOneCodePoint();if(!1!==o&&isIdentCodePoint(o)||checkIfTwoCodePointsAreAValidEscape(0,t)){let o=n.Unrestricted;checkIfThreeCodePointsWouldStartAnIdentSequence(0,t)&&(o=n.ID);const r=consumeIdentSequence(e,t),i=t.representation();return[exports.TokenType.Hash,t.representationString(),i[0],i[1],{value:codePointsToString(r),type:o}]}const r=t.representation();return[exports.TokenType.Delim,t.representationString(),r[0],r[1],{value:"#"}]}function consumeNumber(e,t){let n=exports.NumberType.Integer;const o=[];{const e=t.peekOneCodePoint();e!==U&&e!==k||(t.readCodePoint(),o.push(e));const n=consumeDigits(t);for(let e=0;e<n.length;e++)o.push(n[e])}{const e=t.peekTwoCodePoints();if(e[0]===P&&isDigitCodePoint(e[1])){t.readCodePoint(),t.readCodePoint(),o.push(e[0]),o.push(e[1]),n=exports.NumberType.Number;const r=consumeDigits(t);for(let e=0;e<r.length;e++)o.push(r[e])}}{const e=t.peekThreeCodePoints();if((e[0]===m||e[0]===l)&&isDigitCodePoint(e[1])){t.readCodePoint(),t.readCodePoint(),o.push(e[0]),o.push(e[1]),n=exports.NumberType.Number;const r=consumeDigits(t);for(let e=0;e<r.length;e++)o.push(r[e])}if((e[0]===m||e[0]===l)&&(e[1]===k||e[1]===U)&&isDigitCodePoint(e[2])){t.readCodePoint(),t.readCodePoint(),t.readCodePoint(),o.push(e[0]),o.push(e[1]),o.push(e[2]),n=exports.NumberType.Number;const r=consumeDigits(t);for(let e=0;e<r.length;e++)o.push(r[e])}}return[convertCodePointsToNumber(o),n]}function consumeDigits(e){const t=[];for(;;){const n=e.peekOneCodePoint();if(!1===n)return t;if(!isDigitCodePoint(n))return t;t.push(n),e.readCodePoint()}}function convertCodePointsToNumber(e){let t=1;const n=[];let o=0,r=0;const i=[];let s=0,c=1;const a=[];let d=0,u=0;for(e[u]===k?(u++,t=-1):e[u]===U&&u++;u<e.length&&isDigitCodePoint(e[u]);)n.push(e[u]),u++;for(o=digitCodePointsToInteger(n),e[u]===P&&u++;u<e.length&&isDigitCodePoint(e[u]);)i.push(e[u]),u++;for(r=i.length,s=digitCodePointsToInteger(i)/Math.pow(10,r),e[u]!==m&&e[u]!==l||u++,e[u]===k?(u++,c=-1):e[u]===U&&u++;u<e.length&&isDigitCodePoint(e[u]);)a.push(e[u]),u++;return d=digitCodePointsToInteger(a),t*(o+s)*Math.pow(10,c*d)}function digitCodePointsToInteger(e){if(0===e.length)return 0;const t=codePointsToString(e),n=Number.parseInt(t,10);if(Number.isNaN(n))throw new Error(`Unexpected "NaN" result when parsing a number from digit code points: "${t}"`);return n}function consumeNumericToken(e,t){const n=consumeNumber(0,t);if(checkIfThreeCodePointsWouldStartAnIdentSequence(0,t)){const o=consumeIdentSequence(e,t),r=t.representation();return[exports.TokenType.Dimension,t.representationString(),r[0],r[1],{value:n[0],type:n[1],unit:codePointsToString(o)}]}if(t.peekOneCodePoint()===D){t.readCodePoint();const e=t.representation();return[exports.TokenType.Percentage,t.representationString(),e[0],e[1],{value:n[0]}]}const o=t.representation();return[exports.TokenType.Number,t.representationString(),o[0],o[1],{value:n[0],type:n[1]}]}function consumeWhiteSpace(e,t,n=-1){let o=0;for(;;){if(-1!==n&&o===n){const e=t.representation();return[exports.TokenType.Whitespace,t.representationString(),e[0],e[1],void 0]}o++;const e=t.peekOneCodePoint();if(!1===e){const e=t.representation();return[exports.TokenType.Whitespace,t.representationString(),e[0],e[1],void 0]}if(!isWhitespace(e))break;t.readCodePoint()}const r=t.representation();return[exports.TokenType.Whitespace,t.representationString(),r[0],r[1],void 0]}function consumeStringToken(e,t){let n="";const o=t.readCodePoint();if(!1===o)throw new Error("Unexpected EOF");for(;;){const r=t.readCodePoint();if(!1===r){const o=t.representation();return e.onParseError({message:"Unexpected EOF while consuming a string token.",start:o[0],end:o[1],state:["4.3.5. Consume a string token","Unexpected EOF"]}),[exports.TokenType.String,t.representationString(),o[0],o[1],{value:n}]}if(isNewLine(r)){const n=t.representation();return e.onParseError({message:"Unexpected newline while consuming a string token.",start:n[0],end:n[1],state:["4.3.5. Consume a string token","Unexpected newline"]}),t.unreadCodePoint(),[exports.TokenType.BadString,t.representationString(),n[0],n[1],void 0]}if(r===o){const e=t.representation();return[exports.TokenType.String,t.representationString(),e[0],e[1],{value:n}]}if(r!==L)n+=String.fromCharCode(r);else{const o=t.peekOneCodePoint();if(!1===o)continue;if(isNewLine(o)){t.readCodePoint();continue}n+=String.fromCharCode(consumeEscapedCodePoint(e,t))}}}const Y="u".charCodeAt(0),ee="U".charCodeAt(0),te="r".charCodeAt(0),ne="R".charCodeAt(0),oe="l".charCodeAt(0),re="L".charCodeAt(0);function checkIfCodePointsMatchURLIdent(e,t){return 3===t.length&&((t[0]===Y||t[0]===ee)&&((t[1]===te||t[1]===ne)&&(t[2]===oe||t[2]===re)))}function consumeBadURL(e,t){for(;;){const n=t.peekOneCodePoint();if(!1===n)return;if(n===W)return void t.readCodePoint();checkIfTwoCodePointsAreAValidEscape(0,t)?(t.readCodePoint(),consumeEscapedCodePoint(e,t)):t.readCodePoint()}}function consumeUrlToken(e,t){consumeWhiteSpace(0,t);let n="";for(;;){const s=t.peekOneCodePoint();if(!1===s){const o=t.representation();return e.onParseError({message:"Unexpected EOF while consuming a url token.",start:o[0],end:o[1],state:["4.3.6. Consume a url token","Unexpected EOF"]}),[exports.TokenType.URL,t.representationString(),o[0],o[1],{value:n}]}if(s===W){t.readCodePoint();const e=t.representation();return[exports.TokenType.URL,t.representationString(),e[0],e[1],{value:n}]}if(isWhitespace(s)){consumeWhiteSpace(0,t);const o=t.peekOneCodePoint();if(!1===o){const o=t.representation();return e.onParseError({message:"Unexpected EOF while consuming a url token.",start:o[0],end:o[1],state:["4.3.6. Consume a url token","Consume as much whitespace as possible","Unexpected EOF"]}),[exports.TokenType.URL,t.representationString(),o[0],o[1],{value:n}]}if(o===W){t.readCodePoint();const e=t.representation();return[exports.TokenType.URL,t.representationString(),e[0],e[1],{value:n}]}consumeBadURL(e,t);const r=t.representation();return[exports.TokenType.BadURL,t.representationString(),r[0],r[1],void 0]}if(s===N||s===o||s===S||((r=s)===I||r===p||E<=r&&r<=i||V<=r&&r<=f)){consumeBadURL(e,t);const n=t.representation();return e.onParseError({message:"Unexpected character while consuming a url token.",start:n[0],end:n[1],state:["4.3.6. Consume a url token","Unexpected U+0022 QUOTATION MARK (\"), U+0027 APOSTROPHE ('), U+0028 LEFT PARENTHESIS (() or non-printable code point"]}),[exports.TokenType.BadURL,t.representationString(),n[0],n[1],void 0]}if(s===L){if(checkIfTwoCodePointsAreAValidEscape(0,t)){n+=String.fromCharCode(consumeEscapedCodePoint(e,t));continue}consumeBadURL(e,t);const o=t.representation();return e.onParseError({message:"Invalid escape sequence while consuming a url token.",start:o[0],end:o[1],state:["4.3.6. Consume a url token","U+005C REVERSE SOLIDUS (\\)","The input stream does not start with a valid escape sequence"]}),[exports.TokenType.BadURL,t.representationString(),o[0],o[1],void 0]}t.readCodePoint(),n+=String.fromCharCode(s)}var r}function consumeIdentLikeToken(e,t){const n=consumeIdentSequence(e,t);if(t.peekOneCodePoint()===S){if(checkIfCodePointsMatchURLIdent(0,n)){t.readCodePoint();let r=0;for(;;){const e=t.peekTwoCodePoints(),i=isWhitespace(e[0]),s=isWhitespace(e[1]);if(i&&s){r+=2,t.readCodePoint(),t.readCodePoint();continue}const c=i?e[1]:e[0];if(c===N||c===o){for(let e=0;e<r;e++)t.unreadCodePoint();const e=t.representation();return[exports.TokenType.Function,t.representationString(),e[0],e[1],{value:codePointsToString(n)}]}break}for(let e=0;e<r;e++)t.unreadCodePoint();return consumeUrlToken(e,t)}t.readCodePoint();const r=t.representation();return[exports.TokenType.Function,t.representationString(),r[0],r[1],{value:codePointsToString(n)}]}const r=t.representation();return[exports.TokenType.Ident,t.representationString(),r[0],r[1],{value:codePointsToString(n)}]}exports.Reader=Reader,exports.cloneTokens=function cloneTokens(e){return"undefined"!=typeof globalThis&&"structuredClone"in globalThis?structuredClone(e):JSON.parse(JSON.stringify(e))},exports.isToken=function isToken(e){return!!Array.isArray(e)&&(!(e.length<4)&&(e[0]in exports.TokenType&&("string"==typeof e[1]&&("number"==typeof e[2]&&"number"==typeof e[3]))))},exports.mirrorVariantType=function mirrorVariantType(e){switch(e){case exports.TokenType.OpenParen:return exports.TokenType.CloseParen;case exports.TokenType.CloseParen:return exports.TokenType.OpenParen;case exports.TokenType.OpenCurly:return exports.TokenType.CloseCurly;case exports.TokenType.CloseCurly:return exports.TokenType.OpenCurly;case exports.TokenType.OpenSquare:return exports.TokenType.CloseSquare;case exports.TokenType.CloseSquare:return exports.TokenType.OpenSquare;default:return null}},exports.stringify=function stringify(...e){let t="";for(let n=0;n<e.length;n++)t+=e[n][1];return t},exports.tokenizer=function tokenizer(e,t){const n=e.css.valueOf(),r=new Reader(n),i={onParseError:(null==t?void 0:t.onParseError)??(()=>{})};return{nextToken:function nextToken(){if(r.resetRepresentation(),checkIfTwoCodePointsStartAComment(0,r)){if(null!=t&&t.commentsAreTokens)return consumeComment(i,r);consumeComment(i,r)}r.resetRepresentation();const e=r.peekOneCodePoint();if(!1===e)return[exports.TokenType.EOF,"",-1,-1,void 0];switch(e){case d:{r.readCodePoint();const e=r.representation();return[exports.TokenType.Comma,r.representationString(),e[0],e[1],void 0]}case a:{r.readCodePoint();const e=r.representation();return[exports.TokenType.Colon,r.representationString(),e[0],e[1],void 0]}case q:{r.readCodePoint();const e=r.representation();return[exports.TokenType.Semicolon,r.representationString(),e[0],e[1],void 0]}case S:{r.readCodePoint();const e=r.representation();return[exports.TokenType.OpenParen,r.representationString(),e[0],e[1],void 0]}case W:{r.readCodePoint();const e=r.representation();return[exports.TokenType.CloseParen,r.representationString(),e[0],e[1],void 0]}case A:{r.readCodePoint();const e=r.representation();return[exports.TokenType.OpenSquare,r.representationString(),e[0],e[1],void 0]}case F:{r.readCodePoint();const e=r.representation();return[exports.TokenType.CloseSquare,r.representationString(),e[0],e[1],void 0]}case g:{r.readCodePoint();const e=r.representation();return[exports.TokenType.OpenCurly,r.representationString(),e[0],e[1],void 0]}case R:{r.readCodePoint();const e=r.representation();return[exports.TokenType.CloseCurly,r.representationString(),e[0],e[1],void 0]}}switch(e){case o:case N:return consumeStringToken(i,r);case w:return consumeHashToken(i,r);case U:case P:{if(checkIfThreeCodePointsWouldStartANumber(0,r))return consumeNumericToken(i,r);r.readCodePoint();const t=r.representation();return[exports.TokenType.Delim,r.representationString(),t[0],t[1],{value:String.fromCharCode(e)}]}case k:{if(checkIfThreeCodePointsWouldStartANumber(0,r))return consumeNumericToken(i,r);if(checkIfThreeCodePointsWouldStartCDC(0,r)){r.readCodePoint(),r.readCodePoint(),r.readCodePoint();const e=r.representation();return[exports.TokenType.CDC,r.representationString(),e[0],e[1],void 0]}if(checkIfThreeCodePointsWouldStartAnIdentSequence(0,r))return consumeIdentLikeToken(i,r);r.readCodePoint();const e=r.representation();return[exports.TokenType.Delim,r.representationString(),e[0],e[1],{value:"-"}]}case x:{if(checkIfFourCodePointsWouldStartCDO(0,r)){r.readCodePoint(),r.readCodePoint(),r.readCodePoint(),r.readCodePoint();const e=r.representation();return[exports.TokenType.CDO,r.representationString(),e[0],e[1],void 0]}r.readCodePoint();const e=r.representation();return[exports.TokenType.Delim,r.representationString(),e[0],e[1],{value:"<"}]}case u:{if(r.readCodePoint(),checkIfThreeCodePointsWouldStartAnIdentSequence(0,r)){const e=consumeIdentSequence(i,r),t=r.representation();return[exports.TokenType.AtKeyword,r.representationString(),t[0],t[1],{value:codePointsToString(e)}]}const e=r.representation();return[exports.TokenType.Delim,r.representationString(),e[0],e[1],{value:"@"}]}case L:{if(checkIfTwoCodePointsAreAValidEscape(0,r))return consumeIdentLikeToken(i,r);r.readCodePoint();const e=r.representation();return i.onParseError({message:'Invalid escape sequence after "\\"',start:e[0],end:e[1],state:["4.3.1. Consume a token","U+005C REVERSE SOLIDUS (\\)","The input stream does not start with a valid escape sequence"]}),[exports.TokenType.Delim,r.representationString(),e[0],e[1],{value:"\\"}]}}if(isWhitespace(e))return consumeWhiteSpace(0,r);if(isDigitCodePoint(e))return consumeNumericToken(i,r);if(isIdentStartCodePoint(e))return consumeIdentLikeToken(i,r);r.readCodePoint();const n=r.representation();return[exports.TokenType.Delim,r.representationString(),n[0],n[1],{value:String.fromCharCode(e)}]},endOfFile:function endOfFile(){return!1===r.peekOneCodePoint()}}};
