class Reader{#e;#t="";#n=[];#o=0;#r=0;#i=-1;constructor(e){this.#e=0,this.#t=e,this.#o=e.length,this.#n=new Array(this.#o);for(let e=0;e<this.#o;e++)this.#n[e]=this.#t.charCodeAt(e)}cursorPositionOfLastReadCodePoint(){return this.#e-1}peekOneCodePoint(){const e=this.#n[this.#e];return void 0!==e&&e}peekTwoCodePoints(){const e=this.#n[this.#e];if(void 0===e)return[];const t=this.#n[this.#e+1];return void 0===t?[e]:[e,t]}peekThreeCodePoints(){const e=this.#n[this.#e];if(void 0===e)return[];const t=this.#n[this.#e+1];if(void 0===t)return[e];const n=this.#n[this.#e+2];return void 0===n?[e,t]:[e,t,n]}peekFourCodePoints(){const e=this.#n[this.#e];if(void 0===e)return[];const t=this.#n[this.#e+1];if(void 0===t)return[e];const n=this.#n[this.#e+2];if(void 0===n)return[e,t];const o=this.#n[this.#e+2];return void 0===o?[e,t,n]:[e,t,n,o]}readCodePoint(){const e=this.#n[this.#e];return void 0!==e&&(this.#i=this.#e,this.#e+=1,e)}unreadCodePoint(){return 0!==this.#e&&(this.#i=this.#e-1,this.#e-=1,!0)}representation(){return[this.#r,this.#i]}representationString(){const e=this.representation();return-1===e[1]?"":this.slice(e[0],e[1]+1)}resetRepresentation(){this.#r=this.#e,this.#i=-1}slice(e,t){return this.#t.slice(e,t)}}var e,t,n;function mirrorVariantType(t){switch(t){case e.OpenParen:return e.CloseParen;case e.CloseParen:return e.OpenParen;case e.OpenCurly:return e.CloseCurly;case e.CloseCurly:return e.OpenCurly;case e.OpenSquare:return e.CloseSquare;case e.CloseSquare:return e.OpenSquare;default:return null}}function isToken(t){return!!Array.isArray(t)&&(!(t.length<4)&&(t[0]in e&&("string"==typeof t[1]&&("number"==typeof t[2]&&"number"==typeof t[3]))))}function stringify(...e){let t="";for(let n=0;n<e.length;n++)t+=e[n][1];return t}!function(e){e.Comment="comment",e.AtKeyword="at-keyword-token",e.BadString="bad-string-token",e.BadURL="bad-url-token",e.CDC="CDC-token",e.CDO="CDO-token",e.Colon="colon-token",e.Comma="comma-token",e.Delim="delim-token",e.Dimension="dimension-token",e.EOF="EOF-token",e.Function="function-token",e.Hash="hash-token",e.Ident="ident-token",e.Number="number-token",e.Percentage="percentage-token",e.Semicolon="semicolon-token",e.String="string-token",e.URL="url-token",e.Whitespace="whitespace-token",e.OpenParen="(-token",e.CloseParen=")-token",e.OpenSquare="[-token",e.CloseSquare="]-token",e.OpenCurly="{-token",e.CloseCurly="}-token"}(e||(e={})),function(e){e.Integer="integer",e.Number="number"}(t||(t={})),function(e){e.Unrestricted="unrestricted",e.ID="id"}(n||(n={}));const o="'".charCodeAt(0),r="*".charCodeAt(0),i="\b".charCodeAt(0),s="\r".charCodeAt(0),c="\t".charCodeAt(0),a=":".charCodeAt(0),d=",".charCodeAt(0),u="@".charCodeAt(0),C="".charCodeAt(0),h="!".charCodeAt(0),p="\f".charCodeAt(0),P=".".charCodeAt(0),f=">".charCodeAt(0),l="-".charCodeAt(0),g="".charCodeAt(0),m="E".charCodeAt(0),S="e".charCodeAt(0),k="{".charCodeAt(0),A="(".charCodeAt(0),T="[".charCodeAt(0),I="<".charCodeAt(0),v="\n".charCodeAt(0),O="\v".charCodeAt(0),E="_".charCodeAt(0),w="􏿿".charCodeAt(0),D="\0".charCodeAt(0),U="#".charCodeAt(0),L="%".charCodeAt(0),N="+".charCodeAt(0),b='"'.charCodeAt(0),R="�".charCodeAt(0),W="\\".charCodeAt(0),y="}".charCodeAt(0),F=")".charCodeAt(0),q="]".charCodeAt(0),x=";".charCodeAt(0),V="".charCodeAt(0),B="/".charCodeAt(0),H=" ".charCodeAt(0);function checkIfFourCodePointsWouldStartCDO(e,t){const n=t.peekFourCodePoints(),[o,r,i,s]=n;return o===I&&r===h&&i===l&&s===l}const M="0".charCodeAt(0),z="9".charCodeAt(0);function isDigitCodePoint(e){return M<=e&&e<=z}const K="A".charCodeAt(0),J="Z".charCodeAt(0);function isUppercaseLetterCodePoint(e){return K<=e&&e<=J}const Q="a".charCodeAt(0),Z="z".charCodeAt(0);function isLowercaseLetterCodePoint(e){return Q<=e&&e<=Z}const $="F".charCodeAt(0),_="f".charCodeAt(0);function isHexDigitCodePoint(e){return!!isDigitCodePoint(e)||(K<=e&&e<=$||Q<=e&&e<=_)}function isLetterCodePoint(e){return!(!isUppercaseLetterCodePoint(e)&&!isLowercaseLetterCodePoint(e))}const j="".charCodeAt(0);function isNonASCIICodePoint(e){return e>=j}function isIdentStartCodePoint(e){return!!isLetterCodePoint(e)||(!!isNonASCIICodePoint(e)||e===E)}function isIdentCodePoint(e){return!!isIdentStartCodePoint(e)||(!!isDigitCodePoint(e)||e===l)}function isNewLine(e){switch(e){case v:case s:case p:return!0;default:return!1}}function isWhitespace(e){switch(e){case v:case s:case p:case c:case H:return!0;default:return!1}}const G="\ud800".charCodeAt(0),X="\udfff".charCodeAt(0);function checkIfTwoCodePointsAreAValidEscape(e,t){const n=t.peekTwoCodePoints();return n[0]===W&&n[1]!==v}function checkIfThreeCodePointsWouldStartAnIdentSequence(e,t){const n=t.peekThreeCodePoints(),[o,r,i]=n;return o===l?r===l||(!!isIdentStartCodePoint(r)||r===W&&i!==v):!!isIdentStartCodePoint(o)||o===W&&checkIfTwoCodePointsAreAValidEscape(0,t)}function checkIfThreeCodePointsWouldStartANumber(e,t){const n=t.peekThreeCodePoints(),[o,r,i]=n;return o===N||o===l?!!isDigitCodePoint(r)||r===P&&isDigitCodePoint(i):o===P?isDigitCodePoint(r):!!isDigitCodePoint(o)}function checkIfTwoCodePointsStartAComment(e,t){const n=t.peekTwoCodePoints();return n[0]===B&&n[1]===r}function checkIfThreeCodePointsWouldStartCDC(e,t){const n=t.peekThreeCodePoints(),[o,r,i]=n;return o===l&&r===l&&i===f}function consumeComment(t,n){for(n.readCodePoint(),n.readCodePoint();;){const e=n.readCodePoint();if(!1===e){const e=n.representation();t.onParseError({message:"Unexpected EOF while consuming a comment.",start:e[0],end:e[1],state:["4.3.2. Consume comments","Unexpected EOF"]});break}if(e!==r)continue;const o=n.peekOneCodePoint();if(!1!==o&&o===B){n.readCodePoint();break}}const o=n.representation();return[e.Comment,n.representationString(),o[0],o[1],void 0]}function codePointsToString(e){let t="";for(let n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t}function consumeEscapedCodePoint(e,t){const n=t.readCodePoint();if(!1===n){const n=t.representation();return e.onParseError({message:"Unexpected EOF while consuming an escaped code point.",start:n[0],end:n[1],state:["4.3.7. Consume an escaped code point","Unexpected EOF"]}),R}if(isHexDigitCodePoint(n)){const e=[n];let r=t.peekOneCodePoint();for(;!1!==r&&isHexDigitCodePoint(r)&&e.length<6;)t.readCodePoint(),e.push(r),r=t.peekOneCodePoint();!1!==r&&isWhitespace(r)&&t.readCodePoint();const i=parseInt(codePointsToString(e),16);return 0===i?R:G<=(o=i)&&o<=X||i>w?R:i}var o;return n}function consumeIdentSequence(e,t){const n=[];for(;;){const o=t.peekOneCodePoint();if(!1===o)return n;if(isIdentCodePoint(o))t.readCodePoint(),n.push(o);else{if(o!==W||!checkIfTwoCodePointsAreAValidEscape(0,t))return n;t.readCodePoint(),n.push(consumeEscapedCodePoint(e,t))}}}function consumeHashToken(t,o){o.readCodePoint();const r=o.peekOneCodePoint();if(!1!==r&&isIdentCodePoint(r)||checkIfTwoCodePointsAreAValidEscape(0,o)){let r=n.Unrestricted;checkIfThreeCodePointsWouldStartAnIdentSequence(0,o)&&(r=n.ID);const i=consumeIdentSequence(t,o),s=o.representation();return[e.Hash,o.representationString(),s[0],s[1],{value:codePointsToString(i),type:r}]}const i=o.representation();return[e.Delim,o.representationString(),i[0],i[1],{value:"#"}]}function consumeNumber(e,n){let o=t.Integer;const r=[];{const e=n.peekOneCodePoint();e!==N&&e!==l||(n.readCodePoint(),r.push(e));const t=consumeDigits(n);for(let e=0;e<t.length;e++)r.push(t[e])}{const e=n.peekTwoCodePoints();if(e[0]===P&&isDigitCodePoint(e[1])){n.readCodePoint(),n.readCodePoint(),r.push(e[0]),r.push(e[1]),o=t.Number;const i=consumeDigits(n);for(let e=0;e<i.length;e++)r.push(i[e])}}{const e=n.peekThreeCodePoints();if((e[0]===S||e[0]===m)&&isDigitCodePoint(e[1])){n.readCodePoint(),n.readCodePoint(),r.push(e[0]),r.push(e[1]),o=t.Number;const i=consumeDigits(n);for(let e=0;e<i.length;e++)r.push(i[e])}if((e[0]===S||e[0]===m)&&(e[1]===l||e[1]===N)&&isDigitCodePoint(e[2])){n.readCodePoint(),n.readCodePoint(),n.readCodePoint(),r.push(e[0]),r.push(e[1]),r.push(e[2]),o=t.Number;const i=consumeDigits(n);for(let e=0;e<i.length;e++)r.push(i[e])}}return[convertCodePointsToNumber(r),o]}function consumeDigits(e){const t=[];for(;;){const n=e.peekOneCodePoint();if(!1===n)return t;if(!isDigitCodePoint(n))return t;t.push(n),e.readCodePoint()}}function convertCodePointsToNumber(e){let t=1;const n=[];let o=0,r=0;const i=[];let s=0,c=1;const a=[];let d=0,u=0;for(e[u]===l?(u++,t=-1):e[u]===N&&u++;u<e.length&&isDigitCodePoint(e[u]);)n.push(e[u]),u++;for(o=digitCodePointsToInteger(n),e[u]===P&&u++;u<e.length&&isDigitCodePoint(e[u]);)i.push(e[u]),u++;for(r=i.length,s=digitCodePointsToInteger(i)/Math.pow(10,r),e[u]!==S&&e[u]!==m||u++,e[u]===l?(u++,c=-1):e[u]===N&&u++;u<e.length&&isDigitCodePoint(e[u]);)a.push(e[u]),u++;return d=digitCodePointsToInteger(a),t*(o+s)*Math.pow(10,c*d)}function digitCodePointsToInteger(e){if(0===e.length)return 0;const t=codePointsToString(e),n=Number.parseInt(t,10);if(Number.isNaN(n))throw new Error(`Unexpected "NaN" result when parsing a number from digit code points: "${t}"`);return n}function consumeNumericToken(t,n){const o=consumeNumber(0,n);if(checkIfThreeCodePointsWouldStartAnIdentSequence(0,n)){const r=consumeIdentSequence(t,n),i=n.representation();return[e.Dimension,n.representationString(),i[0],i[1],{value:o[0],type:o[1],unit:codePointsToString(r)}]}if(n.peekOneCodePoint()===L){n.readCodePoint();const t=n.representation();return[e.Percentage,n.representationString(),t[0],t[1],{value:o[0]}]}const r=n.representation();return[e.Number,n.representationString(),r[0],r[1],{value:o[0],type:o[1]}]}function consumeWhiteSpace(t,n,o=-1){let r=0;for(;;){if(-1!==o&&r===o){const t=n.representation();return[e.Whitespace,n.representationString(),t[0],t[1],void 0]}r++;const t=n.peekOneCodePoint();if(!1===t){const t=n.representation();return[e.Whitespace,n.representationString(),t[0],t[1],void 0]}if(!isWhitespace(t))break;n.readCodePoint()}const i=n.representation();return[e.Whitespace,n.representationString(),i[0],i[1],void 0]}function consumeStringToken(t,n){let o="";const r=n.readCodePoint();if(!1===r)throw new Error("Unexpected EOF");for(;;){const i=n.readCodePoint();if(!1===i){const r=n.representation();return t.onParseError({message:"Unexpected EOF while consuming a string token.",start:r[0],end:r[1],state:["4.3.5. Consume a string token","Unexpected EOF"]}),[e.String,n.representationString(),r[0],r[1],{value:o}]}if(isNewLine(i)){const o=n.representation();return t.onParseError({message:"Unexpected newline while consuming a string token.",start:o[0],end:o[1],state:["4.3.5. Consume a string token","Unexpected newline"]}),n.unreadCodePoint(),[e.BadString,n.representationString(),o[0],o[1],void 0]}if(i===r){const t=n.representation();return[e.String,n.representationString(),t[0],t[1],{value:o}]}if(i!==W)o+=String.fromCharCode(i);else{const e=n.peekOneCodePoint();if(!1===e)continue;if(isNewLine(e)){n.readCodePoint();continue}o+=String.fromCharCode(consumeEscapedCodePoint(t,n))}}}const Y="u".charCodeAt(0),ee="U".charCodeAt(0),te="r".charCodeAt(0),ne="R".charCodeAt(0),oe="l".charCodeAt(0),re="L".charCodeAt(0);function checkIfCodePointsMatchURLIdent(e,t){return 3===t.length&&((t[0]===Y||t[0]===ee)&&((t[1]===te||t[1]===ne)&&(t[2]===oe||t[2]===re)))}function consumeBadURL(e,t){for(;;){const n=t.peekOneCodePoint();if(!1===n)return;if(n===F)return void t.readCodePoint();checkIfTwoCodePointsAreAValidEscape(0,t)?(t.readCodePoint(),consumeEscapedCodePoint(e,t)):t.readCodePoint()}}function consumeUrlToken(t,n){consumeWhiteSpace(0,n);let r="";for(;;){const c=n.peekOneCodePoint();if(!1===c){const o=n.representation();return t.onParseError({message:"Unexpected EOF while consuming a url token.",start:o[0],end:o[1],state:["4.3.6. Consume a url token","Unexpected EOF"]}),[e.URL,n.representationString(),o[0],o[1],{value:r}]}if(c===F){n.readCodePoint();const t=n.representation();return[e.URL,n.representationString(),t[0],t[1],{value:r}]}if(isWhitespace(c)){consumeWhiteSpace(0,n);const o=n.peekOneCodePoint();if(!1===o){const o=n.representation();return t.onParseError({message:"Unexpected EOF while consuming a url token.",start:o[0],end:o[1],state:["4.3.6. Consume a url token","Consume as much whitespace as possible","Unexpected EOF"]}),[e.URL,n.representationString(),o[0],o[1],{value:r}]}if(o===F){n.readCodePoint();const t=n.representation();return[e.URL,n.representationString(),t[0],t[1],{value:r}]}consumeBadURL(t,n);const i=n.representation();return[e.BadURL,n.representationString(),i[0],i[1],void 0]}if(c===b||c===o||c===A||((s=c)===O||s===C||D<=s&&s<=i||V<=s&&s<=g)){consumeBadURL(t,n);const o=n.representation();return t.onParseError({message:"Unexpected character while consuming a url token.",start:o[0],end:o[1],state:["4.3.6. Consume a url token","Unexpected U+0022 QUOTATION MARK (\"), U+0027 APOSTROPHE ('), U+0028 LEFT PARENTHESIS (() or non-printable code point"]}),[e.BadURL,n.representationString(),o[0],o[1],void 0]}if(c===W){if(checkIfTwoCodePointsAreAValidEscape(0,n)){r+=String.fromCharCode(consumeEscapedCodePoint(t,n));continue}consumeBadURL(t,n);const o=n.representation();return t.onParseError({message:"Invalid escape sequence while consuming a url token.",start:o[0],end:o[1],state:["4.3.6. Consume a url token","U+005C REVERSE SOLIDUS (\\)","The input stream does not start with a valid escape sequence"]}),[e.BadURL,n.representationString(),o[0],o[1],void 0]}n.readCodePoint(),r+=String.fromCharCode(c)}var s}function consumeIdentLikeToken(t,n){const r=consumeIdentSequence(t,n);if(n.peekOneCodePoint()===A){if(checkIfCodePointsMatchURLIdent(0,r)){n.readCodePoint();let i=0;for(;;){const t=n.peekTwoCodePoints(),s=isWhitespace(t[0]),c=isWhitespace(t[1]);if(s&&c){i+=2,n.readCodePoint(),n.readCodePoint();continue}const a=s?t[1]:t[0];if(a===b||a===o){for(let e=0;e<i;e++)n.unreadCodePoint();const t=n.representation();return[e.Function,n.representationString(),t[0],t[1],{value:codePointsToString(r)}]}break}for(let e=0;e<i;e++)n.unreadCodePoint();return consumeUrlToken(t,n)}n.readCodePoint();const i=n.representation();return[e.Function,n.representationString(),i[0],i[1],{value:codePointsToString(r)}]}const i=n.representation();return[e.Ident,n.representationString(),i[0],i[1],{value:codePointsToString(r)}]}function tokenizer(t,n){const r=t.css.valueOf(),i=new Reader(r),s={onParseError:(null==n?void 0:n.onParseError)??(()=>{})};return{nextToken:function nextToken(){if(i.resetRepresentation(),checkIfTwoCodePointsStartAComment(0,i)){if(null!=n&&n.commentsAreTokens)return consumeComment(s,i);consumeComment(s,i)}i.resetRepresentation();const t=i.peekOneCodePoint();if(!1===t)return[e.EOF,"",-1,-1,void 0];switch(t){case d:{i.readCodePoint();const t=i.representation();return[e.Comma,i.representationString(),t[0],t[1],void 0]}case a:{i.readCodePoint();const t=i.representation();return[e.Colon,i.representationString(),t[0],t[1],void 0]}case x:{i.readCodePoint();const t=i.representation();return[e.Semicolon,i.representationString(),t[0],t[1],void 0]}case A:{i.readCodePoint();const t=i.representation();return[e.OpenParen,i.representationString(),t[0],t[1],void 0]}case F:{i.readCodePoint();const t=i.representation();return[e.CloseParen,i.representationString(),t[0],t[1],void 0]}case T:{i.readCodePoint();const t=i.representation();return[e.OpenSquare,i.representationString(),t[0],t[1],void 0]}case q:{i.readCodePoint();const t=i.representation();return[e.CloseSquare,i.representationString(),t[0],t[1],void 0]}case k:{i.readCodePoint();const t=i.representation();return[e.OpenCurly,i.representationString(),t[0],t[1],void 0]}case y:{i.readCodePoint();const t=i.representation();return[e.CloseCurly,i.representationString(),t[0],t[1],void 0]}}switch(t){case o:case b:return consumeStringToken(s,i);case U:return consumeHashToken(s,i);case N:case P:{if(checkIfThreeCodePointsWouldStartANumber(0,i))return consumeNumericToken(s,i);i.readCodePoint();const n=i.representation();return[e.Delim,i.representationString(),n[0],n[1],{value:String.fromCharCode(t)}]}case l:{if(checkIfThreeCodePointsWouldStartANumber(0,i))return consumeNumericToken(s,i);if(checkIfThreeCodePointsWouldStartCDC(0,i)){i.readCodePoint(),i.readCodePoint(),i.readCodePoint();const t=i.representation();return[e.CDC,i.representationString(),t[0],t[1],void 0]}if(checkIfThreeCodePointsWouldStartAnIdentSequence(0,i))return consumeIdentLikeToken(s,i);i.readCodePoint();const t=i.representation();return[e.Delim,i.representationString(),t[0],t[1],{value:"-"}]}case I:{if(checkIfFourCodePointsWouldStartCDO(0,i)){i.readCodePoint(),i.readCodePoint(),i.readCodePoint(),i.readCodePoint();const t=i.representation();return[e.CDO,i.representationString(),t[0],t[1],void 0]}i.readCodePoint();const t=i.representation();return[e.Delim,i.representationString(),t[0],t[1],{value:"<"}]}case u:{if(i.readCodePoint(),checkIfThreeCodePointsWouldStartAnIdentSequence(0,i)){const t=consumeIdentSequence(s,i),n=i.representation();return[e.AtKeyword,i.representationString(),n[0],n[1],{value:codePointsToString(t)}]}const t=i.representation();return[e.Delim,i.representationString(),t[0],t[1],{value:"@"}]}case W:{if(checkIfTwoCodePointsAreAValidEscape(0,i))return consumeIdentLikeToken(s,i);i.readCodePoint();const t=i.representation();return s.onParseError({message:'Invalid escape sequence after "\\"',start:t[0],end:t[1],state:["4.3.1. Consume a token","U+005C REVERSE SOLIDUS (\\)","The input stream does not start with a valid escape sequence"]}),[e.Delim,i.representationString(),t[0],t[1],{value:"\\"}]}}if(isWhitespace(t))return consumeWhiteSpace(0,i);if(isDigitCodePoint(t))return consumeNumericToken(s,i);if(isIdentStartCodePoint(t))return consumeIdentLikeToken(s,i);i.readCodePoint();const r=i.representation();return[e.Delim,i.representationString(),r[0],r[1],{value:String.fromCharCode(t)}]},endOfFile:function endOfFile(){return!1===i.peekOneCodePoint()}}}function cloneTokens(e){return"undefined"!=typeof globalThis&&"structuredClone"in globalThis?structuredClone(e):JSON.parse(JSON.stringify(e))}export{t as NumberType,Reader,e as TokenType,cloneTokens,isToken,mirrorVariantType,stringify,tokenizer};
