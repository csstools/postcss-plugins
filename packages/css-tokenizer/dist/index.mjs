class Reader{cursor;stringSource="";codePointSource=[];length=0;representationStart=0;representationEnd=-1;peekedOne;peekedTwo;peekedThree;constructor(e){this.cursor=0,this.stringSource=e,this.length=e.length,this.codePointSource=new Array(this.length);for(let e=0;e<this.length;e++)this.codePointSource[e]=this.stringSource.charCodeAt(e);this.peekedOne=this.codePointSource[this.cursor],this.peekedTwo=this.codePointSource[this.cursor+1],this.peekedThree=this.codePointSource[this.cursor+2],this.peekedFour=this.codePointSource[this.cursor+3]}peekedFour;cursorPositionOfLastReadCodePoint(){return this.cursor-1}readCodePoint(e=1){const t=this.codePointSource[this.cursor];return void 0!==t&&(this.cursor+=e,this.representationEnd=this.cursor-1,this.peekedOne=this.codePointSource[this.cursor],this.peekedTwo=this.codePointSource[this.cursor+1],this.peekedThree=this.codePointSource[this.cursor+2],this.peekedFour=this.codePointSource[this.cursor+3],t)}unreadCodePoint(){return 0!==this.cursor&&(this.representationEnd=this.cursor-1,this.cursor-=1,this.peekedOne=this.codePointSource[this.cursor],this.peekedTwo=this.codePointSource[this.cursor+1],this.peekedThree=this.codePointSource[this.cursor+2],this.peekedFour=this.codePointSource[this.cursor+3],!0)}representationString(){return-1===this.representationEnd?"":this.stringSource.slice(this.representationStart,this.representationEnd+1)}resetRepresentation(){this.representationStart=this.cursor,this.representationEnd=-1}slice(e,t){return this.stringSource.slice(e,t)}}var e,t,n;function mirrorVariantType(t){switch(t){case e.OpenParen:return e.CloseParen;case e.CloseParen:return e.OpenParen;case e.OpenCurly:return e.CloseCurly;case e.CloseCurly:return e.OpenCurly;case e.OpenSquare:return e.CloseSquare;case e.CloseSquare:return e.OpenSquare;default:return null}}function isToken(t){return!!Array.isArray(t)&&(!(t.length<4)&&(t[0]in e&&("string"==typeof t[1]&&("number"==typeof t[2]&&"number"==typeof t[3]))))}function stringify(...e){let t="";for(let n=0;n<e.length;n++)t+=e[n][1];return t}!function(e){e.Comment="comment",e.AtKeyword="at-keyword-token",e.BadString="bad-string-token",e.BadURL="bad-url-token",e.CDC="CDC-token",e.CDO="CDO-token",e.Colon="colon-token",e.Comma="comma-token",e.Delim="delim-token",e.Dimension="dimension-token",e.EOF="EOF-token",e.Function="function-token",e.Hash="hash-token",e.Ident="ident-token",e.Number="number-token",e.Percentage="percentage-token",e.Semicolon="semicolon-token",e.String="string-token",e.URL="url-token",e.Whitespace="whitespace-token",e.OpenParen="(-token",e.CloseParen=")-token",e.OpenSquare="[-token",e.CloseSquare="]-token",e.OpenCurly="{-token",e.CloseCurly="}-token"}(e||(e={})),function(e){e.Integer="integer",e.Number="number"}(t||(t={})),function(e){e.Unrestricted="unrestricted",e.ID="id"}(n||(n={}));const r="'".charCodeAt(0),o="*".charCodeAt(0),i="\b".charCodeAt(0),s="\r".charCodeAt(0),a="\t".charCodeAt(0),d=":".charCodeAt(0),c=",".charCodeAt(0),u="@".charCodeAt(0),p="".charCodeAt(0),C="!".charCodeAt(0),h="\f".charCodeAt(0),k=".".charCodeAt(0),S=">".charCodeAt(0),l="-".charCodeAt(0),f="".charCodeAt(0),P="E".charCodeAt(0),m="e".charCodeAt(0),g="{".charCodeAt(0),O="(".charCodeAt(0),E="[".charCodeAt(0),A="<".charCodeAt(0),T="\n".charCodeAt(0),I="\v".charCodeAt(0),v="_".charCodeAt(0),w="􏿿".charCodeAt(0),D="\0".charCodeAt(0),U="#".charCodeAt(0),L="%".charCodeAt(0),N="+".charCodeAt(0),b='"'.charCodeAt(0),R="�".charCodeAt(0),F="\\".charCodeAt(0),W="}".charCodeAt(0),y=")".charCodeAt(0),q="]".charCodeAt(0),x=";".charCodeAt(0),V="".charCodeAt(0),B="/".charCodeAt(0),H=" ".charCodeAt(0);function checkIfFourCodePointsWouldStartCDO(e,t){return t.peekedOne===A&&t.peekedTwo===C&&t.peekedThree===l&&t.peekedFour===l}const M="0".charCodeAt(0),z="9".charCodeAt(0);function isDigitCodePoint(e){return M<=e&&e<=z}const K="A".charCodeAt(0),J="Z".charCodeAt(0);function isUppercaseLetterCodePoint(e){return K<=e&&e<=J}const Q="a".charCodeAt(0),Z="z".charCodeAt(0);function isLowercaseLetterCodePoint(e){return Q<=e&&e<=Z}const $="F".charCodeAt(0),_="f".charCodeAt(0);function isHexDigitCodePoint(e){return!!isDigitCodePoint(e)||(K<=e&&e<=$||Q<=e&&e<=_)}function isLetterCodePoint(e){return!(!isUppercaseLetterCodePoint(e)&&!isLowercaseLetterCodePoint(e))}const j="".charCodeAt(0);function isNonASCIICodePoint(e){return e>=j}function isIdentStartCodePoint(e){return!!isLetterCodePoint(e)||(!!isNonASCIICodePoint(e)||e===v)}function isIdentCodePoint(e){return!!isIdentStartCodePoint(e)||(!!isDigitCodePoint(e)||e===l)}function isNewLine(e){switch(e){case T:case s:case h:return!0;default:return!1}}function isWhitespace(e){switch(e){case T:case s:case h:case a:case H:return!0;default:return!1}}const G="\ud800".charCodeAt(0),X="\udfff".charCodeAt(0);function checkIfTwoCodePointsAreAValidEscape(e,t){return t.peekedOne===F&&t.peekedTwo!==T}function checkIfThreeCodePointsWouldStartAnIdentSequence(e,t){return t.peekedOne===l?t.peekedTwo===l||(!!isIdentStartCodePoint(t.peekedTwo)||t.peekedTwo===F&&t.peekedThree!==T):!!isIdentStartCodePoint(t.peekedOne)||t.peekedOne===F&&checkIfTwoCodePointsAreAValidEscape(0,t)}function checkIfThreeCodePointsWouldStartANumber(e,t){return t.peekedOne===N||t.peekedOne===l?!!isDigitCodePoint(t.peekedTwo)||t.peekedTwo===k&&isDigitCodePoint(t.peekedThree):t.peekedOne===k?isDigitCodePoint(t.peekedTwo):!!isDigitCodePoint(t.peekedOne)}function checkIfTwoCodePointsStartAComment(e,t){return t.peekedOne===B&&t.peekedTwo===o}function checkIfThreeCodePointsWouldStartCDC(e,t){return t.peekedOne===l&&t.peekedTwo===l&&t.peekedThree===S}function consumeComment(t,n){for(n.readCodePoint(2);;){const e=n.readCodePoint();if(!1===e){t.onParseError({message:"Unexpected EOF while consuming a comment.",start:n.representationStart,end:n.representationEnd,state:["4.3.2. Consume comments","Unexpected EOF"]});break}if(e===o&&(void 0!==n.peekedOne&&n.peekedOne===B)){n.readCodePoint();break}}return[e.Comment,n.representationString(),n.representationStart,n.representationEnd,void 0]}function consumeEscapedCodePoint(e,t){const n=t.readCodePoint();if(!1===n)return e.onParseError({message:"Unexpected EOF while consuming an escaped code point.",start:t.representationStart,end:t.representationEnd,state:["4.3.7. Consume an escaped code point","Unexpected EOF"]}),R;if(isHexDigitCodePoint(n)){const e=[n];for(;void 0!==t.peekedOne&&isHexDigitCodePoint(t.peekedOne)&&e.length<6;)e.push(t.peekedOne),t.readCodePoint();isWhitespace(t.peekedOne)&&t.readCodePoint();const o=parseInt(String.fromCharCode(...e),16);return 0===o?R:G<=(r=o)&&r<=X||o>w?R:o}var r;return n}function consumeIdentSequence(e,t){const n=[];for(;;){if(void 0===t.peekedOne)return n;if(isIdentCodePoint(t.peekedOne))n.push(t.peekedOne),t.readCodePoint();else{if(t.peekedOne!==F||!checkIfTwoCodePointsAreAValidEscape(0,t))return n;t.readCodePoint(),n.push(consumeEscapedCodePoint(e,t))}}}function consumeHashToken(t,r){if(r.readCodePoint(),void 0!==r.peekedOne&&isIdentCodePoint(r.peekedOne)||checkIfTwoCodePointsAreAValidEscape(0,r)){let o=n.Unrestricted;checkIfThreeCodePointsWouldStartAnIdentSequence(0,r)&&(o=n.ID);const i=consumeIdentSequence(t,r);return[e.Hash,r.representationString(),r.representationStart,r.representationEnd,{value:String.fromCharCode(...i),type:o}]}return[e.Delim,r.representationString(),r.representationStart,r.representationEnd,{value:"#"}]}function consumeNumber(e,n){let r=t.Integer;const o=[];{n.peekedOne!==N&&n.peekedOne!==l||(o.push(n.peekedOne),n.readCodePoint());const e=consumeDigits(n);for(let t=0;t<e.length;t++)o.push(e[t])}if(n.peekedOne===k&&isDigitCodePoint(n.peekedTwo)){o.push(n.peekedOne),o.push(n.peekedTwo),n.readCodePoint(2),r=t.Number;const e=consumeDigits(n);for(let t=0;t<e.length;t++)o.push(e[t])}if((n.peekedOne===m||n.peekedOne===P)&&isDigitCodePoint(n.peekedTwo)){o.push(n.peekedOne),o.push(n.peekedTwo),n.readCodePoint(2),r=t.Number;const e=consumeDigits(n);for(let t=0;t<e.length;t++)o.push(e[t])}if((n.peekedOne===m||n.peekedOne===P)&&(n.peekedTwo===l||n.peekedTwo===N)&&isDigitCodePoint(n.peekedThree)){o.push(n.peekedOne),o.push(n.peekedTwo),o.push(n.peekedThree),n.readCodePoint(3),r=t.Number;const e=consumeDigits(n);for(let t=0;t<e.length;t++)o.push(e[t])}return[convertCodePointsToNumber(o),r]}function consumeDigits(e){const t=[];for(;;){if(void 0===e.peekedOne)return t;if(!isDigitCodePoint(e.peekedOne))return t;t.push(e.peekedOne),e.readCodePoint()}}function convertCodePointsToNumber(e){let t=1;const n=[];let r=0,o=0;const i=[];let s=0,a=1;const d=[];let c=0,u=0;for(e[u]===l?(u++,t=-1):e[u]===N&&u++;u<e.length&&isDigitCodePoint(e[u]);)n.push(e[u]),u++;for(r=digitCodePointsToInteger(n),e[u]===k&&u++;u<e.length&&isDigitCodePoint(e[u]);)i.push(e[u]),u++;for(o=i.length,s=digitCodePointsToInteger(i)/Math.pow(10,o),e[u]!==m&&e[u]!==P||u++,e[u]===l?(u++,a=-1):e[u]===N&&u++;u<e.length&&isDigitCodePoint(e[u]);)d.push(e[u]),u++;return c=digitCodePointsToInteger(d),t*(r+s)*Math.pow(10,a*c)}function digitCodePointsToInteger(e){if(0===e.length)return 0;const t=String.fromCharCode(...e),n=Number.parseInt(t,10);if(Number.isNaN(n))throw new Error(`Unexpected "NaN" result when parsing a number from digit code points: "${t}"`);return n}function consumeNumericToken(t,n){const r=consumeNumber(0,n);if(checkIfThreeCodePointsWouldStartAnIdentSequence(0,n)){const o=consumeIdentSequence(t,n);return[e.Dimension,n.representationString(),n.representationStart,n.representationEnd,{value:r[0],type:r[1],unit:String.fromCharCode(...o)}]}return n.peekedOne===L?(n.readCodePoint(),[e.Percentage,n.representationString(),n.representationStart,n.representationEnd,{value:r[0]}]):[e.Number,n.representationString(),n.representationStart,n.representationEnd,{value:r[0],type:r[1]}]}function consumeWhiteSpace(t,n,r=-1){let o=0;for(;;){if(-1!==r&&o===r)return[e.Whitespace,n.representationString(),n.representationStart,n.representationEnd,void 0];if(o++,void 0===n.peekedOne)return[e.Whitespace,n.representationString(),n.representationStart,n.representationEnd,void 0];if(!isWhitespace(n.peekedOne))break;n.readCodePoint()}return[e.Whitespace,n.representationString(),n.representationStart,n.representationEnd,void 0]}function consumeStringToken(t,n){let r="";const o=n.readCodePoint();if(!1===o)throw new Error("Unexpected EOF");for(;;){const i=n.readCodePoint();if(!1===i)return t.onParseError({message:"Unexpected EOF while consuming a string token.",start:n.representationStart,end:n.representationEnd,state:["4.3.5. Consume a string token","Unexpected EOF"]}),[e.String,n.representationString(),n.representationStart,n.representationEnd,{value:r}];if(isNewLine(i))return t.onParseError({message:"Unexpected newline while consuming a string token.",start:n.representationStart,end:n.representationEnd,state:["4.3.5. Consume a string token","Unexpected newline"]}),n.unreadCodePoint(),[e.BadString,n.representationString(),n.representationStart,n.representationEnd,void 0];if(i===o)return[e.String,n.representationString(),n.representationStart,n.representationEnd,{value:r}];if(i!==F)r+=String.fromCharCode(i);else{if(void 0===n.peekedOne)continue;if(isNewLine(n.peekedOne)){n.readCodePoint();continue}r+=String.fromCharCode(consumeEscapedCodePoint(t,n))}}}const Y="u".charCodeAt(0),ee="U".charCodeAt(0),te="r".charCodeAt(0),ne="R".charCodeAt(0),re="l".charCodeAt(0),oe="L".charCodeAt(0);function checkIfCodePointsMatchURLIdent(e,t){return 3===t.length&&((t[0]===Y||t[0]===ee)&&((t[1]===te||t[1]===ne)&&(t[2]===re||t[2]===oe)))}function consumeBadURL(e,t){for(;;){if(void 0===t.peekedOne)return;if(t.peekedOne===y)return void t.readCodePoint();checkIfTwoCodePointsAreAValidEscape(0,t)?(t.readCodePoint(),consumeEscapedCodePoint(e,t)):t.readCodePoint()}}function consumeUrlToken(t,n){consumeWhiteSpace(0,n);let o="";for(;;){if(void 0===n.peekedOne)return t.onParseError({message:"Unexpected EOF while consuming a url token.",start:n.representationStart,end:n.representationEnd,state:["4.3.6. Consume a url token","Unexpected EOF"]}),[e.URL,n.representationString(),n.representationStart,n.representationEnd,{value:o}];if(n.peekedOne===y)return n.readCodePoint(),[e.URL,n.representationString(),n.representationStart,n.representationEnd,{value:o}];if(isWhitespace(n.peekedOne))return consumeWhiteSpace(0,n),void 0===n.peekedOne?(t.onParseError({message:"Unexpected EOF while consuming a url token.",start:n.representationStart,end:n.representationEnd,state:["4.3.6. Consume a url token","Consume as much whitespace as possible","Unexpected EOF"]}),[e.URL,n.representationString(),n.representationStart,n.representationEnd,{value:o}]):n.peekedOne===y?(n.readCodePoint(),[e.URL,n.representationString(),n.representationStart,n.representationEnd,{value:o}]):(consumeBadURL(t,n),[e.BadURL,n.representationString(),n.representationStart,n.representationEnd,void 0]);if(n.peekedOne===b||n.peekedOne===r||n.peekedOne===O||((s=n.peekedOne)===I||s===p||D<=s&&s<=i||V<=s&&s<=f))return consumeBadURL(t,n),t.onParseError({message:"Unexpected character while consuming a url token.",start:n.representationStart,end:n.representationEnd,state:["4.3.6. Consume a url token","Unexpected U+0022 QUOTATION MARK (\"), U+0027 APOSTROPHE ('), U+0028 LEFT PARENTHESIS (() or non-printable code point"]}),[e.BadURL,n.representationString(),n.representationStart,n.representationEnd,void 0];if(n.peekedOne===F){if(checkIfTwoCodePointsAreAValidEscape(0,n)){o+=String.fromCharCode(consumeEscapedCodePoint(t,n));continue}return consumeBadURL(t,n),t.onParseError({message:"Invalid escape sequence while consuming a url token.",start:n.representationStart,end:n.representationEnd,state:["4.3.6. Consume a url token","U+005C REVERSE SOLIDUS (\\)","The input stream does not start with a valid escape sequence"]}),[e.BadURL,n.representationString(),n.representationStart,n.representationEnd,void 0]}o+=String.fromCharCode(n.peekedOne),n.readCodePoint()}var s}function consumeIdentLikeToken(t,n){const o=consumeIdentSequence(t,n);if(n.peekedOne===O){if(checkIfCodePointsMatchURLIdent(0,o)){n.readCodePoint();let i=0;for(;;){const t=isWhitespace(n.peekedOne),s=isWhitespace(n.peekedTwo);if(t&&s){i+=2,n.readCodePoint(2);continue}const a=t?n.peekedTwo:n.peekedOne;if(a===b||a===r){for(let e=0;e<i;e++)n.unreadCodePoint();return[e.Function,n.representationString(),n.representationStart,n.representationEnd,{value:String.fromCharCode(...o)}]}break}for(let e=0;e<i;e++)n.unreadCodePoint();return consumeUrlToken(t,n)}return n.readCodePoint(),[e.Function,n.representationString(),n.representationStart,n.representationEnd,{value:String.fromCharCode(...o)}]}return[e.Ident,n.representationString(),n.representationStart,n.representationEnd,{value:String.fromCharCode(...o)}]}function tokenizer(t,n){const o=t.css.valueOf(),i=new Reader(o),s={onParseError:(null==n?void 0:n.onParseError)??(()=>{})};return{nextToken:function nextToken(){if(i.resetRepresentation(),checkIfTwoCodePointsStartAComment(0,i)){if(null!=n&&n.commentsAreTokens)return consumeComment(s,i);consumeComment(s,i)}i.resetRepresentation();const t=i.peekedOne;if(void 0===t)return[e.EOF,"",-1,-1,void 0];switch(t){case c:return i.readCodePoint(),[e.Comma,i.representationString(),i.representationStart,i.representationEnd,void 0];case d:return i.readCodePoint(),[e.Colon,i.representationString(),i.representationStart,i.representationEnd,void 0];case x:return i.readCodePoint(),[e.Semicolon,i.representationString(),i.representationStart,i.representationEnd,void 0];case O:return i.readCodePoint(),[e.OpenParen,i.representationString(),i.representationStart,i.representationEnd,void 0];case y:return i.readCodePoint(),[e.CloseParen,i.representationString(),i.representationStart,i.representationEnd,void 0];case E:return i.readCodePoint(),[e.OpenSquare,i.representationString(),i.representationStart,i.representationEnd,void 0];case q:return i.readCodePoint(),[e.CloseSquare,i.representationString(),i.representationStart,i.representationEnd,void 0];case g:return i.readCodePoint(),[e.OpenCurly,i.representationString(),i.representationStart,i.representationEnd,void 0];case W:return i.readCodePoint(),[e.CloseCurly,i.representationString(),i.representationStart,i.representationEnd,void 0];case r:case b:return consumeStringToken(s,i);case U:return consumeHashToken(s,i);case N:case k:return checkIfThreeCodePointsWouldStartANumber(0,i)?consumeNumericToken(s,i):(i.readCodePoint(),[e.Delim,i.representationString(),i.representationStart,i.representationEnd,{value:String.fromCharCode(t)}]);case l:return checkIfThreeCodePointsWouldStartANumber(0,i)?consumeNumericToken(s,i):checkIfThreeCodePointsWouldStartCDC(0,i)?(i.readCodePoint(3),[e.CDC,i.representationString(),i.representationStart,i.representationEnd,void 0]):checkIfThreeCodePointsWouldStartAnIdentSequence(0,i)?consumeIdentLikeToken(s,i):(i.readCodePoint(),[e.Delim,i.representationString(),i.representationStart,i.representationEnd,{value:"-"}]);case A:return checkIfFourCodePointsWouldStartCDO(0,i)?(i.readCodePoint(4),[e.CDO,i.representationString(),i.representationStart,i.representationEnd,void 0]):(i.readCodePoint(),[e.Delim,i.representationString(),i.representationStart,i.representationEnd,{value:"<"}]);case u:if(i.readCodePoint(),checkIfThreeCodePointsWouldStartAnIdentSequence(0,i)){const t=consumeIdentSequence(s,i);return[e.AtKeyword,i.representationString(),i.representationStart,i.representationEnd,{value:String.fromCharCode(...t)}]}return[e.Delim,i.representationString(),i.representationStart,i.representationEnd,{value:"@"}];case F:return checkIfTwoCodePointsAreAValidEscape(0,i)?consumeIdentLikeToken(s,i):(i.readCodePoint(),s.onParseError({message:'Invalid escape sequence after "\\"',start:i.representationStart,end:i.representationEnd,state:["4.3.1. Consume a token","U+005C REVERSE SOLIDUS (\\)","The input stream does not start with a valid escape sequence"]}),[e.Delim,i.representationString(),i.representationStart,i.representationEnd,{value:"\\"}])}return isWhitespace(t)?consumeWhiteSpace(0,i):isDigitCodePoint(t)?consumeNumericToken(s,i):isIdentStartCodePoint(t)?consumeIdentLikeToken(s,i):(i.readCodePoint(),[e.Delim,i.representationString(),i.representationStart,i.representationEnd,{value:String.fromCharCode(t)}])},endOfFile:function endOfFile(){return void 0===i.peekedOne}}}function cloneTokens(e){return"undefined"!=typeof globalThis&&"structuredClone"in globalThis?structuredClone(e):JSON.parse(JSON.stringify(e))}export{t as NumberType,Reader,e as TokenType,cloneTokens,isToken,mirrorVariantType,stringify,tokenizer};
