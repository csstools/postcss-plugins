class Reader{cursor;stringSource="";codePointSource=[];length=0;representationStart=0;representationEnd=-1;constructor(e){this.cursor=0,this.stringSource=e,this.length=e.length,this.codePointSource=new Array(this.length);for(let e=0;e<this.length;e++)this.codePointSource[e]=this.stringSource.charCodeAt(e)}cursorPositionOfLastReadCodePoint(){return this.cursor-1}readCodePoint(e=1){const r=this.codePointSource[this.cursor];return void 0!==r&&(this.cursor+=e,this.representationEnd=this.cursor-1,r)}unreadCodePoint(e=1){return 0!==this.cursor&&(this.cursor-=e,this.representationEnd=this.cursor-1,!0)}representationString(){return-1===this.representationEnd?"":this.stringSource.slice(this.representationStart,this.representationEnd+1)}resetRepresentation(){this.representationStart=this.cursor,this.representationEnd=-1}slice(e,r){return this.stringSource.slice(e,r)}}var e,r,t;function mirrorVariantType(r){switch(r){case e.OpenParen:return e.CloseParen;case e.CloseParen:return e.OpenParen;case e.OpenCurly:return e.CloseCurly;case e.CloseCurly:return e.OpenCurly;case e.OpenSquare:return e.CloseSquare;case e.CloseSquare:return e.OpenSquare;default:return null}}function isToken(r){return!!Array.isArray(r)&&(!(r.length<4)&&(r[0]in e&&("string"==typeof r[1]&&("number"==typeof r[2]&&"number"==typeof r[3]))))}function stringify(...e){let r="";for(let t=0;t<e.length;t++)r+=e[t][1];return r}!function(e){e.Comment="comment",e.AtKeyword="at-keyword-token",e.BadString="bad-string-token",e.BadURL="bad-url-token",e.CDC="CDC-token",e.CDO="CDO-token",e.Colon="colon-token",e.Comma="comma-token",e.Delim="delim-token",e.Dimension="dimension-token",e.EOF="EOF-token",e.Function="function-token",e.Hash="hash-token",e.Ident="ident-token",e.Number="number-token",e.Percentage="percentage-token",e.Semicolon="semicolon-token",e.String="string-token",e.URL="url-token",e.Whitespace="whitespace-token",e.OpenParen="(-token",e.CloseParen=")-token",e.OpenSquare="[-token",e.CloseSquare="]-token",e.OpenCurly="{-token",e.CloseCurly="}-token"}(e||(e={})),function(e){e.Integer="integer",e.Number="number"}(r||(r={})),function(e){e.Unrestricted="unrestricted",e.ID="id"}(t||(t={}));const o="'".charCodeAt(0),n="*".charCodeAt(0),i="\b".charCodeAt(0),c="\r".charCodeAt(0),s="\t".charCodeAt(0),a=":".charCodeAt(0),d=",".charCodeAt(0),u="@".charCodeAt(0),C="".charCodeAt(0),S="!".charCodeAt(0),p="\f".charCodeAt(0),P=".".charCodeAt(0),h=">".charCodeAt(0),l="-".charCodeAt(0),f="".charCodeAt(0),m="E".charCodeAt(0),g="e".charCodeAt(0),A="{".charCodeAt(0),E="(".charCodeAt(0),k="[".charCodeAt(0),I="<".charCodeAt(0),v="\n".charCodeAt(0),T="\v".charCodeAt(0),D="_".charCodeAt(0),U="􏿿".charCodeAt(0),O="\0".charCodeAt(0),w="#".charCodeAt(0),L="%".charCodeAt(0),R="+".charCodeAt(0),b='"'.charCodeAt(0),N="�".charCodeAt(0),y="\\".charCodeAt(0),W="}".charCodeAt(0),F=")".charCodeAt(0),q="]".charCodeAt(0),x=";".charCodeAt(0),V="".charCodeAt(0),B="/".charCodeAt(0),H=" ".charCodeAt(0),M="0".charCodeAt(0),z="1".charCodeAt(0),K="2".charCodeAt(0),J="3".charCodeAt(0),Q="4".charCodeAt(0),Z="5".charCodeAt(0),_="6".charCodeAt(0),j="7".charCodeAt(0),G="8".charCodeAt(0),X="9".charCodeAt(0);function checkIfFourCodePointsWouldStartCDO(e,r){return r.codePointSource[r.cursor]===I&&r.codePointSource[r.cursor+1]===S&&r.codePointSource[r.cursor+2]===l&&r.codePointSource[r.cursor+3]===l}const Y="0".charCodeAt(0),$="9".charCodeAt(0);function isDigitCodePoint(e){return Y<=e&&e<=$}const ee="A".charCodeAt(0),re="Z".charCodeAt(0);function isUppercaseLetterCodePoint(e){return ee<=e&&e<=re}const te="a".charCodeAt(0),oe="z".charCodeAt(0);function isLowercaseLetterCodePoint(e){return te<=e&&e<=oe}const ne="F".charCodeAt(0),ie="f".charCodeAt(0);function isHexDigitCodePoint(e){return Y<=e&&e<=$||(te<=e&&e<=ie||ee<=e&&e<=ne)}function isLetterCodePoint(e){return isLowercaseLetterCodePoint(e)||isUppercaseLetterCodePoint(e)}const ce="".charCodeAt(0);function isNonASCIICodePoint(e){return e>=ce}function isIdentStartCodePoint(e){return!!isLetterCodePoint(e)||(!!isNonASCIICodePoint(e)||e===D)}function isIdentCodePoint(e){return!!isIdentStartCodePoint(e)||(!!isDigitCodePoint(e)||e===l)}function isNewLine(e){switch(e){case v:case c:case p:return!0;default:return!1}}function isWhitespace(e){switch(e){case v:case c:case p:case s:case H:return!0;default:return!1}}const se="\ud800".charCodeAt(0),ae="\udfff".charCodeAt(0);function checkIfTwoCodePointsAreAValidEscape(e,r){return r.codePointSource[r.cursor]===y&&r.codePointSource[r.cursor+1]!==v}function checkIfThreeCodePointsWouldStartAnIdentSequence(e,r){return r.codePointSource[r.cursor]===l?r.codePointSource[r.cursor+1]===l||(!!isIdentStartCodePoint(r.codePointSource[r.cursor+1])||r.codePointSource[r.cursor+1]===y&&r.codePointSource[r.cursor+2]!==v):!!isIdentStartCodePoint(r.codePointSource[r.cursor])||checkIfTwoCodePointsAreAValidEscape(0,r)}function checkIfThreeCodePointsWouldStartANumber(e,r){return r.codePointSource[r.cursor]===R||r.codePointSource[r.cursor]===l?!!isDigitCodePoint(r.codePointSource[r.cursor+1])||r.codePointSource[r.cursor+1]===P&&isDigitCodePoint(r.codePointSource[r.cursor+2]):r.codePointSource[r.cursor]===P?isDigitCodePoint(r.codePointSource[r.cursor+1]):!!isDigitCodePoint(r.codePointSource[r.cursor])}function checkIfTwoCodePointsStartAComment(e,r){return r.codePointSource[r.cursor]===B&&r.codePointSource[r.cursor+1]===n}function checkIfThreeCodePointsWouldStartCDC(e,r){return r.codePointSource[r.cursor]===l&&r.codePointSource[r.cursor+1]===l&&r.codePointSource[r.cursor+2]===h}function consumeComment(r,t){for(t.readCodePoint(2);;){const e=t.readCodePoint();if(!1===e){r.onParseError({message:"Unexpected EOF while consuming a comment.",start:t.representationStart,end:t.representationEnd,state:["4.3.2. Consume comments","Unexpected EOF"]});break}if(e===n&&(void 0!==t.codePointSource[t.cursor]&&t.codePointSource[t.cursor]===B)){t.readCodePoint();break}}return[e.Comment,t.representationString(),t.representationStart,t.representationEnd,void 0]}function consumeEscapedCodePoint(e,r){const t=r.readCodePoint();if(!1===t)return e.onParseError({message:"Unexpected EOF while consuming an escaped code point.",start:r.representationStart,end:r.representationEnd,state:["4.3.7. Consume an escaped code point","Unexpected EOF"]}),N;if(isHexDigitCodePoint(t)){const e=[t];for(;void 0!==r.codePointSource[r.cursor]&&isHexDigitCodePoint(r.codePointSource[r.cursor])&&e.length<6;)e.push(r.codePointSource[r.cursor]),r.readCodePoint();isWhitespace(r.codePointSource[r.cursor])&&r.readCodePoint();const n=parseInt(String.fromCharCode(...e),16);return 0===n?N:se<=(o=n)&&o<=ae||n>U?N:n}var o;return t}function consumeIdentSequence(e,r){const t=[];for(;;){if(void 0===r.codePointSource[r.cursor])return t;if(isIdentCodePoint(r.codePointSource[r.cursor]))t.push(r.codePointSource[r.cursor]),r.readCodePoint();else{if(!checkIfTwoCodePointsAreAValidEscape(0,r))return t;r.readCodePoint(),t.push(consumeEscapedCodePoint(e,r))}}}function consumeHashToken(r,o){if(o.readCodePoint(),void 0!==o.codePointSource[o.cursor]&&isIdentCodePoint(o.codePointSource[o.cursor])||checkIfTwoCodePointsAreAValidEscape(0,o)){let n=t.Unrestricted;checkIfThreeCodePointsWouldStartAnIdentSequence(0,o)&&(n=t.ID);const i=consumeIdentSequence(r,o);return[e.Hash,o.representationString(),o.representationStart,o.representationEnd,{value:String.fromCharCode(...i),type:n}]}return[e.Delim,o.representationString(),o.representationStart,o.representationEnd,{value:"#"}]}function consumeNumber(e,t){let o=r.Integer;const n=[];{t.codePointSource[t.cursor]!==R&&t.codePointSource[t.cursor]!==l||(n.push(t.codePointSource[t.cursor]),t.readCodePoint());const e=consumeDigits(t);for(let r=0;r<e.length;r++)n.push(e[r])}if(t.codePointSource[t.cursor]===P&&isDigitCodePoint(t.codePointSource[t.cursor+1])){n.push(t.codePointSource[t.cursor]),n.push(t.codePointSource[t.cursor+1]),t.readCodePoint(2),o=r.Number;const e=consumeDigits(t);for(let r=0;r<e.length;r++)n.push(e[r])}if((t.codePointSource[t.cursor]===g||t.codePointSource[t.cursor]===m)&&isDigitCodePoint(t.codePointSource[t.cursor+1])){n.push(t.codePointSource[t.cursor]),n.push(t.codePointSource[t.cursor+1]),t.readCodePoint(2),o=r.Number;const e=consumeDigits(t);for(let r=0;r<e.length;r++)n.push(e[r])}if((t.codePointSource[t.cursor]===g||t.codePointSource[t.cursor]===m)&&(t.codePointSource[t.cursor+1]===l||t.codePointSource[t.cursor+1]===R)&&isDigitCodePoint(t.codePointSource[t.cursor+2])){n.push(t.codePointSource[t.cursor]),n.push(t.codePointSource[t.cursor+1]),n.push(t.codePointSource[t.cursor+2]),t.readCodePoint(3),o=r.Number;const e=consumeDigits(t);for(let r=0;r<e.length;r++)n.push(e[r])}return[convertCodePointsToNumber(n),o]}function consumeDigits(e){const r=[];for(;;){if(void 0===e.codePointSource[e.cursor])return r;if(!isDigitCodePoint(e.codePointSource[e.cursor]))return r;r.push(e.codePointSource[e.cursor]),e.readCodePoint()}}function convertCodePointsToNumber(e){let r=1;const t=[];let o=0,n=0;const i=[];let c=0,s=1;const a=[];let d=0,u=0;for(e[u]===l?(u++,r=-1):e[u]===R&&u++;u<e.length&&isDigitCodePoint(e[u]);)t.push(e[u]),u++;for(o=digitCodePointsToInteger(t),e[u]===P&&u++;u<e.length&&isDigitCodePoint(e[u]);)i.push(e[u]),u++;for(n=i.length,c=digitCodePointsToInteger(i)/Math.pow(10,n),e[u]!==g&&e[u]!==m||u++,e[u]===l?(u++,s=-1):e[u]===R&&u++;u<e.length&&isDigitCodePoint(e[u]);)a.push(e[u]),u++;return d=digitCodePointsToInteger(a),r*(o+c)*Math.pow(10,s*d)}function digitCodePointsToInteger(e){return 0===e.length?0:Number.parseInt(String.fromCharCode(...e),10)}function consumeNumericToken(r,t){const o=consumeNumber(0,t);if(checkIfThreeCodePointsWouldStartAnIdentSequence(0,t)){const n=consumeIdentSequence(r,t);return[e.Dimension,t.representationString(),t.representationStart,t.representationEnd,{value:o[0],type:o[1],unit:String.fromCharCode(...n)}]}return t.codePointSource[t.cursor]===L?(t.readCodePoint(),[e.Percentage,t.representationString(),t.representationStart,t.representationEnd,{value:o[0]}]):[e.Number,t.representationString(),t.representationStart,t.representationEnd,{value:o[0],type:o[1]}]}function consumeWhiteSpace(r,t,o=-1){let n=0;for(;;){if(-1!==o&&n===o)return[e.Whitespace,t.representationString(),t.representationStart,t.representationEnd,void 0];if(n++,void 0===t.codePointSource[t.cursor])return[e.Whitespace,t.representationString(),t.representationStart,t.representationEnd,void 0];if(!isWhitespace(t.codePointSource[t.cursor]))break;t.readCodePoint()}return[e.Whitespace,t.representationString(),t.representationStart,t.representationEnd,void 0]}function consumeStringToken(r,t){let o="";const n=t.readCodePoint();if(!1===n)throw new Error("Unexpected EOF");for(;;){const i=t.readCodePoint();if(!1===i)return r.onParseError({message:"Unexpected EOF while consuming a string token.",start:t.representationStart,end:t.representationEnd,state:["4.3.5. Consume a string token","Unexpected EOF"]}),[e.String,t.representationString(),t.representationStart,t.representationEnd,{value:o}];if(isNewLine(i))return r.onParseError({message:"Unexpected newline while consuming a string token.",start:t.representationStart,end:t.representationEnd,state:["4.3.5. Consume a string token","Unexpected newline"]}),t.unreadCodePoint(),[e.BadString,t.representationString(),t.representationStart,t.representationEnd,void 0];if(i===n)return[e.String,t.representationString(),t.representationStart,t.representationEnd,{value:o}];if(i!==y)o+=String.fromCharCode(i);else{if(void 0===t.codePointSource[t.cursor])continue;if(isNewLine(t.codePointSource[t.cursor])){t.readCodePoint();continue}o+=String.fromCharCode(consumeEscapedCodePoint(r,t))}}}const de="u".charCodeAt(0),ue="U".charCodeAt(0),Ce="r".charCodeAt(0),Se="R".charCodeAt(0),pe="l".charCodeAt(0),Pe="L".charCodeAt(0);function checkIfCodePointsMatchURLIdent(e,r){return 3===r.length&&((r[0]===de||r[0]===ue)&&((r[1]===Ce||r[1]===Se)&&(r[2]===pe||r[2]===Pe)))}function consumeBadURL(e,r){for(;;){if(void 0===r.codePointSource[r.cursor])return;if(r.codePointSource[r.cursor]===F)return void r.readCodePoint();checkIfTwoCodePointsAreAValidEscape(0,r)?(r.readCodePoint(),consumeEscapedCodePoint(e,r)):r.readCodePoint()}}function consumeUrlToken(r,t){consumeWhiteSpace(0,t);let n="";for(;;){if(void 0===t.codePointSource[t.cursor])return r.onParseError({message:"Unexpected EOF while consuming a url token.",start:t.representationStart,end:t.representationEnd,state:["4.3.6. Consume a url token","Unexpected EOF"]}),[e.URL,t.representationString(),t.representationStart,t.representationEnd,{value:n}];if(t.codePointSource[t.cursor]===F)return t.readCodePoint(),[e.URL,t.representationString(),t.representationStart,t.representationEnd,{value:n}];if(isWhitespace(t.codePointSource[t.cursor]))return consumeWhiteSpace(0,t),void 0===t.codePointSource[t.cursor]?(r.onParseError({message:"Unexpected EOF while consuming a url token.",start:t.representationStart,end:t.representationEnd,state:["4.3.6. Consume a url token","Consume as much whitespace as possible","Unexpected EOF"]}),[e.URL,t.representationString(),t.representationStart,t.representationEnd,{value:n}]):t.codePointSource[t.cursor]===F?(t.readCodePoint(),[e.URL,t.representationString(),t.representationStart,t.representationEnd,{value:n}]):(consumeBadURL(r,t),[e.BadURL,t.representationString(),t.representationStart,t.representationEnd,void 0]);if(t.codePointSource[t.cursor]===b||t.codePointSource[t.cursor]===o||t.codePointSource[t.cursor]===E||((c=t.codePointSource[t.cursor])===T||c===C||O<=c&&c<=i||V<=c&&c<=f))return consumeBadURL(r,t),r.onParseError({message:"Unexpected character while consuming a url token.",start:t.representationStart,end:t.representationEnd,state:["4.3.6. Consume a url token","Unexpected U+0022 QUOTATION MARK (\"), U+0027 APOSTROPHE ('), U+0028 LEFT PARENTHESIS (() or non-printable code point"]}),[e.BadURL,t.representationString(),t.representationStart,t.representationEnd,void 0];if(t.codePointSource[t.cursor]===y){if(checkIfTwoCodePointsAreAValidEscape(0,t)){n+=String.fromCharCode(consumeEscapedCodePoint(r,t));continue}return consumeBadURL(r,t),r.onParseError({message:"Invalid escape sequence while consuming a url token.",start:t.representationStart,end:t.representationEnd,state:["4.3.6. Consume a url token","U+005C REVERSE SOLIDUS (\\)","The input stream does not start with a valid escape sequence"]}),[e.BadURL,t.representationString(),t.representationStart,t.representationEnd,void 0]}n+=String.fromCharCode(t.codePointSource[t.cursor]),t.readCodePoint()}var c}function consumeIdentLikeToken(r,t){const n=consumeIdentSequence(r,t);if(t.codePointSource[t.cursor]!==E)return[e.Ident,t.representationString(),t.representationStart,t.representationEnd,{value:String.fromCharCode(...n)}];if(checkIfCodePointsMatchURLIdent(0,n)){t.readCodePoint();let i=0;for(;;){const r=isWhitespace(t.codePointSource[t.cursor]),c=isWhitespace(t.codePointSource[t.cursor+1]);if(r&&c){i+=2,t.readCodePoint(2);continue}const s=r?t.codePointSource[t.cursor+1]:t.codePointSource[t.cursor];if(s===b||s===o)return i>0&&t.unreadCodePoint(i),[e.Function,t.representationString(),t.representationStart,t.representationEnd,{value:String.fromCharCode(...n)}];break}return i>0&&t.unreadCodePoint(i),consumeUrlToken(r,t)}return t.readCodePoint(),[e.Function,t.representationString(),t.representationStart,t.representationEnd,{value:String.fromCharCode(...n)}]}function tokenizer(r,t){const n=r.css.valueOf(),i=new Reader(n),C={onParseError:(null==t?void 0:t.onParseError)??(()=>{})};return{nextToken:function nextToken(){if(i.resetRepresentation(),checkIfTwoCodePointsStartAComment(0,i)){if(null!=t&&t.commentsAreTokens)return consumeComment(C,i);consumeComment(C,i),i.resetRepresentation()}const r=i.codePointSource[i.cursor];if(void 0===r)return[e.EOF,"",-1,-1,void 0];if(isIdentStartCodePoint(r))return consumeIdentLikeToken(C,i);switch(r){case d:return i.readCodePoint(),[e.Comma,i.representationString(),i.representationStart,i.representationEnd,void 0];case a:return i.readCodePoint(),[e.Colon,i.representationString(),i.representationStart,i.representationEnd,void 0];case x:return i.readCodePoint(),[e.Semicolon,i.representationString(),i.representationStart,i.representationEnd,void 0];case E:return i.readCodePoint(),[e.OpenParen,i.representationString(),i.representationStart,i.representationEnd,void 0];case F:return i.readCodePoint(),[e.CloseParen,i.representationString(),i.representationStart,i.representationEnd,void 0];case k:return i.readCodePoint(),[e.OpenSquare,i.representationString(),i.representationStart,i.representationEnd,void 0];case q:return i.readCodePoint(),[e.CloseSquare,i.representationString(),i.representationStart,i.representationEnd,void 0];case A:return i.readCodePoint(),[e.OpenCurly,i.representationString(),i.representationStart,i.representationEnd,void 0];case W:return i.readCodePoint(),[e.CloseCurly,i.representationString(),i.representationStart,i.representationEnd,void 0];case o:case b:return consumeStringToken(C,i);case w:return consumeHashToken(C,i);case R:case P:return checkIfThreeCodePointsWouldStartANumber(0,i)?consumeNumericToken(C,i):(i.readCodePoint(),[e.Delim,i.representationString(),i.representationStart,i.representationEnd,{value:String.fromCharCode(r)}]);case M:case z:case K:case J:case Q:case Z:case _:case j:case G:case X:return consumeNumericToken(C,i);case v:case c:case p:case s:case H:return consumeWhiteSpace(0,i);case l:return checkIfThreeCodePointsWouldStartANumber(0,i)?consumeNumericToken(C,i):checkIfThreeCodePointsWouldStartCDC(0,i)?(i.readCodePoint(3),[e.CDC,i.representationString(),i.representationStart,i.representationEnd,void 0]):checkIfThreeCodePointsWouldStartAnIdentSequence(0,i)?consumeIdentLikeToken(C,i):(i.readCodePoint(),[e.Delim,i.representationString(),i.representationStart,i.representationEnd,{value:"-"}]);case I:return checkIfFourCodePointsWouldStartCDO(0,i)?(i.readCodePoint(4),[e.CDO,i.representationString(),i.representationStart,i.representationEnd,void 0]):(i.readCodePoint(),[e.Delim,i.representationString(),i.representationStart,i.representationEnd,{value:"<"}]);case u:if(i.readCodePoint(),checkIfThreeCodePointsWouldStartAnIdentSequence(0,i)){const r=consumeIdentSequence(C,i);return[e.AtKeyword,i.representationString(),i.representationStart,i.representationEnd,{value:String.fromCharCode(...r)}]}return[e.Delim,i.representationString(),i.representationStart,i.representationEnd,{value:"@"}];case y:return checkIfTwoCodePointsAreAValidEscape(0,i)?consumeIdentLikeToken(C,i):(i.readCodePoint(),C.onParseError({message:'Invalid escape sequence after "\\"',start:i.representationStart,end:i.representationEnd,state:["4.3.1. Consume a token","U+005C REVERSE SOLIDUS (\\)","The input stream does not start with a valid escape sequence"]}),[e.Delim,i.representationString(),i.representationStart,i.representationEnd,{value:"\\"}])}return i.readCodePoint(),[e.Delim,i.representationString(),i.representationStart,i.representationEnd,{value:String.fromCharCode(r)}]},endOfFile:function endOfFile(){return void 0===i.codePointSource[i.cursor]}}}function cloneTokens(e){return"undefined"!=typeof globalThis&&"structuredClone"in globalThis?structuredClone(e):JSON.parse(JSON.stringify(e))}export{r as NumberType,Reader,e as TokenType,cloneTokens,isToken,mirrorVariantType,stringify,tokenizer};
