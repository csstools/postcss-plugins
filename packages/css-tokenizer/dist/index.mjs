class Reader{cursor;source="";codePointSource=[];length=0;representationStart=0;representationEnd=-1;constructor(e){this.cursor=0,this.source=e,this.length=e.length,this.codePointSource=new Array(this.length);for(let e=0;e<this.length;e++)this.codePointSource[e]=this.source.charCodeAt(e)}cursorPositionOfLastReadCodePoint(){return this.cursor-1}advanceCodePoint(e=1){this.cursor+=e,this.representationEnd=this.cursor-1}readCodePoint(e=1){const n=this.codePointSource[this.cursor];return void 0!==n&&(this.cursor+=e,this.representationEnd=this.cursor-1,n)}unreadCodePoint(e=1){return 0!==this.cursor&&(this.cursor-=e,this.representationEnd=this.cursor-1,!0)}}var e,n,t;function mirrorVariantType(n){switch(n){case e.OpenParen:return e.CloseParen;case e.CloseParen:return e.OpenParen;case e.OpenCurly:return e.CloseCurly;case e.CloseCurly:return e.OpenCurly;case e.OpenSquare:return e.CloseSquare;case e.CloseSquare:return e.OpenSquare;default:return null}}function isToken(n){return!!Array.isArray(n)&&(!(n.length<4)&&(n[0]in e&&("string"==typeof n[1]&&("number"==typeof n[2]&&"number"==typeof n[3]))))}function stringify(...e){let n="";for(let t=0;t<e.length;t++)n+=e[t][1];return n}!function(e){e.Comment="comment",e.AtKeyword="at-keyword-token",e.BadString="bad-string-token",e.BadURL="bad-url-token",e.CDC="CDC-token",e.CDO="CDO-token",e.Colon="colon-token",e.Comma="comma-token",e.Delim="delim-token",e.Dimension="dimension-token",e.EOF="EOF-token",e.Function="function-token",e.Hash="hash-token",e.Ident="ident-token",e.Number="number-token",e.Percentage="percentage-token",e.Semicolon="semicolon-token",e.String="string-token",e.URL="url-token",e.Whitespace="whitespace-token",e.OpenParen="(-token",e.CloseParen=")-token",e.OpenSquare="[-token",e.CloseSquare="]-token",e.OpenCurly="{-token",e.CloseCurly="}-token"}(e||(e={})),function(e){e.Integer="integer",e.Number="number"}(n||(n={})),function(e){e.Unrestricted="unrestricted",e.ID="id"}(t||(t={}));const o=45,r=65533;function checkIfFourCodePointsWouldStartCDO(e,n){return 60===n.codePointSource[n.cursor]&&33===n.codePointSource[n.cursor+1]&&n.codePointSource[n.cursor+2]===o&&n.codePointSource[n.cursor+3]===o}function isDigitCodePoint(e){return e>=48&&e<=57}function isUppercaseLetterCodePoint(e){return e>=65&&e<=90}function isLowercaseLetterCodePoint(e){return e>=97&&e<=122}function isHexDigitCodePoint(e){return isDigitCodePoint(e)||e>=97&&e<=102||e>=65&&e<=70}function isLetterCodePoint(e){return isLowercaseLetterCodePoint(e)||isUppercaseLetterCodePoint(e)}function isNonASCIICodePoint(e){return e>=128}function isIdentStartCodePoint(e){return isLetterCodePoint(e)||isNonASCIICodePoint(e)||95===e}function isIdentCodePoint(e){return isIdentStartCodePoint(e)||isDigitCodePoint(e)||e===o}function isNewLine(e){return 10===e||13===e||12===e}function isWhitespace(e){return 32===e||10===e||9===e||13===e||12===e}function checkIfTwoCodePointsAreAValidEscape(e,n){return 92===n.codePointSource[n.cursor]&&10!==n.codePointSource[n.cursor+1]}function checkIfThreeCodePointsWouldStartAnIdentSequence(e,n){return n.codePointSource[n.cursor]===o?n.codePointSource[n.cursor+1]===o||(!!isIdentStartCodePoint(n.codePointSource[n.cursor+1])||92===n.codePointSource[n.cursor+1]&&10!==n.codePointSource[n.cursor+2]):!!isIdentStartCodePoint(n.codePointSource[n.cursor])||checkIfTwoCodePointsAreAValidEscape(0,n)}function checkIfThreeCodePointsWouldStartANumber(e,n){return 43===n.codePointSource[n.cursor]||n.codePointSource[n.cursor]===o?!!isDigitCodePoint(n.codePointSource[n.cursor+1])||46===n.codePointSource[n.cursor+1]&&isDigitCodePoint(n.codePointSource[n.cursor+2]):46===n.codePointSource[n.cursor]?isDigitCodePoint(n.codePointSource[n.cursor+1]):!!isDigitCodePoint(n.codePointSource[n.cursor])}function checkIfTwoCodePointsStartAComment(e,n){return 47===n.codePointSource[n.cursor]&&42===n.codePointSource[n.cursor+1]}function checkIfThreeCodePointsWouldStartCDC(e,n){return n.codePointSource[n.cursor]===o&&n.codePointSource[n.cursor+1]===o&&62===n.codePointSource[n.cursor+2]}function consumeComment(n,t){for(t.advanceCodePoint(2);;){const e=t.readCodePoint();if(!1===e){n.onParseError({message:"Unexpected EOF while consuming a comment.",start:t.representationStart,end:t.representationEnd,state:["4.3.2. Consume comments","Unexpected EOF"]});break}if(42===e&&(void 0!==t.codePointSource[t.cursor]&&47===t.codePointSource[t.cursor])){t.advanceCodePoint();break}}return[e.Comment,t.source.slice(t.representationStart,t.representationEnd+1),t.representationStart,t.representationEnd,void 0]}function consumeEscapedCodePoint(e,n){const t=n.readCodePoint();if(!1===t)return e.onParseError({message:"Unexpected EOF while consuming an escaped code point.",start:n.representationStart,end:n.representationEnd,state:["4.3.7. Consume an escaped code point","Unexpected EOF"]}),r;if(isHexDigitCodePoint(t)){const e=[t];for(;void 0!==n.codePointSource[n.cursor]&&isHexDigitCodePoint(n.codePointSource[n.cursor])&&e.length<6;)e.push(n.codePointSource[n.cursor]),n.advanceCodePoint();isWhitespace(n.codePointSource[n.cursor])&&n.advanceCodePoint();const i=parseInt(String.fromCharCode(...e),16);return 0===i?r:(o=i)>=55296&&o<=57343||i>1114111?r:i}var o;return t}function consumeIdentSequence(e,n){const t=[];for(;;)if(isIdentCodePoint(n.codePointSource[n.cursor]))t.push(n.codePointSource[n.cursor]),n.advanceCodePoint();else{if(!checkIfTwoCodePointsAreAValidEscape(0,n))return t;n.advanceCodePoint(),t.push(consumeEscapedCodePoint(e,n))}}function consumeHashToken(n,o){if(o.advanceCodePoint(),void 0!==o.codePointSource[o.cursor]&&isIdentCodePoint(o.codePointSource[o.cursor])||checkIfTwoCodePointsAreAValidEscape(0,o)){let r=t.Unrestricted;checkIfThreeCodePointsWouldStartAnIdentSequence(0,o)&&(r=t.ID);const i=consumeIdentSequence(n,o);return[e.Hash,o.source.slice(o.representationStart,o.representationEnd+1),o.representationStart,o.representationEnd,{value:String.fromCharCode(...i),type:r}]}return[e.Delim,"#",o.representationStart,o.representationEnd,{value:"#"}]}function consumeNumber(e,t){let r=n.Integer;for(43!==t.codePointSource[t.cursor]&&t.codePointSource[t.cursor]!==o||t.advanceCodePoint();isDigitCodePoint(t.codePointSource[t.cursor]);)t.advanceCodePoint();if(46===t.codePointSource[t.cursor]&&isDigitCodePoint(t.codePointSource[t.cursor+1]))for(t.advanceCodePoint(2),r=n.Number;isDigitCodePoint(t.codePointSource[t.cursor]);)t.advanceCodePoint();if((101===t.codePointSource[t.cursor]||69===t.codePointSource[t.cursor])&&isDigitCodePoint(t.codePointSource[t.cursor+1]))for(t.advanceCodePoint(2),r=n.Number;isDigitCodePoint(t.codePointSource[t.cursor]);)t.advanceCodePoint();if((101===t.codePointSource[t.cursor]||69===t.codePointSource[t.cursor])&&(t.codePointSource[t.cursor+1]===o||43===t.codePointSource[t.cursor+1])&&isDigitCodePoint(t.codePointSource[t.cursor+2]))for(t.advanceCodePoint(3),r=n.Number;isDigitCodePoint(t.codePointSource[t.cursor]);)t.advanceCodePoint();return[parseFloat(t.source.slice(t.representationStart,t.representationEnd+1)),r]}function consumeNumericToken(n,t){const o=consumeNumber(0,t);if(checkIfThreeCodePointsWouldStartAnIdentSequence(0,t)){const r=consumeIdentSequence(n,t);return[e.Dimension,t.source.slice(t.representationStart,t.representationEnd+1),t.representationStart,t.representationEnd,{value:o[0],type:o[1],unit:String.fromCharCode(...r)}]}return 37===t.codePointSource[t.cursor]?(t.advanceCodePoint(),[e.Percentage,t.source.slice(t.representationStart,t.representationEnd+1),t.representationStart,t.representationEnd,{value:o[0]}]):[e.Number,t.source.slice(t.representationStart,t.representationEnd+1),t.representationStart,t.representationEnd,{value:o[0],type:o[1]}]}function consumeWhiteSpace(n,t){for(;isWhitespace(t.codePointSource[t.cursor]);)t.advanceCodePoint();return[e.Whitespace,t.source.slice(t.representationStart,t.representationEnd+1),t.representationStart,t.representationEnd,void 0]}function consumeStringToken(n,t){let o="";const r=t.readCodePoint();for(;;){const i=t.readCodePoint();if(!1===i)return n.onParseError({message:"Unexpected EOF while consuming a string token.",start:t.representationStart,end:t.representationEnd,state:["4.3.5. Consume a string token","Unexpected EOF"]}),[e.String,t.source.slice(t.representationStart,t.representationEnd+1),t.representationStart,t.representationEnd,{value:o}];if(isNewLine(i))return n.onParseError({message:"Unexpected newline while consuming a string token.",start:t.representationStart,end:t.representationEnd,state:["4.3.5. Consume a string token","Unexpected newline"]}),t.unreadCodePoint(),[e.BadString,t.source.slice(t.representationStart,t.representationEnd+1),t.representationStart,t.representationEnd,void 0];if(i===r)return[e.String,t.source.slice(t.representationStart,t.representationEnd+1),t.representationStart,t.representationEnd,{value:o}];if(92!==i)o+=String.fromCharCode(i);else{if(void 0===t.codePointSource[t.cursor])continue;if(isNewLine(t.codePointSource[t.cursor])){t.advanceCodePoint();continue}o+=String.fromCharCode(consumeEscapedCodePoint(n,t))}}}const i="u".charCodeAt(0),c="U".charCodeAt(0),s="r".charCodeAt(0),a="R".charCodeAt(0),u="l".charCodeAt(0),d="L".charCodeAt(0);function checkIfCodePointsMatchURLIdent(e,n){return 3===n.length&&((n[0]===i||n[0]===c)&&((n[1]===s||n[1]===a)&&(n[2]===u||n[2]===d)))}function consumeBadURL(e,n){for(;;){if(void 0===n.codePointSource[n.cursor])return;if(41===n.codePointSource[n.cursor])return void n.advanceCodePoint();checkIfTwoCodePointsAreAValidEscape(0,n)?(n.advanceCodePoint(),consumeEscapedCodePoint(e,n)):n.advanceCodePoint()}}function consumeUrlToken(n,t){consumeWhiteSpace(0,t);let o="";for(;;){if(void 0===t.codePointSource[t.cursor])return n.onParseError({message:"Unexpected EOF while consuming a url token.",start:t.representationStart,end:t.representationEnd,state:["4.3.6. Consume a url token","Unexpected EOF"]}),[e.URL,t.source.slice(t.representationStart,t.representationEnd+1),t.representationStart,t.representationEnd,{value:o}];if(41===t.codePointSource[t.cursor])return t.advanceCodePoint(),[e.URL,t.source.slice(t.representationStart,t.representationEnd+1),t.representationStart,t.representationEnd,{value:o}];if(isWhitespace(t.codePointSource[t.cursor]))return consumeWhiteSpace(0,t),void 0===t.codePointSource[t.cursor]?(n.onParseError({message:"Unexpected EOF while consuming a url token.",start:t.representationStart,end:t.representationEnd,state:["4.3.6. Consume a url token","Consume as much whitespace as possible","Unexpected EOF"]}),[e.URL,t.source.slice(t.representationStart,t.representationEnd+1),t.representationStart,t.representationEnd,{value:o}]):41===t.codePointSource[t.cursor]?(t.advanceCodePoint(),[e.URL,t.source.slice(t.representationStart,t.representationEnd+1),t.representationStart,t.representationEnd,{value:o}]):(consumeBadURL(n,t),[e.BadURL,t.source.slice(t.representationStart,t.representationEnd+1),t.representationStart,t.representationEnd,void 0]);if(34===t.codePointSource[t.cursor]||39===t.codePointSource[t.cursor]||40===t.codePointSource[t.cursor]||(11===(r=t.codePointSource[t.cursor])||127===r||0<=r&&r<=8||14<=r&&r<=31))return consumeBadURL(n,t),n.onParseError({message:"Unexpected character while consuming a url token.",start:t.representationStart,end:t.representationEnd,state:["4.3.6. Consume a url token","Unexpected U+0022 QUOTATION MARK (\"), U+0027 APOSTROPHE ('), U+0028 LEFT PARENTHESIS (() or non-printable code point"]}),[e.BadURL,t.source.slice(t.representationStart,t.representationEnd+1),t.representationStart,t.representationEnd,void 0];if(92===t.codePointSource[t.cursor]){if(checkIfTwoCodePointsAreAValidEscape(0,t)){o+=String.fromCharCode(consumeEscapedCodePoint(n,t));continue}return consumeBadURL(n,t),n.onParseError({message:"Invalid escape sequence while consuming a url token.",start:t.representationStart,end:t.representationEnd,state:["4.3.6. Consume a url token","U+005C REVERSE SOLIDUS (\\)","The input stream does not start with a valid escape sequence"]}),[e.BadURL,t.source.slice(t.representationStart,t.representationEnd+1),t.representationStart,t.representationEnd,void 0]}o+=String.fromCharCode(t.codePointSource[t.cursor]),t.advanceCodePoint()}var r}function consumeIdentLikeToken(n,t){const o=consumeIdentSequence(n,t);if(40!==t.codePointSource[t.cursor])return[e.Ident,t.source.slice(t.representationStart,t.representationEnd+1),t.representationStart,t.representationEnd,{value:String.fromCharCode(...o)}];if(checkIfCodePointsMatchURLIdent(0,o)){t.advanceCodePoint();let r=0;for(;;){const n=isWhitespace(t.codePointSource[t.cursor]),i=isWhitespace(t.codePointSource[t.cursor+1]);if(n&&i){r+=1,t.advanceCodePoint(1);continue}const c=n?t.codePointSource[t.cursor+1]:t.codePointSource[t.cursor];if(34===c||39===c)return[e.Function,t.source.slice(t.representationStart,t.representationEnd+1),t.representationStart,t.representationEnd,{value:String.fromCharCode(...o)}];break}return r>0&&t.advanceCodePoint(r),consumeUrlToken(n,t)}return t.advanceCodePoint(),[e.Function,t.source.slice(t.representationStart,t.representationEnd+1),t.representationStart,t.representationEnd,{value:String.fromCharCode(...o)}]}function tokenizer(n,t){const r=n.css.valueOf(),i=new Reader(r),c={onParseError:(null==t?void 0:t.onParseError)??(()=>{})};return{nextToken:function nextToken(){if(i.representationStart=i.cursor,i.representationEnd=-1,checkIfTwoCodePointsStartAComment(0,i)){if(null!=t&&t.commentsAreTokens)return consumeComment(c,i);consumeComment(c,i),i.representationStart=i.cursor,i.representationEnd=-1}const n=i.codePointSource[i.cursor];if(void 0===n)return[e.EOF,"",-1,-1,void 0];if(isIdentStartCodePoint(n))return consumeIdentLikeToken(c,i);if(isDigitCodePoint(n))return consumeNumericToken(c,i);switch(n){case 44:return i.advanceCodePoint(),[e.Comma,",",i.representationStart,i.representationEnd,void 0];case 58:return i.advanceCodePoint(),[e.Colon,":",i.representationStart,i.representationEnd,void 0];case 59:return i.advanceCodePoint(),[e.Semicolon,";",i.representationStart,i.representationEnd,void 0];case 40:return i.advanceCodePoint(),[e.OpenParen,"(",i.representationStart,i.representationEnd,void 0];case 41:return i.advanceCodePoint(),[e.CloseParen,")",i.representationStart,i.representationEnd,void 0];case 91:return i.advanceCodePoint(),[e.OpenSquare,"[",i.representationStart,i.representationEnd,void 0];case 93:return i.advanceCodePoint(),[e.CloseSquare,"]",i.representationStart,i.representationEnd,void 0];case 123:return i.advanceCodePoint(),[e.OpenCurly,"{",i.representationStart,i.representationEnd,void 0];case 125:return i.advanceCodePoint(),[e.CloseCurly,"}",i.representationStart,i.representationEnd,void 0];case 39:case 34:return consumeStringToken(c,i);case 35:return consumeHashToken(c,i);case 43:case 46:return checkIfThreeCodePointsWouldStartANumber(0,i)?consumeNumericToken(c,i):(i.advanceCodePoint(),[e.Delim,i.source[i.representationStart],i.representationStart,i.representationEnd,{value:i.source[i.representationStart]}]);case 10:case 13:case 12:case 9:case 32:return consumeWhiteSpace(0,i);case o:return checkIfThreeCodePointsWouldStartANumber(0,i)?consumeNumericToken(c,i):checkIfThreeCodePointsWouldStartCDC(0,i)?(i.advanceCodePoint(3),[e.CDC,"--\x3e",i.representationStart,i.representationEnd,void 0]):checkIfThreeCodePointsWouldStartAnIdentSequence(0,i)?consumeIdentLikeToken(c,i):(i.advanceCodePoint(),[e.Delim,"-",i.representationStart,i.representationEnd,{value:"-"}]);case 60:return checkIfFourCodePointsWouldStartCDO(0,i)?(i.advanceCodePoint(4),[e.CDO,"\x3c!--",i.representationStart,i.representationEnd,void 0]):(i.advanceCodePoint(),[e.Delim,"<",i.representationStart,i.representationEnd,{value:"<"}]);case 64:if(i.advanceCodePoint(),checkIfThreeCodePointsWouldStartAnIdentSequence(0,i)){const n=consumeIdentSequence(c,i);return[e.AtKeyword,i.source.slice(i.representationStart,i.representationEnd+1),i.representationStart,i.representationEnd,{value:String.fromCharCode(...n)}]}return[e.Delim,"@",i.representationStart,i.representationEnd,{value:"@"}];case 92:return checkIfTwoCodePointsAreAValidEscape(0,i)?consumeIdentLikeToken(c,i):(i.advanceCodePoint(),c.onParseError({message:'Invalid escape sequence after "\\"',start:i.representationStart,end:i.representationEnd,state:["4.3.1. Consume a token","U+005C REVERSE SOLIDUS (\\)","The input stream does not start with a valid escape sequence"]}),[e.Delim,"\\",i.representationStart,i.representationEnd,{value:"\\"}])}return i.advanceCodePoint(),[e.Delim,i.source[i.representationStart],i.representationStart,i.representationEnd,{value:i.source[i.representationStart]}]},endOfFile:function endOfFile(){return void 0===i.codePointSource[i.cursor]}}}function cloneTokens(e){return"undefined"!=typeof globalThis&&"structuredClone"in globalThis?structuredClone(e):JSON.parse(JSON.stringify(e))}function mutateIdent(e,n){let t="";const r=new Array(n.length);for(let e=0;e<n.length;e++)r[e]=n.charCodeAt(e);let i=0;r[0]===o&&r[1]===o?(t="--",i=2):r[0]===o&&r[1]?(t="-",i=2,isIdentStartCodePoint(r[1])?t+=n[1]:t+=`\\${r[1].toString(16)} `):isIdentStartCodePoint(r[0])?(t=n[0],i=1):(t=`\\${r[0].toString(16)} `,i=1);for(let e=i;e<r.length;e++)isIdentCodePoint(r[e])?t+=n[e]:t+=`\\${r[e].toString(16)} `;e[1]=t,e[4].value=n}export{n as NumberType,Reader,e as TokenType,cloneTokens,isToken,mirrorVariantType,mutateIdent,stringify,tokenizer};
