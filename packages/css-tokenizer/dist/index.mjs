class Reader{cursor;source="";codePointSource=[];length=0;representationStart=0;representationEnd=-1;constructor(e){this.cursor=0,this.source=e,this.length=e.length,this.codePointSource=[];for(let t=0;t<e.length;t++)this.codePointSource.push(e.charCodeAt(t))}cursorPositionOfLastReadCodePoint(){return this.cursor-1}advanceCodePoint(e=1){this.cursor+=e,this.representationEnd=this.cursor-1}readCodePoint(e=1){const t=this.codePointSource[this.cursor];return void 0!==t&&(this.cursor+=e,this.representationEnd=this.cursor-1,t)}unreadCodePoint(e=1){return 0!==this.cursor&&(this.cursor-=e,this.representationEnd=this.cursor-1,!0)}}var e,t,o;function mirrorVariantType(t){switch(t){case e.OpenParen:return e.CloseParen;case e.CloseParen:return e.OpenParen;case e.OpenCurly:return e.CloseCurly;case e.CloseCurly:return e.OpenCurly;case e.OpenSquare:return e.CloseSquare;case e.CloseSquare:return e.OpenSquare;default:return null}}function isToken(t){return!!Array.isArray(t)&&(!(t.length<4)&&(t[0]in e&&("string"==typeof t[1]&&("number"==typeof t[2]&&"number"==typeof t[3]))))}function stringify(...e){let t="";for(let o=0;o<e.length;o++)t+=e[o][1];return t}!function(e){e.Comment="comment",e.AtKeyword="at-keyword-token",e.BadString="bad-string-token",e.BadURL="bad-url-token",e.CDC="CDC-token",e.CDO="CDO-token",e.Colon="colon-token",e.Comma="comma-token",e.Delim="delim-token",e.Dimension="dimension-token",e.EOF="EOF-token",e.Function="function-token",e.Hash="hash-token",e.Ident="ident-token",e.Number="number-token",e.Percentage="percentage-token",e.Semicolon="semicolon-token",e.String="string-token",e.URL="url-token",e.Whitespace="whitespace-token",e.OpenParen="(-token",e.CloseParen=")-token",e.OpenSquare="[-token",e.CloseSquare="]-token",e.OpenCurly="{-token",e.CloseCurly="}-token"}(e||(e={})),function(e){e.Integer="integer",e.Number="number"}(t||(t={})),function(e){e.Unrestricted="unrestricted",e.ID="id"}(o||(o={}));const r="'".charCodeAt(0),n="*".charCodeAt(0),i="\b".charCodeAt(0),c="\r".charCodeAt(0),s="\t".charCodeAt(0),a=":".charCodeAt(0),d=",".charCodeAt(0),u="@".charCodeAt(0),C="".charCodeAt(0),p="!".charCodeAt(0),S="\f".charCodeAt(0),P=".".charCodeAt(0),h=">".charCodeAt(0),l="-".charCodeAt(0),f="".charCodeAt(0),m="E".charCodeAt(0),E="e".charCodeAt(0),v="{".charCodeAt(0),g="(".charCodeAt(0),A="[".charCodeAt(0),k="<".charCodeAt(0),I="\n".charCodeAt(0),T="\v".charCodeAt(0),D="_".charCodeAt(0),U="􏿿".charCodeAt(0),O="\0".charCodeAt(0),w="#".charCodeAt(0),L="%".charCodeAt(0),b="+".charCodeAt(0),N='"'.charCodeAt(0),R="�".charCodeAt(0),y="\\".charCodeAt(0),W="}".charCodeAt(0),q=")".charCodeAt(0),x="]".charCodeAt(0),F=";".charCodeAt(0),V="".charCodeAt(0),B="/".charCodeAt(0),H=" ".charCodeAt(0);function checkIfFourCodePointsWouldStartCDO(e,t){return t.codePointSource[t.cursor]===k&&t.codePointSource[t.cursor+1]===p&&t.codePointSource[t.cursor+2]===l&&t.codePointSource[t.cursor+3]===l}const M="0".charCodeAt(0),z="9".charCodeAt(0);function isDigitCodePoint(e){return M<=e&&e<=z}const K="A".charCodeAt(0),J="Z".charCodeAt(0);function isUppercaseLetterCodePoint(e){return K<=e&&e<=J}const Q="a".charCodeAt(0),Z="z".charCodeAt(0);function isLowercaseLetterCodePoint(e){return Q<=e&&e<=Z}const _="F".charCodeAt(0),j="f".charCodeAt(0);function isHexDigitCodePoint(e){return M<=e&&e<=z||(Q<=e&&e<=j||K<=e&&e<=_)}function isLetterCodePoint(e){return isLowercaseLetterCodePoint(e)||isUppercaseLetterCodePoint(e)}const G="".charCodeAt(0);function isNonASCIICodePoint(e){return e>=G}function isIdentStartCodePoint(e){return!!isLetterCodePoint(e)||(!!isNonASCIICodePoint(e)||e===D)}function isIdentCodePoint(e){return!!isIdentStartCodePoint(e)||(!!isDigitCodePoint(e)||e===l)}function isNewLine(e){switch(e){case I:case c:case S:return!0;default:return!1}}function isWhitespace(e){switch(e){case I:case c:case S:case s:case H:return!0;default:return!1}}const X="\ud800".charCodeAt(0),Y="\udfff".charCodeAt(0);function checkIfTwoCodePointsAreAValidEscape(e,t){return t.codePointSource[t.cursor]===y&&t.codePointSource[t.cursor+1]!==I}function checkIfThreeCodePointsWouldStartAnIdentSequence(e,t){return t.codePointSource[t.cursor]===l?t.codePointSource[t.cursor+1]===l||(!!isIdentStartCodePoint(t.codePointSource[t.cursor+1])||t.codePointSource[t.cursor+1]===y&&t.codePointSource[t.cursor+2]!==I):!!isIdentStartCodePoint(t.codePointSource[t.cursor])||checkIfTwoCodePointsAreAValidEscape(0,t)}function checkIfThreeCodePointsWouldStartANumber(e,t){return t.codePointSource[t.cursor]===b||t.codePointSource[t.cursor]===l?!!isDigitCodePoint(t.codePointSource[t.cursor+1])||t.codePointSource[t.cursor+1]===P&&isDigitCodePoint(t.codePointSource[t.cursor+2]):t.codePointSource[t.cursor]===P?isDigitCodePoint(t.codePointSource[t.cursor+1]):!!isDigitCodePoint(t.codePointSource[t.cursor])}function checkIfTwoCodePointsStartAComment(e,t){return t.codePointSource[t.cursor]===B&&t.codePointSource[t.cursor+1]===n}function checkIfThreeCodePointsWouldStartCDC(e,t){return t.codePointSource[t.cursor]===l&&t.codePointSource[t.cursor+1]===l&&t.codePointSource[t.cursor+2]===h}function consumeComment(t,o){for(o.advanceCodePoint(2);;){const e=o.readCodePoint();if(!1===e){t.onParseError({message:"Unexpected EOF while consuming a comment.",start:o.representationStart,end:o.representationEnd,state:["4.3.2. Consume comments","Unexpected EOF"]});break}if(e===n&&(void 0!==o.codePointSource[o.cursor]&&o.codePointSource[o.cursor]===B)){o.advanceCodePoint();break}}return[e.Comment,o.source.slice(o.representationStart,o.representationEnd+1),o.representationStart,o.representationEnd,void 0]}function consumeEscapedCodePoint(e,t){const o=t.readCodePoint();if(!1===o)return e.onParseError({message:"Unexpected EOF while consuming an escaped code point.",start:t.representationStart,end:t.representationEnd,state:["4.3.7. Consume an escaped code point","Unexpected EOF"]}),R;if(isHexDigitCodePoint(o)){const e=[o];for(;void 0!==t.codePointSource[t.cursor]&&isHexDigitCodePoint(t.codePointSource[t.cursor])&&e.length<6;)e.push(t.codePointSource[t.cursor]),t.advanceCodePoint();isWhitespace(t.codePointSource[t.cursor])&&t.advanceCodePoint();const n=parseInt(String.fromCharCode(...e),16);return 0===n?R:X<=(r=n)&&r<=Y||n>U?R:n}var r;return o}function consumeIdentSequence(e,t){const o=[];for(;;)if(isIdentCodePoint(t.codePointSource[t.cursor]))o.push(t.codePointSource[t.cursor]),t.advanceCodePoint();else{if(!checkIfTwoCodePointsAreAValidEscape(0,t))return o;t.advanceCodePoint(),o.push(consumeEscapedCodePoint(e,t))}}function consumeHashToken(t,r){if(r.advanceCodePoint(),void 0!==r.codePointSource[r.cursor]&&isIdentCodePoint(r.codePointSource[r.cursor])||checkIfTwoCodePointsAreAValidEscape(0,r)){let n=o.Unrestricted;checkIfThreeCodePointsWouldStartAnIdentSequence(0,r)&&(n=o.ID);const i=consumeIdentSequence(t,r);return[e.Hash,r.source.slice(r.representationStart,r.representationEnd+1),r.representationStart,r.representationEnd,{value:String.fromCharCode(...i),type:n}]}return[e.Delim,"#",r.representationStart,r.representationEnd,{value:"#"}]}function consumeNumber(e,o){let r=t.Integer;const n=[];{o.codePointSource[o.cursor]!==b&&o.codePointSource[o.cursor]!==l||(n.push(o.codePointSource[o.cursor]),o.advanceCodePoint());const e=consumeDigits(o);for(let t=0;t<e.length;t++)n.push(e[t])}if(o.codePointSource[o.cursor]===P&&isDigitCodePoint(o.codePointSource[o.cursor+1])){n.push(o.codePointSource[o.cursor]),n.push(o.codePointSource[o.cursor+1]),o.advanceCodePoint(2),r=t.Number;const e=consumeDigits(o);for(let t=0;t<e.length;t++)n.push(e[t])}if((o.codePointSource[o.cursor]===E||o.codePointSource[o.cursor]===m)&&isDigitCodePoint(o.codePointSource[o.cursor+1])){n.push(o.codePointSource[o.cursor]),n.push(o.codePointSource[o.cursor+1]),o.advanceCodePoint(2),r=t.Number;const e=consumeDigits(o);for(let t=0;t<e.length;t++)n.push(e[t])}if((o.codePointSource[o.cursor]===E||o.codePointSource[o.cursor]===m)&&(o.codePointSource[o.cursor+1]===l||o.codePointSource[o.cursor+1]===b)&&isDigitCodePoint(o.codePointSource[o.cursor+2])){n.push(o.codePointSource[o.cursor]),n.push(o.codePointSource[o.cursor+1]),n.push(o.codePointSource[o.cursor+2]),o.advanceCodePoint(3),r=t.Number;const e=consumeDigits(o);for(let t=0;t<e.length;t++)n.push(e[t])}return[convertCodePointsToNumber(n),r]}function consumeDigits(e){const t=[];for(;;){if(void 0===e.codePointSource[e.cursor])return t;if(!isDigitCodePoint(e.codePointSource[e.cursor]))return t;t.push(e.codePointSource[e.cursor]),e.advanceCodePoint()}}function convertCodePointsToNumber(e){let t=1;const o=[];let r=0,n=0;const i=[];let c=0,s=1;const a=[];let d=0,u=0;for(e[u]===l?(u++,t=-1):e[u]===b&&u++;u<e.length&&isDigitCodePoint(e[u]);)o.push(e[u]),u++;for(r=digitCodePointsToInteger(o),e[u]===P&&u++;u<e.length&&isDigitCodePoint(e[u]);)i.push(e[u]),u++;for(n=i.length,c=digitCodePointsToInteger(i)/Math.pow(10,n),e[u]!==E&&e[u]!==m||u++,e[u]===l?(u++,s=-1):e[u]===b&&u++;u<e.length&&isDigitCodePoint(e[u]);)a.push(e[u]),u++;return d=digitCodePointsToInteger(a),t*(r+c)*Math.pow(10,s*d)}function digitCodePointsToInteger(e){return 0===e.length?0:Number.parseInt(String.fromCharCode(...e),10)}function consumeNumericToken(t,o){const r=consumeNumber(0,o);if(checkIfThreeCodePointsWouldStartAnIdentSequence(0,o)){const n=consumeIdentSequence(t,o);return[e.Dimension,o.source.slice(o.representationStart,o.representationEnd+1),o.representationStart,o.representationEnd,{value:r[0],type:r[1],unit:String.fromCharCode(...n)}]}return o.codePointSource[o.cursor]===L?(o.advanceCodePoint(),[e.Percentage,o.source.slice(o.representationStart,o.representationEnd+1),o.representationStart,o.representationEnd,{value:r[0]}]):[e.Number,o.source.slice(o.representationStart,o.representationEnd+1),o.representationStart,o.representationEnd,{value:r[0],type:r[1]}]}function consumeWhiteSpace(t,o){for(;isWhitespace(o.codePointSource[o.cursor]);)o.advanceCodePoint();return[e.Whitespace,o.source.slice(o.representationStart,o.representationEnd+1),o.representationStart,o.representationEnd,void 0]}function consumeStringToken(t,o){let r="";const n=o.readCodePoint();for(;;){const i=o.readCodePoint();if(!1===i)return t.onParseError({message:"Unexpected EOF while consuming a string token.",start:o.representationStart,end:o.representationEnd,state:["4.3.5. Consume a string token","Unexpected EOF"]}),[e.String,o.source.slice(o.representationStart,o.representationEnd+1),o.representationStart,o.representationEnd,{value:r}];if(isNewLine(i))return t.onParseError({message:"Unexpected newline while consuming a string token.",start:o.representationStart,end:o.representationEnd,state:["4.3.5. Consume a string token","Unexpected newline"]}),o.unreadCodePoint(),[e.BadString,o.source.slice(o.representationStart,o.representationEnd+1),o.representationStart,o.representationEnd,void 0];if(i===n)return[e.String,o.source.slice(o.representationStart,o.representationEnd+1),o.representationStart,o.representationEnd,{value:r}];if(i!==y)r+=String.fromCharCode(i);else{if(void 0===o.codePointSource[o.cursor])continue;if(isNewLine(o.codePointSource[o.cursor])){o.advanceCodePoint();continue}r+=String.fromCharCode(consumeEscapedCodePoint(t,o))}}}const $="u".charCodeAt(0),ee="U".charCodeAt(0),te="r".charCodeAt(0),oe="R".charCodeAt(0),re="l".charCodeAt(0),ne="L".charCodeAt(0);function checkIfCodePointsMatchURLIdent(e,t){return 3===t.length&&((t[0]===$||t[0]===ee)&&((t[1]===te||t[1]===oe)&&(t[2]===re||t[2]===ne)))}function consumeBadURL(e,t){for(;;){if(void 0===t.codePointSource[t.cursor])return;if(t.codePointSource[t.cursor]===q)return void t.advanceCodePoint();checkIfTwoCodePointsAreAValidEscape(0,t)?(t.advanceCodePoint(),consumeEscapedCodePoint(e,t)):t.advanceCodePoint()}}function consumeUrlToken(t,o){consumeWhiteSpace(0,o);let n="";for(;;){if(void 0===o.codePointSource[o.cursor])return t.onParseError({message:"Unexpected EOF while consuming a url token.",start:o.representationStart,end:o.representationEnd,state:["4.3.6. Consume a url token","Unexpected EOF"]}),[e.URL,o.source.slice(o.representationStart,o.representationEnd+1),o.representationStart,o.representationEnd,{value:n}];if(o.codePointSource[o.cursor]===q)return o.advanceCodePoint(),[e.URL,o.source.slice(o.representationStart,o.representationEnd+1),o.representationStart,o.representationEnd,{value:n}];if(isWhitespace(o.codePointSource[o.cursor]))return consumeWhiteSpace(0,o),void 0===o.codePointSource[o.cursor]?(t.onParseError({message:"Unexpected EOF while consuming a url token.",start:o.representationStart,end:o.representationEnd,state:["4.3.6. Consume a url token","Consume as much whitespace as possible","Unexpected EOF"]}),[e.URL,o.source.slice(o.representationStart,o.representationEnd+1),o.representationStart,o.representationEnd,{value:n}]):o.codePointSource[o.cursor]===q?(o.advanceCodePoint(),[e.URL,o.source.slice(o.representationStart,o.representationEnd+1),o.representationStart,o.representationEnd,{value:n}]):(consumeBadURL(t,o),[e.BadURL,o.source.slice(o.representationStart,o.representationEnd+1),o.representationStart,o.representationEnd,void 0]);if(o.codePointSource[o.cursor]===N||o.codePointSource[o.cursor]===r||o.codePointSource[o.cursor]===g||((c=o.codePointSource[o.cursor])===T||c===C||O<=c&&c<=i||V<=c&&c<=f))return consumeBadURL(t,o),t.onParseError({message:"Unexpected character while consuming a url token.",start:o.representationStart,end:o.representationEnd,state:["4.3.6. Consume a url token","Unexpected U+0022 QUOTATION MARK (\"), U+0027 APOSTROPHE ('), U+0028 LEFT PARENTHESIS (() or non-printable code point"]}),[e.BadURL,o.source.slice(o.representationStart,o.representationEnd+1),o.representationStart,o.representationEnd,void 0];if(o.codePointSource[o.cursor]===y){if(checkIfTwoCodePointsAreAValidEscape(0,o)){n+=String.fromCharCode(consumeEscapedCodePoint(t,o));continue}return consumeBadURL(t,o),t.onParseError({message:"Invalid escape sequence while consuming a url token.",start:o.representationStart,end:o.representationEnd,state:["4.3.6. Consume a url token","U+005C REVERSE SOLIDUS (\\)","The input stream does not start with a valid escape sequence"]}),[e.BadURL,o.source.slice(o.representationStart,o.representationEnd+1),o.representationStart,o.representationEnd,void 0]}n+=String.fromCharCode(o.codePointSource[o.cursor]),o.advanceCodePoint()}var c}function consumeIdentLikeToken(t,o){const n=consumeIdentSequence(t,o);if(o.codePointSource[o.cursor]!==g)return[e.Ident,o.source.slice(o.representationStart,o.representationEnd+1),o.representationStart,o.representationEnd,{value:String.fromCharCode(...n)}];if(checkIfCodePointsMatchURLIdent(0,n)){o.advanceCodePoint();let i=0;for(;;){const t=isWhitespace(o.codePointSource[o.cursor]),c=isWhitespace(o.codePointSource[o.cursor+1]);if(t&&c){i+=2,o.advanceCodePoint(2);continue}const s=t?o.codePointSource[o.cursor+1]:o.codePointSource[o.cursor];if(s===N||s===r)return i>0&&o.advanceCodePoint(i),[e.Function,o.source.slice(o.representationStart,o.representationEnd+1),o.representationStart,o.representationEnd,{value:String.fromCharCode(...n)}];break}return i>0&&o.advanceCodePoint(i),consumeUrlToken(t,o)}return o.advanceCodePoint(),[e.Function,o.source.slice(o.representationStart,o.representationEnd+1),o.representationStart,o.representationEnd,{value:String.fromCharCode(...n)}]}function tokenizer(t,o){const n=t.css.valueOf(),i=new Reader(n),C={onParseError:(null==o?void 0:o.onParseError)??(()=>{})};return{nextToken:function nextToken(){if(i.representationStart=i.cursor,i.representationEnd=-1,checkIfTwoCodePointsStartAComment(0,i)){if(null!=o&&o.commentsAreTokens)return consumeComment(C,i);consumeComment(C,i),i.representationStart=i.cursor,i.representationEnd=-1}const t=i.codePointSource[i.cursor];if(void 0===t)return[e.EOF,"",-1,-1,void 0];if(isIdentStartCodePoint(t))return consumeIdentLikeToken(C,i);if(isDigitCodePoint(t))return consumeNumericToken(C,i);switch(t){case d:return i.advanceCodePoint(),[e.Comma,",",i.representationStart,i.representationEnd,void 0];case a:return i.advanceCodePoint(),[e.Colon,":",i.representationStart,i.representationEnd,void 0];case F:return i.advanceCodePoint(),[e.Semicolon,";",i.representationStart,i.representationEnd,void 0];case g:return i.advanceCodePoint(),[e.OpenParen,"(",i.representationStart,i.representationEnd,void 0];case q:return i.advanceCodePoint(),[e.CloseParen,")",i.representationStart,i.representationEnd,void 0];case A:return i.advanceCodePoint(),[e.OpenSquare,"[",i.representationStart,i.representationEnd,void 0];case x:return i.advanceCodePoint(),[e.CloseSquare,"]",i.representationStart,i.representationEnd,void 0];case v:return i.advanceCodePoint(),[e.OpenCurly,"{",i.representationStart,i.representationEnd,void 0];case W:return i.advanceCodePoint(),[e.CloseCurly,"}",i.representationStart,i.representationEnd,void 0];case r:case N:return consumeStringToken(C,i);case w:return consumeHashToken(C,i);case b:case P:return checkIfThreeCodePointsWouldStartANumber(0,i)?consumeNumericToken(C,i):(i.advanceCodePoint(),[e.Delim,i.source[i.representationStart],i.representationStart,i.representationEnd,{value:i.source[i.representationStart]}]);case I:case c:case S:case s:case H:return consumeWhiteSpace(0,i);case l:return checkIfThreeCodePointsWouldStartANumber(0,i)?consumeNumericToken(C,i):checkIfThreeCodePointsWouldStartCDC(0,i)?(i.advanceCodePoint(3),[e.CDC,"--\x3e",i.representationStart,i.representationEnd,void 0]):checkIfThreeCodePointsWouldStartAnIdentSequence(0,i)?consumeIdentLikeToken(C,i):(i.advanceCodePoint(),[e.Delim,"-",i.representationStart,i.representationEnd,{value:"-"}]);case k:return checkIfFourCodePointsWouldStartCDO(0,i)?(i.advanceCodePoint(4),[e.CDO,"\x3c!--",i.representationStart,i.representationEnd,void 0]):(i.advanceCodePoint(),[e.Delim,"<",i.representationStart,i.representationEnd,{value:"<"}]);case u:if(i.advanceCodePoint(),checkIfThreeCodePointsWouldStartAnIdentSequence(0,i)){const t=consumeIdentSequence(C,i);return[e.AtKeyword,i.source.slice(i.representationStart,i.representationEnd+1),i.representationStart,i.representationEnd,{value:String.fromCharCode(...t)}]}return[e.Delim,"@",i.representationStart,i.representationEnd,{value:"@"}];case y:return checkIfTwoCodePointsAreAValidEscape(0,i)?consumeIdentLikeToken(C,i):(i.advanceCodePoint(),C.onParseError({message:'Invalid escape sequence after "\\"',start:i.representationStart,end:i.representationEnd,state:["4.3.1. Consume a token","U+005C REVERSE SOLIDUS (\\)","The input stream does not start with a valid escape sequence"]}),[e.Delim,"\\",i.representationStart,i.representationEnd,{value:"\\"}])}return i.advanceCodePoint(),[e.Delim,i.source[i.representationStart],i.representationStart,i.representationEnd,{value:i.source[i.representationStart]}]},endOfFile:function endOfFile(){return void 0===i.codePointSource[i.cursor]}}}function cloneTokens(e){return"undefined"!=typeof globalThis&&"structuredClone"in globalThis?structuredClone(e):JSON.parse(JSON.stringify(e))}export{t as NumberType,Reader,e as TokenType,cloneTokens,isToken,mirrorVariantType,stringify,tokenizer};
