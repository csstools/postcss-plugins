import { color } from '@csstools/css-color-parser';
import assert from 'assert';
import { parse } from '../util/parse.mjs';
import { serialize_sRGB_data, serialize_P3_data } from '../util/serialize.mjs';

const tests = [
	['lab(40% 56.6 39)', 'rgb(179, 35, 35)', 'color(display-p3 0.64331 0.19245 0.16771)'],
	['lab(40% 56.6 39 / 1)', 'rgb(179, 35, 35)', 'color(display-p3 0.64331 0.19245 0.16771)'],
	['lab(40% 56.6 39 / .5)', 'rgba(179, 35, 35, 0.5)', 'color(display-p3 0.64331 0.19245 0.16771 / 0.5)'],
	['lab(40% 56.6 39 / 100%)', 'rgb(179, 35, 35)', 'color(display-p3 0.64331 0.19245 0.16771)'],
	['lab(40% 56.6 39 / 50%)', 'rgba(179, 35, 35, 0.5)', 'color(display-p3 0.64331 0.19245 0.16771 / 0.5)'],
	['lab(60% 50 0)', 'rgb(222, 105, 147)', 'color(display-p3 0.81388 0.43646 0.57322)'],
	['lab(40% 35% 30%)', 'rgb(163, 57, 35)', 'color(display-p3 0.59266 0.25309 0.17075)'],

	['lab(0 0 0)', 'rgb(0, 0, 0)', 'color(display-p3 0 0 0)'],
	['lab(0 0 0 / 1)', 'rgb(0, 0, 0)', 'color(display-p3 0 0 0)'],
	['lab(0 0 0 / 0.5)', 'rgba(0, 0, 0, 0.5)', 'color(display-p3 0 0 0 / 0.5)'],
	['lab(20 0 10/0.5)', 'rgba(52, 48, 34, 0.5)', 'color(display-p3 0.20256 0.18882 0.13828 / 0.5)'],
	['lab(20 0 10/50%)', 'rgba(52, 48, 34, 0.5)', 'color(display-p3 0.20256 0.18882 0.13828 / 0.5)'],
	['lab(400 0 10/50%)', 'rgba(255, 255, 255, 0.5)', 'color(display-p3 1 1 1 / 0.5)'],
	['lab(100 0 10/50%)', 'rgba(255, 255, 255, 0.5)', 'color(display-p3 1 1 1 / 0.5)'],
	['lab(50 -160 160)', 'rgb(0, 132, 35)', 'color(display-p3 0 0.53135 0.05051)'],
	['lab(50 -200 200)', 'rgb(51, 128, 0)', 'color(display-p3 0.26 0.50158 0)'],
	['lab(0 0 0 / -10%)', 'rgba(0, 0, 0, 0)', 'color(display-p3 0 0 0 / 0)'],
	['lab(0 0 0 / 110%)', 'rgb(0, 0, 0)', 'color(display-p3 0 0 0)'],
	['lab(0 0 0 / 300%)', 'rgb(0, 0, 0)', 'color(display-p3 0 0 0)'],
	['lab(-40 0 0)', 'rgb(0, 0, 0)', 'color(display-p3 0 0 0)'],
	['lab(50 -20 0)', 'rgb(77, 129, 118)', 'color(display-p3 0.34973 0.49949 0.46434)'],
	['lab(50 0 -20)', 'rgb(104, 120, 153)', 'color(display-p3 0.41876 0.46812 0.58845)'],
	['lab(calc(50 * 3) calc(0.5 - 1) calc(1.5) / calc(-0.5 + 1))', 'rgba(255, 255, 255, 0.5)', 'color(display-p3 1 1 1 / 0.5)'],
	['lab(calc(50 / 3) calc(0.5 - 1) calc(1.5) / calc(-0.5 + 1))', 'rgba(41, 41, 39, 0.5)', 'color(display-p3 0.16151 0.16211 0.15382 / 0.5)'],
	['lab(calc(-50 * 3) calc(0.5 + 1) calc(-1.5) / calc(-0.5 * 2))', 'rgba(0, 0, 0, 0)', 'color(display-p3 0 0 0 / 0)'],

	['lab(none none none / none)', 'rgba(0, 0, 0, 0)', 'color(display-p3 0 0 0 / 0)'],
	['lab(none none none)', 'rgb(0, 0, 0)', 'color(display-p3 0 0 0)'],
	['lab(20 none none / none)', 'rgba(48, 48, 48, 0)', 'color(display-p3 0.18938 0.18938 0.18938 / 0)'],
	['lab(none none none / 0.5)', 'rgba(0, 0, 0, 0.5)', 'color(display-p3 0 0 0 / 0.5)'],
	['lab(0 0 0 / none)', 'rgba(0, 0, 0, 0)', 'color(display-p3 0 0 0 / 0)'],

	['oklab(0 0 0)', 'rgb(0, 0, 0)', 'color(display-p3 0 0 0)'],
	['oklab(0 0 0 / 1)', 'rgb(0, 0, 0)', 'color(display-p3 0 0 0)'],
	['oklab(0 0 0 / 0.5)', 'rgba(0, 0, 0, 0.5)', 'color(display-p3 0 0 0 / 0.5)'],
	['oklab(0.2 0 0.1/0.5)', 'rgba(31, 20, 0, 0.5)', 'color(display-p3 0.11443 0.08142 0 / 0.5)'],
	['oklab(0.2 0 0.1/50%)', 'rgba(31, 20, 0, 0.5)', 'color(display-p3 0.11443 0.08142 0 / 0.5)'],
	['oklab(4 0 0.1/50%)', 'rgba(255, 255, 255, 0.5)', 'color(display-p3 1 1 1 / 0.5)'],
	['oklab(0.5 -1.6 1.6)', 'rgb(53, 117, 0)', 'color(display-p3 0.25974 0.45977 0)'],
	['oklab(0.5 -2 2)', 'rgb(55, 117, 0)', 'color(display-p3 0.25974 0.45977 0)'],
	['oklab(0 0 0 / -10%)', 'rgba(0, 0, 0, 0)', 'color(display-p3 0 0 0 / 0)'],
	['oklab(0 0 0 / 110%)', 'rgb(0, 0, 0)', 'color(display-p3 0 0 0)'],
	['oklab(0 0 0 / 300%)', 'rgb(0, 0, 0)', 'color(display-p3 0 0 0)'],
	['oklab(-0.4 0 0)', 'rgb(0, 0, 0)', 'color(display-p3 0 0 0)'],
	['oklab(0.5 -0.2 0)', 'rgb(0, 117, 101)', 'color(display-p3 0 0.46541 0.40143)'],
	['oklab(0.5 0 -0.2)', 'rgb(59, 81, 211)', 'color(display-p3 0.24856 0.31486 0.7965)'],
	['oklab(calc(0.5 * 3) calc(0.5 - 1) calc(1.5) / calc(-0.5 + 1))', 'rgba(255, 255, 255, 0.5)', 'color(display-p3 1 1 1 / 0.5)'],
	['oklab(calc(-0.5 * 3) calc(0.5 + 1) calc(-1.5) / calc(-0.5 * 2))', 'rgba(0, 0, 0, 0)', 'color(display-p3 0 0 0 / 0)'],

	['oklab(none none none / none)', 'rgba(0, 0, 0, 0)', 'color(display-p3 0 0 0 / 0)'],
	['oklab(none none none)', 'rgb(0, 0, 0)', 'color(display-p3 0 0 0)'],
	['oklab(0.2 none none / none)', 'rgba(22, 22, 22, 0)', 'color(display-p3 0.0861 0.0861 0.0861 / 0)'],
	['oklab(none none none / 0.5)', 'rgba(0, 0, 0, 0.5)', 'color(display-p3 0 0 0 / 0.5)'],
	['oklab(0 0 0 / none)', 'rgba(0, 0, 0, 0)', 'color(display-p3 0 0 0 / 0)'],

	['lab(20 -62.5 112.5 / 0.5)', 'rgba(37, 49, 0, 0.5)', 'color(display-p3 0.14983 0.19329 0 / 0.5)'],
	['lab(20% -50% 90%/0.5)', 'rgba(37, 49, 0, 0.5)', 'color(display-p3 0.14983 0.19329 0 / 0.5)'],
	['oklab(0.2 0.28 -0.32 / 0.5)', 'rgba(37, 0, 56, 0.5)', 'color(display-p3 0.13416 0 0.22429 / 0.5)'],
	['oklab(20% 70% -80%/0.5)', 'rgba(37, 0, 56, 0.5)', 'color(display-p3 0.13416 0 0.22429 / 0.5)'],

	['lch(0 0 0deg)', 'rgb(0, 0, 0)', 'color(display-p3 0 0 0)'],
	['lch(0 0 0deg / 1)', 'rgb(0, 0, 0)', 'color(display-p3 0 0 0)'],
	['lch(0 0 0deg / 0.5)', 'rgba(0, 0, 0, 0.5)', 'color(display-p3 0 0 0 / 0.5)'],
	['lch(100 230 0deg / 0.5)', 'rgba(255, 255, 255, 0.5)', 'color(display-p3 1 1 1 / 0.5)'],
	['lch(20 50 20deg/0.5)', 'rgba(104, 0, 29, 0.5)', 'color(display-p3 0.38092 0.00312 0.11269 / 0.5)'],
	['lch(20 50 20deg/50%)', 'rgba(104, 0, 29, 0.5)', 'color(display-p3 0.38092 0.00312 0.11269 / 0.5)'],
	['lch(10 20 20deg / -10%)', 'rgba(51, 15, 19, 0)', 'color(display-p3 0.18359 0.06826 0.0765 / 0)'],
	['lch(10 20 20deg / 110%)', 'rgb(51, 15, 19)', 'color(display-p3 0.18359 0.06826 0.0765)'],
	['lch(10 20 1.28rad)', 'rgb(37, 25, 0)', 'color(display-p3 0.14474 0.09967 0)'],
	['lch(10 20 380deg)', 'rgb(51, 15, 19)', 'color(display-p3 0.18359 0.06826 0.0765)'],
	['lch(10 20 -340deg)', 'rgb(51, 15, 19)', 'color(display-p3 0.18359 0.06826 0.0765)'],
	['lch(10 20 740deg)', 'rgb(51, 15, 19)', 'color(display-p3 0.18359 0.06826 0.0765)'],
	['lch(10 20 -700deg)', 'rgb(51, 15, 19)', 'color(display-p3 0.18359 0.06826 0.0765)'],
	['lch(-40 0 0)', 'rgb(0, 0, 0)', 'color(display-p3 0 0 0)'],
	['lch(20 -20 0)', 'rgb(48, 48, 48)', 'color(display-p3 0.18938 0.18938 0.18938)'],
	['lch(0 0 0 / 0.5)', 'rgba(0, 0, 0, 0.5)', 'color(display-p3 0 0 0 / 0.5)'],
	['lch(10 20 20 / 110%)', 'rgb(51, 15, 19)', 'color(display-p3 0.18359 0.06826 0.0765)'],
	['lch(10 20 -700)', 'rgb(51, 15, 19)', 'color(display-p3 0.18359 0.06826 0.0765)'],
	['lch(calc(50 * 3) calc(0.5 - 1) calc(20deg * 2) / calc(-0.5 + 1))', 'rgba(255, 255, 255, 0.5)', 'color(display-p3 1 1 1 / 0.5)'],
	['lch(calc(-50 * 3) calc(0.5 + 1) calc(-20deg * 2) / calc(-0.5 * 2))', 'rgba(0, 0, 0, 0)', 'color(display-p3 0 0 0 / 0)'],

	['lch(none none none / none)', 'rgba(0, 0, 0, 0)', 'color(display-p3 0 0 0 / 0)'],
	['lch(none none none)', 'rgb(0, 0, 0)', 'color(display-p3 0 0 0)'],
	['lch(20 none none / none)', 'rgba(48, 48, 48, 0)', 'color(display-p3 0.18938 0.18938 0.18938 / 0)'],
	['lch(none none none / 0.5)', 'rgba(0, 0, 0, 0.5)', 'color(display-p3 0 0 0 / 0.5)'],
	['lch(0 0 0 / none)', 'rgba(0, 0, 0, 0)', 'color(display-p3 0 0 0 / 0)'],

	['oklch(0 0 0deg)', 'rgb(0, 0, 0)', 'color(display-p3 0 0 0)'],
	['oklch(0 0 0deg / 1)', 'rgb(0, 0, 0)', 'color(display-p3 0 0 0)'],
	['oklch(0 0 0deg / 0.5)', 'rgba(0, 0, 0, 0.5)', 'color(display-p3 0 0 0 / 0.5)'],
	['oklch(1 2.3 0deg / 0.5)', 'rgba(255, 255, 255, 0.5)', 'color(display-p3 1 1 1 / 0.5)'],
	['oklch(0.2 0.5 20deg/0.5)', 'rgba(54, 0, 4, 0.5)', 'color(display-p3 0.18813 0 0.01902 / 0.5)'],
	['oklch(0.2 0.5 20deg/50%)', 'rgba(54, 0, 4, 0.5)', 'color(display-p3 0.18813 0 0.01902 / 0.5)'],
	['oklch(0.1 0.2 20deg / -10%)', 'rgba(15, 0, 0, 0)', 'color(display-p3 0.04964 0 0.00188 / 0)'],
	['oklch(0.1 0.2 20deg / 110%)', 'rgb(15, 0, 0)', 'color(display-p3 0.04964 0 0.00188)'],
	['oklch(0.1 0.2 1.28rad)', 'rgb(7, 2, 0)', 'color(display-p3 0.02425 0.00999 0)'],
	['oklch(0.1 0.2 380deg)', 'rgb(15, 0, 0)', 'color(display-p3 0.04964 0 0.00188)'],
	['oklch(0.1 0.2 -340deg)', 'rgb(15, 0, 0)', 'color(display-p3 0.04964 0 0.00188)'],
	['oklch(0.1 0.2 740deg)', 'rgb(15, 0, 0)', 'color(display-p3 0.04964 0 0.00188)'],
	['oklch(0.1 0.2 -700deg)', 'rgb(15, 0, 0)', 'color(display-p3 0.04964 0 0.00188)'],
	['oklch(-0.4 0 0)', 'rgb(0, 0, 0)', 'color(display-p3 0 0 0)'],
	['oklch(0.2 -0.2 0)', 'rgb(22, 22, 22)', 'color(display-p3 0.0861 0.0861 0.0861)'],
	['oklch(0 0 0 / 0.5)', 'rgba(0, 0, 0, 0.5)', 'color(display-p3 0 0 0 / 0.5)'],
	['oklch(0.1 0.2 20 / 110%)', 'rgb(15, 0, 0)', 'color(display-p3 0.04964 0 0.00188)'],
	['oklch(0.1 0.2 -700)', 'rgb(15, 0, 0)', 'color(display-p3 0.04964 0 0.00188)'],
	['oklch(calc(0.5 * 3) calc(0.5 - 1) calc(20deg * 2) / calc(-0.5 + 1))', 'rgba(255, 255, 255, 0.5)', 'color(display-p3 1 1 1 / 0.5)'],
	['oklch(calc(-0.5 * 3) calc(0.5 + 1) calc(-20deg * 2) / calc(-0.5 * 2))', 'rgba(0, 0, 0, 0)', 'color(display-p3 0 0 0 / 0)'],

	['oklch(none none none / none)', 'rgba(0, 0, 0, 0)', 'color(display-p3 0 0 0 / 0)'],
	['oklch(none none none)', 'rgb(0, 0, 0)', 'color(display-p3 0 0 0)'],
	['oklch(0.2 none none / none)', 'rgba(22, 22, 22, 0)', 'color(display-p3 0.0861 0.0861 0.0861 / 0)'],
	['oklch(none none none / 0.5)', 'rgba(0, 0, 0, 0.5)', 'color(display-p3 0 0 0 / 0.5)'],
	['oklch(0 0 0 / none)', 'rgba(0, 0, 0, 0)', 'color(display-p3 0 0 0 / 0)'],

	['lch(20 120 10 / 0.5)', 'rgba(113, 0, 49, 0.5)', 'color(display-p3 0.42656 0 0.18551 / 0.5)'],
	['lch(20% 80% 10/0.5)', 'rgba(113, 0, 49, 0.5)', 'color(display-p3 0.42656 0 0.18551 / 0.5)'],
	['oklch(0.2 0.24 10 / 0.5)', 'rgba(52, 0, 12, 0.5)', 'color(display-p3 0.19503 0 0.04399 / 0.5)'],
	['oklch(20% 60% 10/0.5)', 'rgba(52, 0, 12, 0.5)', 'color(display-p3 0.19503 0 0.04399 / 0.5)'],
];

for (const test of tests) {
	assert.deepStrictEqual(
		serialize_sRGB_data(color(parse(test[0]))),
		test[1],
		`"${test[0]}" : ${test[1]}`,
	);

	assert.deepStrictEqual(
		serialize_P3_data(color(parse(test[0]))),
		test[2],
		`"${test[0]}" : ${test[2]}`,
	);
}
