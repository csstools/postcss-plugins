"use strict";var e,n,o=require("@csstools/css-parser-algorithms"),a=require("@csstools/css-tokenizer"),t=require("@csstools/css-calc"),r=require("@csstools/color-helpers");function colorDataChannelsToCalcGlobals(e){const n=new Map;switch(e.currentColorSpace){case exports.ColorSpace.XYZ_D50:n.set("x",dummyNumberToken(e.channels[0])),n.set("y",dummyNumberToken(e.channels[1])),n.set("z",dummyNumberToken(e.channels[2])),n.set("alpha",dummyNumberToken(e.alpha));break;case exports.ColorSpace.sRGB:n.set("r",dummyNumberToken(255*e.channels[0])),n.set("g",dummyNumberToken(255*e.channels[1])),n.set("b",dummyNumberToken(255*e.channels[2])),n.set("alpha",dummyNumberToken(e.alpha))}return n}function dummyNumberToken(e){return[a.TokenType.Number,e.toString(),-1,-1,{value:e,type:a.NumberType.Number}]}function threeChannelLegacySyntax(e,r,s,l,u){const c=[],i=[],p=[],m=[],h={channels:[0,0,0],alpha:0,missingComponents:[!1,!1,!1,!1],currentColorSpace:exports.ColorSpace.XYZ_D50,sourceColorSpace:s,syntaxFlags:new Set(u)};let g=c;for(let n=0;n<e.value.length;n++){let r=e.value[n];if(!o.isWhitespaceNode(r)&&!o.isCommentNode(r)){if(o.isTokenNode(r)&&r.value[0]===a.TokenType.Comma){if(g===c){g=i;continue}if(g===i){g=p;continue}if(g===p){g=m;continue}if(g===m)return-1}if(o.isFunctionNode(r)){if("calc"!==r.getName().toLowerCase())return-1;const[[e]]=t.calcFromComponentValues([[r]],{toCanonicalUnits:!0,precision:100});if(!e||!o.isTokenNode(e))return-1;r=e}if(!o.isTokenNode(r))return-1;g.push(r.value)}}if(1!==g.length)return-1;if(1!==c.length||1!==i.length||1!==p.length)return-1;const y=[c[0],i[0],p[0]],C=1===m.length;C&&(h.syntaxFlags.add(n.HasAlpha),y.push(m[0]));const f=r(y,h);return-1===f?-1:(h.channels=l([f[0][4].value,f[1][4].value,f[2][4].value]),h.alpha=C?f[3][4].value:1,h)}function threeChannelSpaceSeparated(e,r,s,l,u){const c=[],i=[],p=[],m=[],h={channels:[0,0,0],alpha:0,missingComponents:[!1,!1,!1,!1],currentColorSpace:exports.ColorSpace.XYZ_D50,sourceColorSpace:s,syntaxFlags:new Set(u)};let g=c;for(let n=0;n<e.value.length;n++){let r=e.value[n];if(o.isWhitespaceNode(r)||o.isCommentNode(r)){for(;o.isWhitespaceNode(e.value[n+1])||o.isCommentNode(e.value[n+1]);)n++;if(!c.length)continue;if(g===c){g=i;continue}if(g===i){g=p;continue}}else if(o.isTokenNode(r)&&r.value[0]===a.TokenType.Delim&&"/"===r.value[4].value){if(g===m)return-1;g=m}else{if(o.isFunctionNode(r)){if("calc"!==r.getName().toLowerCase())return-1;const[[e]]=t.calcFromComponentValues([[r]],{toCanonicalUnits:!0,precision:100});if(!e||!o.isTokenNode(e))return-1;r=e}if(!o.isTokenNode(r))return-1;g.push(r.value)}}if(1!==g.length)return-1;if(1!==c.length||1!==i.length||1!==p.length)return-1;const y=[c[0],i[0],p[0]],C=1===m.length;C&&(h.syntaxFlags.add(n.HasAlpha),y.push(m[0]));const f=r(y,h);return-1===f?-1:(h.channels=l([f[0][4].value,f[1][4].value,f[2][4].value]),h.alpha=C?f[3][4].value:1,h)}function normalize_legacy_sRGB_ChannelValues(e,o){const t=[];for(let r=0;r<e.length;r++){const s=e[r];if(s[0]!==a.TokenType.Percentage){if(s[0]!==a.TokenType.Number)return-1;{3!==r&&o.syntaxFlags.add(n.HasNumberValues);let e=255;3===r&&(e=1),t.push([a.TokenType.Number,(s[4].value/e).toString(),s[2],s[3],{value:s[4].value/e,type:a.NumberType.Number}])}}else 3!==r&&o.syntaxFlags.add(n.HasPercentageValues),t.push([a.TokenType.Number,(s[4].value/100).toString(),s[2],s[3],{value:s[4].value/100,type:a.NumberType.Number}])}return o.syntaxFlags.has(n.HasNumberValues)&&o.syntaxFlags.has(n.HasPercentageValues)?-1:t}function normalize_modern_sRGB_ChannelValues(e,o){const t=[];for(let r=0;r<e.length;r++){const s=e[r];if(s[0]!==a.TokenType.Percentage)if(s[0]!==a.TokenType.Number){if(s[0]!==a.TokenType.Ident||"none"!==s[4].value.toLowerCase())return-1;o.syntaxFlags.add(n.HasNoneKeywords),o.missingComponents[r]=!0,t.push([a.TokenType.Number,"0",s[2],s[3],{value:0,type:a.NumberType.Number}])}else{3!==r&&o.syntaxFlags.add(n.HasNumberValues);let e=255;3===r&&(e=1),t.push([a.TokenType.Number,(s[4].value/e).toString(),s[2],s[3],{value:s[4].value/e,type:a.NumberType.Number}])}else 3!==r&&o.syntaxFlags.add(n.HasPercentageValues),t.push([a.TokenType.Number,(s[4].value/100).toString(),s[2],s[3],{value:s[4].value/100,type:a.NumberType.Number}])}return t}function rgb(e,n){{const n=rgbCommaSeparated(e);if(-1!==n)return n}{const n=rgbSpaceSeparated(e);if(-1!==n)return n}{const o=rgbSpaceSeparated_RCS(e,n);if(-1!==o)return o}return-1}function rgbCommaSeparated(e){return threeChannelLegacySyntax(e,normalize_legacy_sRGB_ChannelValues,exports.ColorSpace.sRGB,r.xyz.sRGB_to_XYZ_D50,[n.LegacyRGB])}function rgbSpaceSeparated(e){return threeChannelSpaceSeparated(e,normalize_modern_sRGB_ChannelValues,exports.ColorSpace.sRGB,r.xyz.sRGB_to_XYZ_D50,[])}function rgbSpaceSeparated_RCS(e,s){let l=null,u=1;const c=[],i=[],p=[],m=[];let h=c;for(let n=0;n<e.value.length;n++){let g=e.value[n];if(o.isWhitespaceNode(g)||o.isCommentNode(g)){for(;o.isWhitespaceNode(e.value[n+1])||o.isCommentNode(e.value[n+1]);)n++;if(!c.length)continue;if(h===c){h=i;continue}if(h===i){h=p;continue}}else{if(o.isTokenNode(g)&&!l&&g.value[0]===a.TokenType.Ident&&"from"===g.value[4].value.toLowerCase()){for(;o.isWhitespaceNode(e.value[n+1])||o.isCommentNode(e.value[n+1]);)n++;const t=e.value[n+1];if(o.isTokenNode(t)&&t.value[0]===a.TokenType.Ident){const e=t.value[4].value.toLowerCase();if("currentcolor"===e)return-1;if("transparent"===e){l=colorDataChannelsToCalcGlobals({channels:[0,0,0],alpha:0,missingComponents:[],currentColorSpace:exports.ColorSpace.sRGB,sourceColorSpace:exports.ColorSpace.sRGB,syntaxFlags:new Set}),u=0,n++;continue}if(!Object.prototype.hasOwnProperty.call(r.namedColors,e))return-1;const o=r.namedColors[e];if(!o)return-1;l=colorDataChannelsToCalcGlobals({channels:[o[0]/255,o[1]/255,o[2]/255],alpha:1,missingComponents:[],currentColorSpace:exports.ColorSpace.sRGB,sourceColorSpace:exports.ColorSpace.sRGB,syntaxFlags:new Set}),u=1,n++;continue}if(o.isFunctionNode(t)){if("var"===t.getName().toLowerCase())return-1;const e=s(t);if(-1===e)return-1;l=colorDataChannelsToCalcGlobals({channels:r.xyz.XYZ_D50_to_sRGB(e.channels),alpha:e.alpha,missingComponents:[],currentColorSpace:exports.ColorSpace.sRGB,sourceColorSpace:e.sourceColorSpace,syntaxFlags:new Set}),u=e.alpha,n++;continue}}if(!l)return-1;if(!o.isTokenNode(g)||g.value[0]!==a.TokenType.Delim||"/"!==g.value[4].value){if(o.isFunctionNode(g)){if("calc"!==g.getName().toLowerCase())return-1;const[[e]]=t.calcFromComponentValues([[g]],{toCanonicalUnits:!0,precision:100,globals:l});if(!e||!o.isTokenNode(e))return-1;g=e}if(o.isTokenNode(g)){if(g.value[0]===a.TokenType.Ident){const e=g.value,n=l.get(e[4].value.toLowerCase());if(!n)return-1;g=new o.TokenNode(n)}if(g.value[0]===a.TokenType.Percentage){const e=g.value;h.push([a.TokenType.Number,(e[4].value/100).toString(),e[2],e[3],{value:e[4].value/100,type:a.NumberType.Number}]);continue}if(g.value[0]===a.TokenType.Number){let e=255;h===m&&(e=1);const n=g.value;h.push([a.TokenType.Number,(n[4].value/e).toString(),n[2],n[3],{value:n[4].value/e,type:a.NumberType.Number}]);continue}}return-1}if(h===m)return-1;h=m}}return 1!==h.length||1!==c.length||1!==i.length||1!==p.length?-1:{channels:r.xyz.sRGB_to_XYZ_D50([c[0][4].value,i[0][4].value,p[0][4].value]),alpha:1===m.length?m[0][4].value:u,missingComponents:[],currentColorSpace:exports.ColorSpace.XYZ_D50,sourceColorSpace:exports.ColorSpace.sRGB,syntaxFlags:new Set([n.RelativeColorSyntax])}}exports.ColorSpace=void 0,(e=exports.ColorSpace||(exports.ColorSpace={})).XYZ_D50="xyz-d50",e.XYZ_D65="xyz-d65",e.sRGB="srgb",function(e){e.LegacyRGB="legacy-rgb",e.LegacyHSL="legacy-hsl",e.RelativeColorSyntax="relative-color-syntax",e.HasAlpha="has-alpha",e.HasNoneKeywords="has-none-keywords",e.HasNumberValues="has-number-values",e.HasPercentageValues="has-percentage-values"}(n||(n={})),exports.color=function color(e){return o.isFunctionNode(e)&&("rgb"===e.getName().toLowerCase()||"rgba"===e.getName().toLowerCase())?rgb(e,color):-1};
