"use strict";var e,o=require("@csstools/css-parser-algorithms"),n=require("@csstools/css-tokenizer"),r=require("@csstools/css-calc"),t=require("@csstools/color-helpers");function colorDataChannelsToCalcGlobals(e){const o=new Map;switch(e.currentColorSpace){case exports.ColorSpace.XYZ_D50:o.set("x",dummyNumberToken(e.channels[0])),o.set("y",dummyNumberToken(e.channels[1])),o.set("z",dummyNumberToken(e.channels[2])),o.set("alpha",dummyNumberToken(e.alpha));break;case exports.ColorSpace.sRGB:o.set("r",dummyNumberToken(255*e.channels[0])),o.set("g",dummyNumberToken(255*e.channels[1])),o.set("b",dummyNumberToken(255*e.channels[2])),o.set("alpha",dummyNumberToken(e.alpha))}return o}function dummyNumberToken(e){return[n.TokenType.Number,e.toString(),-1,-1,{value:e,type:n.NumberType.Number}]}function threeChannelLegacySyntax(e,t,a,l){const u=[],s=[],c=[],i=[];let p=u;for(let a=0;a<e.value.length;a++){let l=e.value[a];if(!o.isWhitespaceNode(l)&&!o.isCommentNode(l)){if(o.isTokenNode(l)&&l.value[0]===n.TokenType.Comma){if(p===u){p=s;continue}if(p===s){p=c;continue}if(p===c){p=i;continue}if(p===i)return-1}if(o.isFunctionNode(l)){if("calc"!==l.getName().toLowerCase())return-1;const[[e]]=r.calcFromComponentValues([[l]],{toCanonicalUnits:!0,precision:100});if(!e||!o.isTokenNode(e))return-1;l=e}if(!o.isTokenNode(l))return-1;{let e=0;if(p===u)e=0;else if(p===s)e=1;else if(p===c)e=2;else{if(p!==i)return-1;e=3}const o=t(l.value,e);if(-1===o)return-1;p.push(o)}}}return 1!==p.length||1!==u.length||1!==s.length||1!==c.length?-1:{channels:l([u[0][4].value,s[0][4].value,c[0][4].value]),alpha:1===i.length?i[0][4].value:1,currentColorSpace:exports.ColorSpace.XYZ_D50,sourceColorSpace:a}}function threeChannelSpaceSeparated(e,t,a,l){const u=[],s=[],c=[],i=[];let p=u;for(let a=0;a<e.value.length;a++){let l=e.value[a];if(o.isWhitespaceNode(l)||o.isCommentNode(l)){for(;o.isWhitespaceNode(e.value[a+1])||o.isCommentNode(e.value[a+1]);)a++;if(!u.length)continue;if(p===u){p=s;continue}if(p===s){p=c;continue}}else if(o.isTokenNode(l)&&l.value[0]===n.TokenType.Delim&&"/"===l.value[4].value){if(p===i)return-1;p=i}else{if(o.isFunctionNode(l)){if("calc"!==l.getName().toLowerCase())return-1;const[[e]]=r.calcFromComponentValues([[l]],{toCanonicalUnits:!0,precision:100});if(!e||!o.isTokenNode(e))return-1;l=e}if(!o.isTokenNode(l))return-1;{let e=0;if(p===u)e=0;else if(p===s)e=1;else if(p===c)e=2;else{if(p!==i)return-1;e=3}const o=t(l.value,e);if(-1===o)return-1;p.push(o)}}}return 1!==p.length||1!==u.length||1!==s.length||1!==c.length?-1:{channels:l([u[0][4].value,s[0][4].value,c[0][4].value]),alpha:1===i.length?i[0][4].value:1,currentColorSpace:exports.ColorSpace.XYZ_D50,sourceColorSpace:a}}function normalize_sRGB_ChannelValue(e,o){if(e[0]===n.TokenType.Percentage)return[n.TokenType.Number,(e[4].value/100).toString(),e[2],e[3],{value:e[4].value/100,type:n.NumberType.Number}];if(e[0]===n.TokenType.Number){let r=255;return 3===o&&(r=1),[n.TokenType.Number,(e[4].value/r).toString(),e[2],e[3],{value:e[4].value/r,type:n.NumberType.Number}]}return-1}function rgb(e,o){{const o=rgbCommaSeparated(e);if(-1!==o)return o}{const o=rgbSpaceSeparated(e);if(-1!==o)return o}{const n=rgbSpaceSeparated_RCS(e,o);if(-1!==n)return n}return-1}function rgbCommaSeparated(e){return threeChannelLegacySyntax(e,normalize_sRGB_ChannelValue,exports.ColorSpace.sRGB,t.xyz.sRGB_to_XYZ_D50)}function rgbSpaceSeparated(e){return threeChannelSpaceSeparated(e,normalize_sRGB_ChannelValue,exports.ColorSpace.sRGB,t.xyz.sRGB_to_XYZ_D50)}function rgbSpaceSeparated_RCS(e,a){let l=null,u=1;const s=[],c=[],i=[],p=[];let m=s;for(let f=0;f<e.value.length;f++){let h=e.value[f];if(o.isWhitespaceNode(h)||o.isCommentNode(h)){for(;o.isWhitespaceNode(e.value[f+1])||o.isCommentNode(e.value[f+1]);)f++;if(!s.length)continue;if(m===s){m=c;continue}if(m===c){m=i;continue}}else{if(o.isTokenNode(h)&&!l&&h.value[0]===n.TokenType.Ident&&"from"===h.value[4].value.toLowerCase()){for(;o.isWhitespaceNode(e.value[f+1])||o.isCommentNode(e.value[f+1]);)f++;const r=e.value[f+1];if(o.isTokenNode(r)&&r.value[0]===n.TokenType.Ident){const e=r.value[4].value.toLowerCase();if("currentcolor"===e)return-1;if("transparent"===e){l=colorDataChannelsToCalcGlobals({channels:[0,0,0],alpha:0,currentColorSpace:exports.ColorSpace.sRGB,sourceColorSpace:exports.ColorSpace.sRGB}),u=0,f++;continue}if(!Object.prototype.hasOwnProperty.call(t.namedColors,e))return-1;const o=t.namedColors[e];if(!o)return-1;l=colorDataChannelsToCalcGlobals({channels:[o[0]/255,o[1]/255,o[2]/255],alpha:1,currentColorSpace:exports.ColorSpace.sRGB,sourceColorSpace:exports.ColorSpace.sRGB}),u=1,f++;continue}if(o.isFunctionNode(r)){if("var"===r.getName().toLowerCase())return-1;const e=a(r);if(-1===e)return-1;l=colorDataChannelsToCalcGlobals({channels:t.xyz.XYZ_D50_to_sRGB(e.channels),alpha:e.alpha,currentColorSpace:exports.ColorSpace.sRGB,sourceColorSpace:e.sourceColorSpace}),u=e.alpha,f++;continue}}if(!l)return-1;if(!o.isTokenNode(h)||h.value[0]!==n.TokenType.Delim||"/"!==h.value[4].value){if(o.isFunctionNode(h)){if("calc"!==h.getName().toLowerCase())return-1;const[[e]]=r.calcFromComponentValues([[h]],{toCanonicalUnits:!0,precision:100,globals:l});if(!e||!o.isTokenNode(e))return-1;h=e}if(o.isTokenNode(h)){if(h.value[0]===n.TokenType.Ident){const e=h.value,n=l.get(e[4].value.toLowerCase());if(!n)return-1;h=new o.TokenNode(n)}if(h.value[0]===n.TokenType.Percentage){const e=h.value;m.push([n.TokenType.Number,(e[4].value/100).toString(),e[2],e[3],{value:e[4].value/100,type:n.NumberType.Number}]);continue}if(h.value[0]===n.TokenType.Number){let e=255;m===p&&(e=1);const o=h.value;m.push([n.TokenType.Number,(o[4].value/e).toString(),o[2],o[3],{value:o[4].value/e,type:n.NumberType.Number}]);continue}}return-1}if(m===p)return-1;m=p}}return 1!==m.length||1!==s.length||1!==c.length||1!==i.length?-1:{channels:t.xyz.sRGB_to_XYZ_D50([s[0][4].value,c[0][4].value,i[0][4].value]),alpha:1===p.length?p[0][4].value:u,currentColorSpace:exports.ColorSpace.XYZ_D50,sourceColorSpace:exports.ColorSpace.sRGB}}exports.ColorSpace=void 0,(e=exports.ColorSpace||(exports.ColorSpace={})).XYZ_D50="xyz-d50",e.XYZ_D65="xyz-d65",e.sRGB="srgb",exports.color=function color(e){return o.isFunctionNode(e)&&("rgb"===e.getName().toLowerCase()||"rgba"===e.getName().toLowerCase())?rgb(e,color):-1};
