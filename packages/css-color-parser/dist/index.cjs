"use strict";var e,a,n=require("@csstools/css-parser-algorithms"),s=require("@csstools/css-tokenizer"),r=require("@csstools/color-helpers"),o=require("@csstools/css-calc");exports.ColorSpace=void 0,(e=exports.ColorSpace||(exports.ColorSpace={})).XYZ_D50="xyz-d50",e.XYZ_D65="xyz-d65",e.sRGB="srgb",function(e){e.ColorKeyword="color-keyword",e.HasAlpha="has-alpha",e.HasDimensionValues="has-dimension-values",e.HasNoneKeywords="has-none-keywords",e.HasNumberValues="has-number-values",e.HasPercentageAlpha="has-percentage-alpha",e.HasPercentageValues="has-percentage-values",e.HasVariableAlpha="has-variable-alpha",e.Hex="hex",e.LegacyHSL="legacy-hsl",e.LegacyRGB="legacy-rgb",e.NamedColor="named-color",e.RelativeColorSyntax="relative-color-syntax"}(a||(a={}));const t=/[A-Z]/g;function toLowerCaseAZ(e){return e.replace(t,(e=>String.fromCharCode(e.charCodeAt(0)+32)))}function hex(e){const n=toLowerCaseAZ(e[4].value);if(n.match(/[^a-f0-9]/))return!1;const s={colorSpace:exports.ColorSpace.XYZ_D50,channels:[0,0,0],sourceColorSpace:exports.ColorSpace.sRGB,alpha:1,missingComponents:[!1,!1,!1,!1],syntaxFlags:new Set([a.Hex])},o=n.length;if(3===o){const e=n[0],a=n[1],o=n[2];return s.channels=r.xyz.sRGB_to_XYZ_D50([parseInt(e+e,16)/255,parseInt(a+a,16)/255,parseInt(o+o,16)/255]),s}if(6===o){const e=n[0]+n[1],a=n[2]+n[3],o=n[4]+n[5];return s.channels=r.xyz.sRGB_to_XYZ_D50([parseInt(e,16)/255,parseInt(a,16)/255,parseInt(o,16)/255]),s}if(4===o){const e=n[0],o=n[1],t=n[2],l=n[3];return s.channels=r.xyz.sRGB_to_XYZ_D50([parseInt(e+e,16)/255,parseInt(o+o,16)/255,parseInt(t+t,16)/255]),s.alpha=parseInt(l+l,16)/255,s.syntaxFlags.add(a.HasAlpha),s}if(8===o){const e=n[0]+n[1],o=n[2]+n[3],t=n[4]+n[5],l=n[6]+n[7];return s.channels=r.xyz.sRGB_to_XYZ_D50([parseInt(e,16)/255,parseInt(o,16)/255,parseInt(t,16)/255]),s.alpha=parseInt(l,16)/255,s.syntaxFlags.add(a.HasAlpha),s}return!1}function normalizeHue(e){if(e[0]===s.TokenType.Number)return e[4].value=e[4].value%360,e[1]=e[4].value.toString(),e;if(e[0]===s.TokenType.Dimension){let a=e[4].value;switch(toLowerCaseAZ(e[4].unit)){case"deg":break;case"rad":a=180*e[4].value/Math.PI;break;case"grad":a=.9*e[4].value;break;case"turn":a=360*e[4].value;break;default:return!1}return a%=360,[s.TokenType.Number,a.toString(),e[2],e[3],{value:a,type:s.NumberType.Number}]}return!1}function normalize_legacy_HSL_ChannelValues(e,n){const r=[];for(let o=0;o<e.length;o++){const t=e[o];if(0!==o)if(t[0]!==s.TokenType.Percentage){if(t[0]!==s.TokenType.Number)return!1;{3!==o&&n.syntaxFlags.add(a.HasNumberValues);let e=1;3===o&&(e=1),r.push([s.TokenType.Number,(t[4].value/e).toString(),t[2],t[3],{value:t[4].value/e,type:s.NumberType.Number}])}}else{3===o?n.syntaxFlags.add(a.HasPercentageAlpha):n.syntaxFlags.add(a.HasPercentageValues);let e=1;3===o&&(e=100),r.push([s.TokenType.Number,(t[4].value/e).toString(),t[2],t[3],{value:t[4].value/e,type:s.NumberType.Number}])}else{const e=normalizeHue(t);if(!1===e)return!1;t[0]===s.TokenType.Dimension&&n.syntaxFlags.add(a.HasDimensionValues),r.push(e)}}return!n.syntaxFlags.has(a.HasNumberValues)&&r}function normalize_modern_HSL_ChannelValues(e,n){const r=[];for(let o=0;o<e.length;o++){const t=e[o];if(t[0]!==s.TokenType.Ident||"none"!==toLowerCaseAZ(t[4].value))if(0!==o)if(t[0]!==s.TokenType.Percentage){if(t[0]!==s.TokenType.Number)return!1;{3!==o&&n.syntaxFlags.add(a.HasNumberValues);let e=1;3===o&&(e=1),r.push([s.TokenType.Number,(t[4].value/e).toString(),t[2],t[3],{value:t[4].value/e,type:s.NumberType.Number}])}}else{3===o?n.syntaxFlags.add(a.HasPercentageAlpha):n.syntaxFlags.add(a.HasPercentageValues);let e=1;3===o&&(e=100),r.push([s.TokenType.Number,(t[4].value/e).toString(),t[2],t[3],{value:t[4].value/e,type:s.NumberType.Number}])}else{const e=normalizeHue(t);if(!1===e)return!1;t[0]===s.TokenType.Dimension&&n.syntaxFlags.add(a.HasDimensionValues),r.push(e)}else n.syntaxFlags.add(a.HasNoneKeywords),n.missingComponents[o]=!0,r.push([s.TokenType.Number,"0",t[2],t[3],{value:0,type:s.NumberType.Number}])}return r}function threeChannelLegacySyntax(e,r,t,l,u){const p=[],i=[],c=[],h=[],m={colorSpace:exports.ColorSpace.XYZ_D50,channels:[0,0,0],sourceColorSpace:t,alpha:1,missingComponents:[!1,!1,!1,!1],syntaxFlags:new Set(u)};let y=p;for(let r=0;r<e.value.length;r++){let t=e.value[r];if(!n.isWhitespaceNode(t)&&!n.isCommentNode(t)){if(n.isTokenNode(t)&&t.value[0]===s.TokenType.Comma){if(y===p){y=i;continue}if(y===i){y=c;continue}if(y===c){y=h;continue}if(y===h)return!1}if(n.isFunctionNode(t)){if(y===h&&"var"===toLowerCaseAZ(t.getName())){m.syntaxFlags.add(a.HasVariableAlpha),y.push(t);continue}if("calc"!==toLowerCaseAZ(t.getName()))return!1;const[[e]]=o.calcFromComponentValues([[t]],{toCanonicalUnits:!0,precision:100});if(!e||!n.isTokenNode(e))return!1;t=e}if(!n.isTokenNode(t))return!1;y.push(t)}}if(1!==y.length)return!1;if(1!==p.length||1!==i.length||1!==c.length)return!1;if(!n.isTokenNode(p[0])||!n.isTokenNode(i[0])||!n.isTokenNode(c[0]))return!1;const g=[p[0].value,i[0].value,c[0].value];1===h.length&&(m.syntaxFlags.add(a.HasAlpha),n.isTokenNode(h[0])?g.push(h[0].value):m.alpha=h[0]);const d=r(g,m);return!1!==d&&(m.channels=l([d[0][4].value,d[1][4].value,d[2][4].value]),4===d.length&&(m.alpha=d[3][4].value),m)}function threeChannelSpaceSeparated(e,r,t,l,u){const p=[],i=[],c=[],h=[],m={colorSpace:exports.ColorSpace.XYZ_D50,channels:[0,0,0],sourceColorSpace:t,alpha:1,missingComponents:[!1,!1,!1,!1],syntaxFlags:new Set(u)};let y=p;for(let r=0;r<e.value.length;r++){let t=e.value[r];if(n.isWhitespaceNode(t)||n.isCommentNode(t)){for(;n.isWhitespaceNode(e.value[r+1])||n.isCommentNode(e.value[r+1]);)r++;if(!p.length)continue;if(y===p){y=i;continue}if(y===i){y=c;continue}}else if(n.isTokenNode(t)&&t.value[0]===s.TokenType.Delim&&"/"===t.value[4].value){if(y===h)return!1;y=h}else{if(n.isFunctionNode(t)){if(y===h&&"var"===toLowerCaseAZ(t.getName())){m.syntaxFlags.add(a.HasVariableAlpha),y.push(t);continue}if("calc"!==toLowerCaseAZ(t.getName()))return!1;const[[e]]=o.calcFromComponentValues([[t]],{toCanonicalUnits:!0,precision:100});if(!e||!n.isTokenNode(e))return!1;t=e}if(!n.isTokenNode(t))return!1;y.push(t)}}if(1!==y.length)return!1;if(1!==p.length||1!==i.length||1!==c.length)return!1;if(!n.isTokenNode(p[0])||!n.isTokenNode(i[0])||!n.isTokenNode(c[0]))return!1;const g=[p[0].value,i[0].value,c[0].value];1===h.length&&(m.syntaxFlags.add(a.HasAlpha),n.isTokenNode(h[0])?g.push(h[0].value):m.alpha=h[0]);const d=r(g,m);return!1!==d&&(m.channels=l([d[0][4].value,d[1][4].value,d[2][4].value]),4===d.length&&(m.alpha=d[3][4].value),m)}function hsl(e,a){{const a=hslCommaSeparated(e);if(!1!==a)return a}{const a=hslSpaceSeparated(e);if(!1!==a)return a}return!1}function hslCommaSeparated(e){return threeChannelLegacySyntax(e,normalize_legacy_HSL_ChannelValues,exports.ColorSpace.sRGB,r.xyz.HSL_to_XYZ_D50,[a.LegacyHSL])}function hslSpaceSeparated(e){return threeChannelSpaceSeparated(e,normalize_modern_HSL_ChannelValues,exports.ColorSpace.sRGB,r.xyz.HSL_to_XYZ_D50,[])}function normalize_modern_HWB_ChannelValues(e,n){const r=[];for(let o=0;o<e.length;o++){const t=e[o];if(t[0]!==s.TokenType.Ident||"none"!==toLowerCaseAZ(t[4].value))if(0!==o)if(t[0]!==s.TokenType.Percentage){if(t[0]!==s.TokenType.Number)return!1;if(3!==o)return!1;r.push([s.TokenType.Number,t[1],t[2],t[3],{value:t[4].value,type:s.NumberType.Number}])}else{3===o?n.syntaxFlags.add(a.HasPercentageAlpha):n.syntaxFlags.add(a.HasPercentageValues);let e=1;3===o&&(e=100),r.push([s.TokenType.Number,(t[4].value/e).toString(),t[2],t[3],{value:t[4].value/e,type:s.NumberType.Number}])}else{const e=normalizeHue(t);if(!1===e)return!1;t[0]===s.TokenType.Dimension&&n.syntaxFlags.add(a.HasDimensionValues),r.push(e)}else n.syntaxFlags.add(a.HasNoneKeywords),n.missingComponents[o]=!0,r.push([s.TokenType.Number,"0",t[2],t[3],{value:0,type:s.NumberType.Number}])}return r}function hwb(e,a){{const a=hwbSpaceSeparated(e);if(!1!==a)return a}return!1}function hwbSpaceSeparated(e){return threeChannelSpaceSeparated(e,normalize_modern_HWB_ChannelValues,exports.ColorSpace.sRGB,r.xyz.HWB_to_XYZ_D50,[])}function normalize_legacy_sRGB_ChannelValues(e,n){const r=[];for(let o=0;o<e.length;o++){const t=e[o];if(t[0]!==s.TokenType.Percentage){if(t[0]!==s.TokenType.Number)return!1;{3!==o&&n.syntaxFlags.add(a.HasNumberValues);let e=255;3===o&&(e=1),r.push([s.TokenType.Number,(t[4].value/e).toString(),t[2],t[3],{value:t[4].value/e,type:s.NumberType.Number}])}}else 3===o?n.syntaxFlags.add(a.HasPercentageAlpha):n.syntaxFlags.add(a.HasPercentageValues),r.push([s.TokenType.Number,(t[4].value/100).toString(),t[2],t[3],{value:t[4].value/100,type:s.NumberType.Number}])}return(!n.syntaxFlags.has(a.HasNumberValues)||!n.syntaxFlags.has(a.HasPercentageValues))&&r}function normalize_modern_sRGB_ChannelValues(e,n){const r=[];for(let o=0;o<e.length;o++){const t=e[o];if(t[0]!==s.TokenType.Percentage)if(t[0]!==s.TokenType.Number){if(t[0]!==s.TokenType.Ident||"none"!==toLowerCaseAZ(t[4].value))return!1;n.syntaxFlags.add(a.HasNoneKeywords),n.missingComponents[o]=!0,r.push([s.TokenType.Number,"0",t[2],t[3],{value:0,type:s.NumberType.Number}])}else{3!==o&&n.syntaxFlags.add(a.HasNumberValues);let e=255;3===o&&(e=1),r.push([s.TokenType.Number,(t[4].value/e).toString(),t[2],t[3],{value:t[4].value/e,type:s.NumberType.Number}])}else 3!==o&&n.syntaxFlags.add(a.HasPercentageValues),r.push([s.TokenType.Number,(t[4].value/100).toString(),t[2],t[3],{value:t[4].value/100,type:s.NumberType.Number}])}return r}function rgb(e,a){{const a=rgbCommaSeparated(e);if(!1!==a)return a}{const a=rgbSpaceSeparated(e);if(!1!==a)return a}return!1}function rgbCommaSeparated(e){return threeChannelLegacySyntax(e,normalize_legacy_sRGB_ChannelValues,exports.ColorSpace.sRGB,r.xyz.sRGB_to_XYZ_D50,[a.LegacyRGB])}function rgbSpaceSeparated(e){return threeChannelSpaceSeparated(e,normalize_modern_sRGB_ChannelValues,exports.ColorSpace.sRGB,r.xyz.sRGB_to_XYZ_D50,[])}const l=new Map;for(const[e,a]of Object.entries(r.namedColors))l.set(e,a);function namedColor(e){const n=l.get(toLowerCaseAZ(e));return!!n&&{colorSpace:exports.ColorSpace.XYZ_D50,channels:r.xyz.sRGB_to_XYZ_D50([n[0]/255,n[1]/255,n[2]/255]),sourceColorSpace:exports.ColorSpace.sRGB,alpha:1,missingComponents:[!1,!1,!1,!1],syntaxFlags:new Set([a.ColorKeyword,a.NamedColor])}}exports.color=function color(e){if(n.isFunctionNode(e)){const a=toLowerCaseAZ(e.getName());return"rgb"===a||"rgba"===a?rgb(e):"hsl"===a||"hsla"===a?hsl(e):"hwb"===a&&hwb(e)}if(n.isTokenNode(e)){if(e.value[0]===s.TokenType.Hash)return hex(e.value);if(e.value[0]===s.TokenType.Ident){const n=namedColor(e.value[4].value);if(!1!==n)return n;const s="transparent"===toLowerCaseAZ(e.value[4].value)&&{colorSpace:exports.ColorSpace.XYZ_D50,channels:[0,0,0],sourceColorSpace:exports.ColorSpace.sRGB,alpha:0,missingComponents:[!1,!1,!1,!1],syntaxFlags:new Set([a.ColorKeyword])};return!1!==s&&s}return!1}return!1};
