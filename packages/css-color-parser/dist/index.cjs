"use strict";var e,o=require("@csstools/css-parser-algorithms"),n=require("@csstools/css-tokenizer"),r=require("@csstools/css-calc"),t=require("@csstools/color-helpers");function colorDataChannelsToCalcGlobals(e){const o=new Map;switch(e.currentColorSpace){case exports.ColorSpace.XYZ_D50:o.set("x",dummyNumberToken(e.channels[0])),o.set("y",dummyNumberToken(e.channels[1])),o.set("z",dummyNumberToken(e.channels[2])),o.set("alpha",dummyNumberToken(e.alpha));break;case exports.ColorSpace.sRGB:o.set("r",dummyNumberToken(255*e.channels[0])),o.set("g",dummyNumberToken(255*e.channels[1])),o.set("b",dummyNumberToken(255*e.channels[2])),o.set("alpha",dummyNumberToken(e.alpha))}return o}function dummyNumberToken(e){return[n.TokenType.Number,e.toString(),-1,-1,{value:e,type:n.NumberType.Number}]}function rgb(e,o){{const o=rgbCommaSeparated(e);if(-1!==o)return o}{const o=rgbSpaceSeparated(e);if(-1!==o)return o}{const n=rgbSpaceSeparated_RCS(e,o);if(-1!==n)return n}return-1}function rgbCommaSeparated(e){const a=[],l=[],u=[],s=[];let c=a;for(let t=0;t<e.value.length;t++){let i=e.value[t];if(!o.isWhitespaceNode(i)&&!o.isCommentNode(i)){if(o.isTokenNode(i)&&i.value[0]===n.TokenType.Comma){if(c===a){c=l;continue}if(c===l){c=u;continue}if(c===u){c=s;continue}if(c===s)return-1}if(o.isFunctionNode(i)){if("calc"!==i.getName().toLowerCase())return-1;const[[e]]=r.calcFromComponentValues([[i]],{toCanonicalUnits:!0,precision:100});if(!e||!o.isTokenNode(e))return-1;i=e}if(o.isTokenNode(i)){if(i.value[0]===n.TokenType.Percentage){const e=i.value;c.push([n.TokenType.Number,(e[4].value/100).toString(),e[2],e[3],{value:e[4].value/100,type:n.NumberType.Number}]);continue}if(i.value[0]===n.TokenType.Number){let e=255;c===s&&(e=1);const o=i.value;c.push([n.TokenType.Number,(o[4].value/e).toString(),o[2],o[3],{value:o[4].value/e,type:n.NumberType.Number}]);continue}}return-1}}return 1!==c.length||1!==a.length||1!==l.length||1!==u.length?-1:{channels:t.xyz.sRGB_to_XYZ_D50([a[0][4].value,l[0][4].value,u[0][4].value]),alpha:1===s.length?s[0][4].value:1,currentColorSpace:exports.ColorSpace.XYZ_D50,sourceColorSpace:exports.ColorSpace.sRGB}}function rgbSpaceSeparated(e){const a=[],l=[],u=[],s=[];let c=a;for(let t=0;t<e.value.length;t++){let i=e.value[t];if(o.isWhitespaceNode(i)||o.isCommentNode(i)){for(;o.isWhitespaceNode(e.value[t+1])||o.isCommentNode(e.value[t+1]);)t++;if(!a.length)continue;if(c===a){c=l;continue}if(c===l){c=u;continue}}else{if(!o.isTokenNode(i)||i.value[0]!==n.TokenType.Delim||"/"!==i.value[4].value){if(o.isFunctionNode(i)){if("calc"!==i.getName().toLowerCase())return-1;const[[e]]=r.calcFromComponentValues([[i]],{toCanonicalUnits:!0,precision:100});if(!e||!o.isTokenNode(e))return-1;i=e}if(o.isTokenNode(i)){if(i.value[0]===n.TokenType.Percentage){const e=i.value;c.push([n.TokenType.Number,(e[4].value/100).toString(),e[2],e[3],{value:e[4].value/100,type:n.NumberType.Number}]);continue}if(i.value[0]===n.TokenType.Number){let e=255;c===s&&(e=1);const o=i.value;c.push([n.TokenType.Number,(o[4].value/e).toString(),o[2],o[3],{value:o[4].value/e,type:n.NumberType.Number}]);continue}}return-1}if(c===s)return-1;c=s}}return 1!==c.length||1!==a.length||1!==l.length||1!==u.length?-1:{channels:t.xyz.sRGB_to_XYZ_D50([a[0][4].value,l[0][4].value,u[0][4].value]),alpha:1===s.length?s[0][4].value:1,currentColorSpace:exports.ColorSpace.XYZ_D50,sourceColorSpace:exports.ColorSpace.sRGB}}function rgbSpaceSeparated_RCS(e,a){let l=null;const u=[],s=[],c=[],i=[];let p=u;for(let m=0;m<e.value.length;m++){let v=e.value[m];if(o.isWhitespaceNode(v)||o.isCommentNode(v)){for(;o.isWhitespaceNode(e.value[m+1])||o.isCommentNode(e.value[m+1]);)m++;if(!u.length)continue;if(p===u){p=s;continue}if(p===s){p=c;continue}}else{if(o.isTokenNode(v)&&!l&&v.value[0]===n.TokenType.Ident&&"from"===v.value[4].value.toLowerCase()){for(;o.isWhitespaceNode(e.value[m+1])||o.isCommentNode(e.value[m+1]);)m++;const r=e.value[m+1];if(o.isTokenNode(r)&&r.value[0]===n.TokenType.Ident){const e=r.value[4].value.toLowerCase();if("currentcolor"===e)return-1;if("transparent"===e){l=colorDataChannelsToCalcGlobals({channels:[0,0,0],alpha:0,currentColorSpace:exports.ColorSpace.sRGB,sourceColorSpace:exports.ColorSpace.sRGB}),m++;continue}if(!Object.prototype.hasOwnProperty.call(t.namedColors,e))return-1;const o=t.namedColors[e];if(!o)return-1;l=colorDataChannelsToCalcGlobals({channels:[o[0]/255,o[1]/255,o[2]/255],alpha:1,currentColorSpace:exports.ColorSpace.sRGB,sourceColorSpace:exports.ColorSpace.sRGB}),m++;continue}if(o.isFunctionNode(r)){if("var"===r.getName().toLowerCase())return-1;const e=a(r);if(-1===e)return-1;l=colorDataChannelsToCalcGlobals({channels:t.xyz.XYZ_D50_to_sRGB(e.channels),alpha:e.alpha,currentColorSpace:exports.ColorSpace.sRGB,sourceColorSpace:e.sourceColorSpace}),m++;continue}}if(!l)return-1;if(!o.isTokenNode(v)||v.value[0]!==n.TokenType.Delim||"/"!==v.value[4].value){if(o.isFunctionNode(v)){if("calc"!==v.getName().toLowerCase())return-1;const[[e]]=r.calcFromComponentValues([[v]],{toCanonicalUnits:!0,precision:100,globals:l});if(!e||!o.isTokenNode(e))return-1;v=e}if(o.isTokenNode(v)){if(v.value[0]===n.TokenType.Ident){const e=v.value,n=l.get(e[4].value.toLowerCase());if(!n)return-1;v=new o.TokenNode(n)}if(v.value[0]===n.TokenType.Percentage){const e=v.value;p.push([n.TokenType.Number,(e[4].value/100).toString(),e[2],e[3],{value:e[4].value/100,type:n.NumberType.Number}]);continue}if(v.value[0]===n.TokenType.Number){let e=255;p===i&&(e=1);const o=v.value;p.push([n.TokenType.Number,(o[4].value/e).toString(),o[2],o[3],{value:o[4].value/e,type:n.NumberType.Number}]);continue}}return-1}if(p===i)return-1;p=i}}return 1!==p.length||1!==u.length||1!==s.length||1!==c.length?-1:{channels:t.xyz.sRGB_to_XYZ_D50([u[0][4].value,s[0][4].value,c[0][4].value]),alpha:1===i.length?i[0][4].value:1,currentColorSpace:exports.ColorSpace.XYZ_D50,sourceColorSpace:exports.ColorSpace.sRGB}}exports.ColorSpace=void 0,(e=exports.ColorSpace||(exports.ColorSpace={})).XYZ_D50="xyz-d50",e.XYZ_D65="xyz-d65",e.sRGB="srgb",exports.color=function color(e){return o.isFunctionNode(e)&&("rgb"===e.getName().toLowerCase()||"rgba"===e.getName().toLowerCase())?rgb(e,color):-1};
