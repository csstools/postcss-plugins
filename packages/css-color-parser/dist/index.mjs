import{isWhitespaceNode as e,isCommentNode as a,isTokenNode as n,isFunctionNode as t,TokenNode as r,FunctionNode as o}from"@csstools/css-parser-algorithms";import{TokenType as l,NumberType as s}from"@csstools/css-tokenizer";import{xyz as u,namedColors as i,utils as c,conversions as h,calculations as m}from"@csstools/color-helpers";import{calcFromComponentValues as p}from"@csstools/css-calc";var _,N;function colorData_to_XYZ_D50(e){switch(e.colorNotation){case _.HEX:case _.RGB:return{...e,colorNotation:_.XYZ_D50,channels:u.sRGB_to_XYZ_D50(e.channels.map((e=>Number.isNaN(e)?0:e)))};case _.Linear_RGB:return{...e,colorNotation:_.XYZ_D50,channels:u.lin_sRGB_to_XYZ_D50(e.channels.map((e=>Number.isNaN(e)?0:e)))};case _.Display_P3:return{...e,colorNotation:_.XYZ_D50,channels:u.P3_to_XYZ_D50(e.channels.map((e=>Number.isNaN(e)?0:e)))};case _.Rec2020:return{...e,colorNotation:_.XYZ_D50,channels:u.rec_2020_to_XYZ_D50(e.channels.map((e=>Number.isNaN(e)?0:e)))};case _.A98_RGB:return{...e,colorNotation:_.XYZ_D50,channels:u.a98_RGB_to_XYZ_D50(e.channels.map((e=>Number.isNaN(e)?0:e)))};case _.ProPhoto_RGB:return{...e,colorNotation:_.XYZ_D50,channels:u.proPhoto_RGB_to_XYZ_D50(e.channels.map((e=>Number.isNaN(e)?0:e)))};case _.HSL:return{...e,colorNotation:_.XYZ_D50,channels:u.HSL_to_XYZ_D50(e.channels.map((e=>Number.isNaN(e)?0:e)))};case _.HWB:return{...e,colorNotation:_.XYZ_D50,channels:u.HWB_to_XYZ_D50(e.channels.map((e=>Number.isNaN(e)?0:e)))};case _.Lab:return{...e,colorNotation:_.XYZ_D50,channels:u.Lab_to_XYZ_D50(e.channels.map((e=>Number.isNaN(e)?0:e)))};case _.OKLab:return{...e,colorNotation:_.XYZ_D50,channels:u.OKLab_to_XYZ_D50(e.channels.map((e=>Number.isNaN(e)?0:e)))};case _.LCH:return{...e,colorNotation:_.XYZ_D50,channels:u.LCH_to_XYZ_D50(e.channels.map((e=>Number.isNaN(e)?0:e)))};case _.OKLCH:return{...e,colorNotation:_.XYZ_D50,channels:u.OKLCH_to_XYZ_D50(e.channels.map((e=>Number.isNaN(e)?0:e)))};case _.XYZ_D50:return{...e,colorNotation:_.XYZ_D50,channels:u.XYZ_D50_to_XYZ_D50(e.channels.map((e=>Number.isNaN(e)?0:e)))};case _.XYZ_D65:return{...e,colorNotation:_.XYZ_D50,channels:u.XYZ_D65_to_XYZ_D50(e.channels.map((e=>Number.isNaN(e)?0:e)))};default:throw new Error("Unsupported color notation")}}!function(e){e.A98_RGB="a98-rgb",e.Display_P3="display-p3",e.HEX="hex",e.HSL="hsl",e.HWB="hwb",e.LCH="lch",e.Lab="lab",e.Linear_RGB="srgb-linear",e.OKLCH="oklch",e.OKLab="oklab",e.ProPhoto_RGB="prophoto-rgb",e.RGB="rgb",e.Rec2020="rec2020",e.XYZ_D50="xyz-d50",e.XYZ_D65="xyz-d65"}(_||(_={})),function(e){e.ColorKeyword="color-keyword",e.HasAlpha="has-alpha",e.HasDimensionValues="has-dimension-values",e.HasNoneKeywords="has-none-keywords",e.HasNumberValues="has-number-values",e.HasPercentageAlpha="has-percentage-alpha",e.HasPercentageValues="has-percentage-values",e.HasVariableAlpha="has-variable-alpha",e.Hex="hex",e.LegacyHSL="legacy-hsl",e.LegacyRGB="legacy-rgb",e.NamedColor="named-color",e.RelativeColorSyntax="relative-color-syntax",e.ColorMix="color-mix"}(N||(N={}));const b=new Set([_.A98_RGB,_.Display_P3,_.HEX,_.Linear_RGB,_.ProPhoto_RGB,_.RGB,_.Rec2020,_.XYZ_D50,_.XYZ_D65]);function colorDataTo(e,a){const n=colorData_to_XYZ_D50(e),t={...e};switch(a){case _.HEX:case _.RGB:t.colorNotation=_.RGB,t.channels=u.XYZ_D50_to_sRGB(n.channels);break;case _.Linear_RGB:t.colorNotation=_.Linear_RGB,t.channels=u.XYZ_D50_to_lin_sRGB(n.channels);break;case _.HSL:t.colorNotation=_.HSL,t.channels=u.XYZ_D50_to_HSL(n.channels);break;case _.HWB:t.colorNotation=_.HWB,t.channels=u.XYZ_D50_to_HWB(n.channels);break;case _.Lab:t.colorNotation=_.Lab,t.channels=u.XYZ_D50_to_Lab(n.channels);break;case _.LCH:t.colorNotation=_.LCH,t.channels=u.XYZ_D50_to_LCH(n.channels);break;case _.XYZ_D50:t.colorNotation=_.XYZ_D50,t.channels=u.XYZ_D50_to_XYZ_D50(n.channels);break;case _.XYZ_D65:t.colorNotation=_.XYZ_D65,t.channels=u.XYZ_D50_to_XYZ_D65(n.channels);break;case _.Display_P3:t.colorNotation=_.Display_P3,t.channels=u.XYZ_D50_to_P3(n.channels);break;case _.OKLCH:t.colorNotation=_.OKLCH,t.channels=u.XYZ_D50_to_OKLCH(n.channels);break;case _.OKLab:t.colorNotation=_.OKLab,t.channels=u.XYZ_D50_to_OKLab(n.channels)}if(a===e.colorNotation)return t.channels=carryForwardMissingComponents(e.channels,[0,1,2],t.channels,[0,1,2]),t;if(b.has(a)&&b.has(e.colorNotation))return t.channels=carryForwardMissingComponents(e.channels,[0,1,2],t.channels,[0,1,2]),t;switch(a){case _.HSL:switch(e.colorNotation){case _.HWB:t.channels=carryForwardMissingComponents(e.channels,[0],t.channels,[0]);break;case _.Lab:case _.OKLab:t.channels=carryForwardMissingComponents(e.channels,[2],t.channels,[0]);break;case _.LCH:case _.OKLCH:t.channels=carryForwardMissingComponents(e.channels,[0,1,2],t.channels,[2,1,0])}break;case _.HWB:switch(e.colorNotation){case _.HSL:t.channels=carryForwardMissingComponents(e.channels,[0],t.channels,[0]);break;case _.LCH:case _.OKLCH:t.channels=carryForwardMissingComponents(e.channels,[0],t.channels,[2])}break;case _.Lab:case _.OKLab:switch(e.colorNotation){case _.HSL:t.channels=carryForwardMissingComponents(e.channels,[0],t.channels,[2]);break;case _.Lab:case _.OKLab:case _.LCH:case _.OKLCH:t.channels=carryForwardMissingComponents(e.channels,[0],t.channels,[0])}break;case _.LCH:case _.OKLCH:switch(e.colorNotation){case _.HSL:t.channels=carryForwardMissingComponents(e.channels,[0,1,2],t.channels,[2,1,0]);break;case _.HWB:t.channels=carryForwardMissingComponents(e.channels,[0],t.channels,[2]);break;case _.Lab:case _.OKLab:t.channels=carryForwardMissingComponents(e.channels,[0],t.channels,[0]);break;case _.LCH:case _.OKLCH:t.channels=carryForwardMissingComponents(e.channels,[0,1,2],t.channels,[0,1,2])}}return t}function carryForwardMissingComponents(e,a,n,t){const r=[...n];for(const n of a)Number.isNaN(e[a[n]])&&(r[t[n]]=NaN);return r}function fillInMissingComponents(e,a){const n=[...e];for(let t=0;t<e.length;t++)Number.isNaN(e[t])&&(n[t]=a[t]);return n}const g=/[A-Z]/g;function toLowerCaseAZ(e){return e.replace(g,(e=>String.fromCharCode(e.charCodeAt(0)+32)))}function hex(e){const a=toLowerCaseAZ(e[4].value);if(a.match(/[^a-f0-9]/))return!1;const n={colorNotation:_.HEX,channels:[0,0,0],alpha:1,syntaxFlags:new Set([N.Hex])},t=a.length;if(3===t){const e=a[0],t=a[1],r=a[2];return n.channels=[parseInt(e+e,16)/255,parseInt(t+t,16)/255,parseInt(r+r,16)/255],n}if(6===t){const e=a[0]+a[1],t=a[2]+a[3],r=a[4]+a[5];return n.channels=[parseInt(e,16)/255,parseInt(t,16)/255,parseInt(r,16)/255],n}if(4===t){const e=a[0],t=a[1],r=a[2],o=a[3];return n.channels=[parseInt(e+e,16)/255,parseInt(t+t,16)/255,parseInt(r+r,16)/255],n.alpha=parseInt(o+o,16)/255,n.syntaxFlags.add(N.HasAlpha),n}if(8===t){const e=a[0]+a[1],t=a[2]+a[3],r=a[4]+a[5],o=a[6]+a[7];return n.channels=[parseInt(e,16)/255,parseInt(t,16)/255,parseInt(r,16)/255],n.alpha=parseInt(o,16)/255,n.syntaxFlags.add(N.HasAlpha),n}return!1}function normalizeHue(e){if(e[0]===l.Number)return e[4].value=e[4].value%360,e[1]=e[4].value.toString(),e;if(e[0]===l.Dimension){let a=e[4].value;switch(toLowerCaseAZ(e[4].unit)){case"deg":break;case"rad":a=180*e[4].value/Math.PI;break;case"grad":a=.9*e[4].value;break;case"turn":a=360*e[4].value;break;default:return!1}return a%=360,[l.Number,a.toString(),e[2],e[3],{value:a,type:s.Number}]}return!1}function normalize(e,a,n,t){return Math.min(Math.max(e/a,n),t)}function normalize_legacy_HSL_ChannelValues(e,a){const n=[];for(let t=0;t<e.length;t++){const r=e[t];if(0!==t)if(r[0]!==l.Percentage){if(r[0]!==l.Number)return!1;{3!==t&&a.syntaxFlags.add(N.HasNumberValues);let e=normalize(r[4].value,1,0,100);3===t&&(e=normalize(r[4].value,1,0,1)),n.push([l.Number,e.toString(),r[2],r[3],{value:e,type:s.Number}])}}else{3===t?a.syntaxFlags.add(N.HasPercentageAlpha):a.syntaxFlags.add(N.HasPercentageValues);let e=normalize(r[4].value,1,0,100);3===t&&(e=normalize(r[4].value,100,0,1)),n.push([l.Number,e.toString(),r[2],r[3],{value:e,type:s.Number}])}else{const e=normalizeHue(r);if(!1===e)return!1;r[0]===l.Dimension&&a.syntaxFlags.add(N.HasDimensionValues),n.push(e)}}return!a.syntaxFlags.has(N.HasNumberValues)&&n}function normalize_modern_HSL_ChannelValues(e,a){const n=[];for(let t=0;t<e.length;t++){const r=e[t];if(r[0]!==l.Ident||"none"!==toLowerCaseAZ(r[4].value))if(0!==t)if(r[0]!==l.Percentage){if(r[0]!==l.Number)return!1;{3!==t&&a.syntaxFlags.add(N.HasNumberValues);let e=normalize(r[4].value,1,0,100);3===t&&(e=normalize(r[4].value,1,0,1)),n.push([l.Number,e.toString(),r[2],r[3],{value:e,type:s.Number}])}}else{3===t?a.syntaxFlags.add(N.HasPercentageAlpha):a.syntaxFlags.add(N.HasPercentageValues);let e=normalize(r[4].value,1,0,100);3===t&&(e=normalize(r[4].value,100,0,1)),n.push([l.Number,e.toString(),r[2],r[3],{value:e,type:s.Number}])}else{const e=normalizeHue(r);if(!1===e)return!1;r[0]===l.Dimension&&a.syntaxFlags.add(N.HasDimensionValues),n.push(e)}else a.syntaxFlags.add(N.HasNoneKeywords),n.push([l.Number,"none",r[2],r[3],{value:NaN,type:s.Number}])}return n}function threeChannelLegacySyntax(r,o,s,u){const i=[],c=[],h=[],m=[],_={colorNotation:s,channels:[0,0,0],alpha:1,syntaxFlags:new Set(u)};let b=i;for(let o=0;o<r.value.length;o++){let s=r.value[o];if(!e(s)&&!a(s)){if(n(s)&&s.value[0]===l.Comma){if(b===i){b=c;continue}if(b===c){b=h;continue}if(b===h){b=m;continue}if(b===m)return!1}if(t(s)){if(b===m&&"var"===toLowerCaseAZ(s.getName())){_.syntaxFlags.add(N.HasVariableAlpha),b.push(s);continue}if("calc"!==toLowerCaseAZ(s.getName()))return!1;const[[e]]=p([[s]],{toCanonicalUnits:!0,precision:100});if(!e||!n(e))return!1;s=e}if(!n(s))return!1;b.push(s)}}if(1!==b.length)return!1;if(1!==i.length||1!==c.length||1!==h.length)return!1;if(!n(i[0])||!n(c[0])||!n(h[0]))return!1;const g=[i[0].value,c[0].value,h[0].value];1===m.length&&(_.syntaxFlags.add(N.HasAlpha),n(m[0])?g.push(m[0].value):_.alpha=m[0]);const f=o(g,_);return!1!==f&&(_.channels=[f[0][4].value,f[1][4].value,f[2][4].value],4===f.length&&(_.alpha=f[3][4].value),_)}function threeChannelSpaceSeparated(r,o,s,u){const i=[],c=[],h=[],m=[],_={colorNotation:s,channels:[0,0,0],alpha:1,syntaxFlags:new Set(u)};let b=i;for(let o=0;o<r.value.length;o++){let s=r.value[o];if(e(s)||a(s)){for(;e(r.value[o+1])||a(r.value[o+1]);)o++;if(!i.length)continue;if(b===i){b=c;continue}if(b===c){b=h;continue}}else if(n(s)&&s.value[0]===l.Delim&&"/"===s.value[4].value){if(b===m)return!1;b=m}else{if(t(s)){if(b===m&&"var"===toLowerCaseAZ(s.getName())){_.syntaxFlags.add(N.HasVariableAlpha),b.push(s);continue}if("calc"!==toLowerCaseAZ(s.getName()))return!1;const[[e]]=p([[s]],{toCanonicalUnits:!0,precision:100});if(!e||!n(e))return!1;s=e}if(!n(s))return!1;b.push(s)}}if(1!==b.length)return!1;if(1!==i.length||1!==c.length||1!==h.length)return!1;if(!n(i[0])||!n(c[0])||!n(h[0]))return!1;const g=[i[0].value,c[0].value,h[0].value];1===m.length&&(_.syntaxFlags.add(N.HasAlpha),n(m[0])?g.push(m[0].value):_.alpha=m[0]);const f=o(g,_);return!1!==f&&(_.channels=[f[0][4].value,f[1][4].value,f[2][4].value],4===f.length&&(_.alpha=f[3][4].value),_)}function hsl(e,a){{const a=hslCommaSeparated(e);if(!1!==a)return a}{const a=hslSpaceSeparated(e);if(!1!==a)return a}return!1}function hslCommaSeparated(e){return threeChannelLegacySyntax(e,normalize_legacy_HSL_ChannelValues,_.HSL,[N.LegacyHSL])}function hslSpaceSeparated(e){return threeChannelSpaceSeparated(e,normalize_modern_HSL_ChannelValues,_.HSL,[])}function normalize_HWB_ChannelValues(e,a){const n=[];for(let t=0;t<e.length;t++){const r=e[t];if(r[0]!==l.Ident||"none"!==toLowerCaseAZ(r[4].value))if(0!==t)if(r[0]!==l.Percentage){if(r[0]!==l.Number)return!1;{if(3!==t)return!1;const e=normalize(r[4].value,1,0,1);n.push([l.Number,e.toString(),r[2],r[3],{value:e,type:s.Number}])}}else{3===t?a.syntaxFlags.add(N.HasPercentageAlpha):a.syntaxFlags.add(N.HasPercentageValues);let e=normalize(r[4].value,1,0,100);3===t&&(e=normalize(r[4].value,100,0,1)),n.push([l.Number,e.toString(),r[2],r[3],{value:e,type:s.Number}])}else{const e=normalizeHue(r);if(!1===e)return!1;r[0]===l.Dimension&&a.syntaxFlags.add(N.HasDimensionValues),n.push(e)}else a.syntaxFlags.add(N.HasNoneKeywords),n.push([l.Number,"none",r[2],r[3],{value:NaN,type:s.Number}])}return n}const f=new Map;for(const[e,a]of Object.entries(i))f.set(e,a);function namedColor(e){const a=f.get(toLowerCaseAZ(e));return!!a&&{colorNotation:_.RGB,channels:[a[0]/255,a[1]/255,a[2]/255],alpha:1,syntaxFlags:new Set([N.ColorKeyword,N.NamedColor])}}function normalize_legacy_sRGB_ChannelValues(e,a){const n=[];for(let t=0;t<e.length;t++){const r=e[t];if(r[0]!==l.Percentage){if(r[0]!==l.Number)return!1;{3!==t&&a.syntaxFlags.add(N.HasNumberValues);let e=normalize(r[4].value,255,0,1);3===t&&(e=normalize(r[4].value,1,0,1)),n.push([l.Number,e.toString(),r[2],r[3],{value:e,type:s.Number}])}}else{3===t?a.syntaxFlags.add(N.HasPercentageAlpha):a.syntaxFlags.add(N.HasPercentageValues);const e=normalize(r[4].value,100,0,1);n.push([l.Number,e.toString(),r[2],r[3],{value:e,type:s.Number}])}}return(!a.syntaxFlags.has(N.HasNumberValues)||!a.syntaxFlags.has(N.HasPercentageValues))&&n}function normalize_modern_sRGB_ChannelValues(e,a){const n=[];for(let t=0;t<e.length;t++){const r=e[t];if(r[0]!==l.Ident||"none"!==toLowerCaseAZ(r[4].value))if(r[0]!==l.Percentage){if(r[0]!==l.Number)return!1;{3!==t&&a.syntaxFlags.add(N.HasNumberValues);let e=normalize(r[4].value,255,0,1);3===t&&(e=normalize(r[4].value,1,0,1)),n.push([l.Number,e.toString(),r[2],r[3],{value:e,type:s.Number}])}}else{3!==t&&a.syntaxFlags.add(N.HasPercentageValues);const e=normalize(r[4].value,100,0,1);n.push([l.Number,e.toString(),r[2],r[3],{value:e,type:s.Number}])}else a.syntaxFlags.add(N.HasNoneKeywords),n.push([l.Number,"none",r[2],r[3],{value:NaN,type:s.Number}])}return n}function rgb(e,a){{const a=rgbCommaSeparated(e);if(!1!==a)return a}{const a=rgbSpaceSeparated(e);if(!1!==a)return a}return!1}function rgbCommaSeparated(e){return threeChannelLegacySyntax(e,normalize_legacy_sRGB_ChannelValues,_.RGB,[N.LegacyRGB])}function rgbSpaceSeparated(e){return threeChannelSpaceSeparated(e,normalize_modern_sRGB_ChannelValues,_.RGB,[])}function normalize_Lab_ChannelValues(e,a){const n=[];for(let t=0;t<e.length;t++){const r=e[t];if(r[0]!==l.Ident||"none"!==toLowerCaseAZ(r[4].value))if(r[0]!==l.Percentage){if(r[0]!==l.Number)return!1;{3!==t&&a.syntaxFlags.add(N.HasNumberValues);let e=normalize(r[4].value,1,0,100);1===t||2===t?e=normalize(r[4].value,1,-1/0,1/0):3===t&&(e=normalize(r[4].value,1,0,1)),n.push([l.Number,e.toString(),r[2],r[3],{value:r[4].value,type:s.Number}])}}else{3!==t&&a.syntaxFlags.add(N.HasPercentageValues);let e=normalize(r[4].value,1,0,100);1===t||2===t?e=normalize(r[4].value,.8,-1/0,1/0):3===t&&(e=normalize(r[4].value,100,0,1)),n.push([l.Number,e.toString(),r[2],r[3],{value:e,type:s.Number}])}else a.syntaxFlags.add(N.HasNoneKeywords),n.push([l.Number,"none",r[2],r[3],{value:NaN,type:s.Number}])}return n}const d=new Set(["srgb","srgb-linear","lab","oklab","xyz","xyz-d50","xyz-d65"]),v=new Set(["hsl","hwb","lch","oklch"]),y=new Set(["shorter","longer","increasing","decreasing"]);function colorMix(t,r){let o=null,s=null,u=null,i=!1;for(let c=0;c<t.value.length;c++){const h=t.value[c];if(!e(h)&&!a(h)){if(n(h)&&h.value[0]===l.Ident){if(!o&&"in"===toLowerCaseAZ(h.value[4].value)){o=h;continue}if(o&&!s){s=toLowerCaseAZ(h.value[4].value);continue}if(o&&s&&!u&&v.has(s)){u=toLowerCaseAZ(h.value[4].value);continue}if(o&&s&&u&&!i&&"hue"===toLowerCaseAZ(h.value[4].value)){i=!0;continue}return!1}return!(!n(h)||h.value[0]!==l.Comma)&&(!!s&&(u||i?!!(s&&u&&i&&v.has(s)&&y.has(u))&&colorMixPolar(s,u,colorMixComponents(t.value.slice(c+1),r)):d.has(s)?colorMixRectangular(s,colorMixComponents(t.value.slice(c+1),r)):!!v.has(s)&&colorMixPolar(s,"shorter",colorMixComponents(t.value.slice(c+1),r))))}}return!1}function colorMixComponents(r,o){const s=[];let u=1,i=!1,c=!1;for(let u=0;u<r.length;u++){let h=r[u];if(!e(h)&&!a(h))if(n(h)&&h.value[0]===l.Comma){if(!i)return!1;s.push({color:i,percentage:c}),i=!1,c=!1}else{if(!i){const e=o(h);if(e){i=e;continue}}if(c||(t(h)&&"calc"===toLowerCaseAZ(h.getName())&&([[h]]=p([[h]],{toCanonicalUnits:!0,precision:100})),!(n(h)&&h.value[0]===l.Percentage&&h.value[4].value>=0)))return!1;c=h.value[4].value}}if(i&&s.push({color:i,percentage:c}),2!==s.length)return!1;let h=s[0].percentage,m=s[1].percentage;return!1===h&&!1===m?(h=50,m=50):!1!==h&&!1===m?m=100-h:!1===h&&!1!==m&&(h=100-m),(0!==h||0!==m)&&(!1!==h&&!1!==m&&(h+m>100&&(h=h/(h+m)*100,m=m/(h+m)*100),h+m<100&&(u=(h+m)/100,h=h/(h+m)*100,m=m/(h+m)*100),{a:{color:s[0].color,percentage:h},b:{color:s[1].color,percentage:m},alphaMultiplier:u}))}function colorMixRectangular(e,a){return!1}function colorMixPolar(e,a,n){if(!n)return!1;const t=n.a.color,r=n.b.color,o=n.a.percentage/100;let l=t.channels,s=r.channels,u=0,i=0,c=0,h=0,m=0,p=0,b=t.alpha;if("number"!=typeof b)return!1;let g=r.alpha;if("number"!=typeof g)return!1;switch(b=Number.isNaN(b)?g:b,g=Number.isNaN(g)?b:g,e){case"hsl":t.colorNotation!==_.HSL&&(l=colorDataTo(t,_.HSL).channels),r.colorNotation!==_.HSL&&(s=colorDataTo(r,_.HSL).channels),l=fillInMissingComponents(l,s),s=fillInMissingComponents(s,l),u=l[0],i=s[0],c=l[1],h=s[1],m=l[2],p=s[2];break;case"hwb":t.colorNotation!==_.HWB&&(l=colorDataTo(t,_.HWB).channels),r.colorNotation!==_.HWB&&(s=colorDataTo(r,_.HWB).channels),l=fillInMissingComponents(l,s),s=fillInMissingComponents(s,l),u=l[0],i=s[0],c=l[1],h=s[1],m=l[2],p=s[2]}const f=i-u;switch(a){case"shorter":f>180?u+=360:f<-180&&(i+=360);break;case"longer":-180<f&&f<180&&(f>0?u+=360:i+=360);break;case"increasing":f<0&&(i+=360);break;case"decreasing":f>0&&(u+=360);break;default:throw new Error("Unknown hue interpolation method")}c=premultiply(c,b),m=premultiply(m,b),h=premultiply(h,g),p=premultiply(p,g);let d=_.RGB,v=[0,0,0],y=1;switch(e){case"hsl":{y=interpolate(b,g,o);const e=interpolate(u,i,o);let a=interpolate(c,h,o),n=interpolate(m,p,o);a=un_premultiply(a,y),n=un_premultiply(n,y),v=[e,a,n],d=_.HSL;break}case"hwb":{y=interpolate(b,g,o);const e=interpolate(u,i,o);let a=interpolate(c,h,o),n=interpolate(m,p,o);a=un_premultiply(a,y),n=un_premultiply(n,y),v=[e,a,n],d=_.HWB;break}}return{colorNotation:d,channels:v,alpha:y*n.alphaMultiplier,syntaxFlags:new Set([N.ColorMix])}}function interpolate(e,a,n){return Number.isNaN(e)?a:Number.isNaN(a)?e:e*n+a*(1-n)}function premultiply(e,a){return Number.isNaN(a)?e:Number.isNaN(e)?NaN:e*a}function un_premultiply(e,a){return 0===a||Number.isNaN(a)?e:Number.isNaN(e)?NaN:e/a}function normalize_OKLab_ChannelValues(e,a){const n=[];for(let t=0;t<e.length;t++){const r=e[t];if(r[0]!==l.Ident||"none"!==toLowerCaseAZ(r[4].value))if(r[0]!==l.Percentage){if(r[0]!==l.Number)return!1;{3!==t&&a.syntaxFlags.add(N.HasNumberValues);let e=normalize(r[4].value,1,0,1);1===t||2===t?e=normalize(r[4].value,1,-1/0,1/0):3===t&&(e=normalize(r[4].value,1,0,1)),n.push([l.Number,e.toString(),r[2],r[3],{value:r[4].value,type:s.Number}])}}else{3!==t&&a.syntaxFlags.add(N.HasPercentageValues);let e=normalize(r[4].value,100,0,1);1===t||2===t?e=normalize(r[4].value,250,-1/0,1/0):3===t&&(e=normalize(r[4].value,100,0,1)),n.push([l.Number,e.toString(),r[2],r[3],{value:e,type:s.Number}])}else a.syntaxFlags.add(N.HasNoneKeywords),n.push([l.Number,"none",r[2],r[3],{value:NaN,type:s.Number}])}return n}function normalize_LCH_ChannelValues(e,a){const n=[];for(let t=0;t<e.length;t++){const r=e[t];if(r[0]!==l.Ident||"none"!==toLowerCaseAZ(r[4].value))if(2!==t)if(r[0]!==l.Percentage){if(r[0]!==l.Number)return!1;{3!==t&&a.syntaxFlags.add(N.HasNumberValues);let e=normalize(r[4].value,1,0,100);1===t?e=normalize(r[4].value,1,0,1/0):3===t&&(e=normalize(r[4].value,1,0,1)),n.push([l.Number,e.toString(),r[2],r[3],{value:r[4].value,type:s.Number}])}}else{3!==t&&a.syntaxFlags.add(N.HasPercentageValues);let e=normalize(r[4].value,1,0,100);1===t?e=normalize(r[4].value,100/150,0,1/0):3===t&&(e=normalize(r[4].value,100,0,1)),n.push([l.Number,e.toString(),r[2],r[3],{value:e,type:s.Number}])}else{const e=normalizeHue(r);if(!1===e)return!1;r[0]===l.Dimension&&a.syntaxFlags.add(N.HasDimensionValues),n.push(e)}else a.syntaxFlags.add(N.HasNoneKeywords),n.push([l.Number,"none",r[2],r[3],{value:NaN,type:s.Number}])}return n}function toPrecision(e,a=7){e=+e,a=+a;const n=(Math.floor(e)+"").length;if(a>n)return+e.toFixed(a-n);{const t=10**(n-a);return Math.round(e/t)*t}}function serializeRGB(e){let a=e.channels.map((e=>Number.isNaN(e)?0:e));e.colorNotation!==_.RGB&&e.colorNotation!==_.HEX&&(a=XYZ_D50_to_sRGB_Gamut(colorData_to_XYZ_D50(e).channels));const n=Math.min(255,Math.max(0,Math.round(255*toPrecision(a[0])))),t=Math.min(255,Math.max(0,Math.round(255*toPrecision(a[1])))),u=Math.min(255,Math.max(0,Math.round(255*toPrecision(a[2])))),i=[l.CloseParen,")",-1,-1,void 0],c=[l.Whitespace," ",-1,-1,void 0],h=[l.Comma,",",-1,-1,void 0],m=[new r([l.Number,n.toString(),-1,-1,{value:a[0],type:s.Integer}]),new r(h),new r(c),new r([l.Number,t.toString(),-1,-1,{value:a[1],type:s.Integer}]),new r(h),new r(c),new r([l.Number,u.toString(),-1,-1,{value:a[2],type:s.Integer}])];if("number"==typeof e.alpha){const a=Math.min(1,Math.max(0,toPrecision(Number.isNaN(e.alpha)?0:e.alpha)));return 1===a?new o([l.Function,"rgb(",-1,-1,{value:"rgb"}],i,m):new o([l.Function,"rgba(",-1,-1,{value:"rgba"}],i,[...m,new r(h),new r(c),new r([l.Number,a.toString(),-1,-1,{value:e.alpha,type:s.Integer}])])}return new o([l.Function,"rgba(",-1,-1,{value:"rgba"}],i,[...m,new r(h),new r(c),e.alpha])}function XYZ_D50_to_sRGB_Gamut(e){const a=u.XYZ_D50_to_sRGB(e);if(c.inGamut(a))return c.clip(a);let n=e.slice();return n=h.D50_to_D65(n),n=h.XYZ_to_OKLab(n),n=h.OKLab_to_OKLCH(n),n[0]<1e-6&&(n=[0,0,0]),n[0]>.999999&&(n=[1,0,0]),m.mapGamut(n,(e=>(e=h.OKLCH_to_OKLab(e),e=h.OKLab_to_XYZ(e),e=h.XYZ_to_lin_sRGB(e),h.gam_sRGB(e))),(e=>(e=h.lin_sRGB(e),e=h.lin_sRGB_to_XYZ(e),e=h.XYZ_to_OKLab(e),h.OKLab_to_OKLCH(e))))}function serializeP3(e){let a=e.channels.map((e=>Number.isNaN(e)?0:e));e.colorNotation!==_.RGB&&e.colorNotation!==_.HEX&&(a=XYZ_D50_to_P3_Gamut(colorData_to_XYZ_D50(e).channels));const n=toPrecision(a[0],6),t=toPrecision(a[1],6),u=toPrecision(a[2],6),i=[l.Function,"color(",-1,-1,{value:"color"}],c=[l.CloseParen,")",-1,-1,void 0],h=[l.Whitespace," ",-1,-1,void 0],m=[new r([l.Ident,"display-p3",-1,-1,{value:"display-p3"}]),new r(h),new r([l.Number,n.toString(),-1,-1,{value:a[0],type:s.Number}]),new r(h),new r([l.Number,t.toString(),-1,-1,{value:a[1],type:s.Number}]),new r(h),new r([l.Number,u.toString(),-1,-1,{value:a[2],type:s.Number}])];if("number"==typeof e.alpha){const a=Math.min(1,Math.max(0,toPrecision(Number.isNaN(e.alpha)?0:e.alpha)));return new o(i,c,1===a?m:[...m,new r(h),new r([l.Delim,"/",-1,-1,{value:"/"}]),new r(h),new r([l.Number,a.toString(),-1,-1,{value:e.alpha,type:s.Integer}])])}return new o(i,c,[...m,new r(h),new r([l.Delim,"/",-1,-1,{value:"/"}]),new r(h),e.alpha])}function XYZ_D50_to_P3_Gamut(e){const a=u.XYZ_D50_to_P3(e);if(c.inGamut(a))return c.clip(a);let n=e.slice();return n=h.D50_to_D65(n),n=h.XYZ_to_OKLab(n),n=h.OKLab_to_OKLCH(n),n[0]<1e-6&&(n=[0,0,0]),n[0]>.999999&&(n=[1,0,0]),m.mapGamut(n,(e=>(e=h.OKLCH_to_OKLab(e),e=h.OKLab_to_XYZ(e),e=h.XYZ_to_lin_P3(e),h.gam_P3(e))),(e=>(e=h.lin_P3(e),e=h.lin_P3_to_XYZ(e),e=h.XYZ_to_OKLab(e),h.OKLab_to_OKLCH(e))))}function color(e){if(t(e)){switch(toLowerCaseAZ(e.getName())){case"rgb":case"rgba":return rgb(e);case"hsl":case"hsla":return hsl(e);case"hwb":return threeChannelSpaceSeparated(e,normalize_HWB_ChannelValues,_.HWB,[]);case"lab":return threeChannelSpaceSeparated(e,normalize_Lab_ChannelValues,_.Lab,[]);case"lch":return threeChannelSpaceSeparated(e,normalize_LCH_ChannelValues,_.LCH,[]);case"oklab":return threeChannelSpaceSeparated(e,normalize_OKLab_ChannelValues,_.OKLab,[]);case"color-mix":return colorMix(e,color);default:return!1}}if(n(e)){if(e.value[0]===l.Hash)return hex(e.value);if(e.value[0]===l.Ident){const a=namedColor(e.value[4].value);if(!1!==a)return a;const n="transparent"===toLowerCaseAZ(e.value[4].value)&&{colorNotation:_.RGB,channels:[0,0,0],alpha:0,syntaxFlags:new Set([N.ColorKeyword])};return!1!==n&&n}return!1}return!1}export{_ as ColorNotation,N as SyntaxFlag,color,serializeP3,serializeRGB};
