import{TokenType as e,NumberType as a}from"@csstools/css-tokenizer";import{xyz as n,utils as o,conversions as t,calculations as r,namedColors as l}from"@csstools/color-helpers";import{isWhitespaceNode as s,isCommentNode as c,isTokenNode as u,isFunctionNode as i,TokenNode as h,FunctionNode as m,WhitespaceNode as p}from"@csstools/css-parser-algorithms";import{mathFunctionNames as _,calcFromComponentValues as N}from"@csstools/css-calc";var b,g;function colorData_to_XYZ_D50(e){switch(e.colorNotation){case b.HEX:case b.RGB:case b.sRGB:return{...e,colorNotation:b.XYZ_D50,channels:n.sRGB_to_XYZ_D50(e.channels.map((e=>Number.isNaN(e)?0:e)))};case b.Linear_sRGB:return{...e,colorNotation:b.XYZ_D50,channels:n.lin_sRGB_to_XYZ_D50(e.channels.map((e=>Number.isNaN(e)?0:e)))};case b.Display_P3:return{...e,colorNotation:b.XYZ_D50,channels:n.P3_to_XYZ_D50(e.channels.map((e=>Number.isNaN(e)?0:e)))};case b.Rec2020:return{...e,colorNotation:b.XYZ_D50,channels:n.rec_2020_to_XYZ_D50(e.channels.map((e=>Number.isNaN(e)?0:e)))};case b.A98_RGB:return{...e,colorNotation:b.XYZ_D50,channels:n.a98_RGB_to_XYZ_D50(e.channels.map((e=>Number.isNaN(e)?0:e)))};case b.ProPhoto_RGB:return{...e,colorNotation:b.XYZ_D50,channels:n.ProPhoto_RGB_to_XYZ_D50(e.channels.map((e=>Number.isNaN(e)?0:e)))};case b.HSL:return{...e,colorNotation:b.XYZ_D50,channels:n.HSL_to_XYZ_D50(e.channels.map((e=>Number.isNaN(e)?0:e)))};case b.HWB:return{...e,colorNotation:b.XYZ_D50,channels:n.HWB_to_XYZ_D50(e.channels.map((e=>Number.isNaN(e)?0:e)))};case b.Lab:return{...e,colorNotation:b.XYZ_D50,channels:n.Lab_to_XYZ_D50(e.channels.map((e=>Number.isNaN(e)?0:e)))};case b.OKLab:return{...e,colorNotation:b.XYZ_D50,channels:n.OKLab_to_XYZ_D50(e.channels.map((e=>Number.isNaN(e)?0:e)))};case b.LCH:return{...e,colorNotation:b.XYZ_D50,channels:n.LCH_to_XYZ_D50(e.channels.map((e=>Number.isNaN(e)?0:e)))};case b.OKLCH:return{...e,colorNotation:b.XYZ_D50,channels:n.OKLCH_to_XYZ_D50(e.channels.map((e=>Number.isNaN(e)?0:e)))};case b.XYZ_D50:return{...e,colorNotation:b.XYZ_D50,channels:n.XYZ_D50_to_XYZ_D50(e.channels.map((e=>Number.isNaN(e)?0:e)))};case b.XYZ_D65:return{...e,colorNotation:b.XYZ_D50,channels:n.XYZ_D65_to_XYZ_D50(e.channels.map((e=>Number.isNaN(e)?0:e)))};default:throw new Error("Unsupported color notation")}}!function(e){e.A98_RGB="a98-rgb",e.Display_P3="display-p3",e.HEX="hex",e.HSL="hsl",e.HWB="hwb",e.LCH="lch",e.Lab="lab",e.Linear_sRGB="srgb-linear",e.OKLCH="oklch",e.OKLab="oklab",e.ProPhoto_RGB="prophoto-rgb",e.RGB="rgb",e.sRGB="srgb",e.Rec2020="rec2020",e.XYZ_D50="xyz-d50",e.XYZ_D65="xyz-d65"}(b||(b={})),function(e){e.ColorKeyword="color-keyword",e.HasAlpha="has-alpha",e.HasDimensionValues="has-dimension-values",e.HasNoneKeywords="has-none-keywords",e.HasNumberValues="has-number-values",e.HasPercentageAlpha="has-percentage-alpha",e.HasPercentageValues="has-percentage-values",e.HasVariableAlpha="has-variable-alpha",e.Hex="hex",e.LegacyHSL="legacy-hsl",e.LegacyRGB="legacy-rgb",e.NamedColor="named-color",e.RelativeColorSyntax="relative-color-syntax",e.ColorMix="color-mix",e.ContrastColor="contrast-color",e.Experimental="experimental"}(g||(g={}));const d=new Set([b.A98_RGB,b.Display_P3,b.HEX,b.Linear_sRGB,b.ProPhoto_RGB,b.RGB,b.sRGB,b.Rec2020,b.XYZ_D50,b.XYZ_D65]);function colorDataTo(e,a){const o={...e};if(e.colorNotation!==a){const e=colorData_to_XYZ_D50(o);switch(a){case b.HEX:case b.RGB:o.colorNotation=b.RGB,o.channels=n.XYZ_D50_to_sRGB(e.channels);break;case b.sRGB:o.colorNotation=b.sRGB,o.channels=n.XYZ_D50_to_sRGB(e.channels);break;case b.Linear_sRGB:o.colorNotation=b.Linear_sRGB,o.channels=n.XYZ_D50_to_lin_sRGB(e.channels);break;case b.Display_P3:o.colorNotation=b.Display_P3,o.channels=n.XYZ_D50_to_P3(e.channels);break;case b.Rec2020:o.colorNotation=b.Rec2020,o.channels=n.XYZ_D50_to_rec_2020(e.channels);break;case b.ProPhoto_RGB:o.colorNotation=b.ProPhoto_RGB,o.channels=n.XYZ_D50_to_ProPhoto(e.channels);break;case b.A98_RGB:o.colorNotation=b.A98_RGB,o.channels=n.XYZ_D50_to_a98_RGB(e.channels);break;case b.HSL:o.colorNotation=b.HSL,o.channels=n.XYZ_D50_to_HSL(e.channels);break;case b.HWB:o.colorNotation=b.HWB,o.channels=n.XYZ_D50_to_HWB(e.channels);break;case b.Lab:o.colorNotation=b.Lab,o.channels=n.XYZ_D50_to_Lab(e.channels);break;case b.LCH:o.colorNotation=b.LCH,o.channels=n.XYZ_D50_to_LCH(e.channels);break;case b.OKLCH:o.colorNotation=b.OKLCH,o.channels=n.XYZ_D50_to_OKLCH(e.channels);break;case b.OKLab:o.colorNotation=b.OKLab,o.channels=n.XYZ_D50_to_OKLab(e.channels);break;case b.XYZ_D50:o.colorNotation=b.XYZ_D50,o.channels=n.XYZ_D50_to_XYZ_D50(e.channels);break;case b.XYZ_D65:o.colorNotation=b.XYZ_D65,o.channels=n.XYZ_D50_to_XYZ_D65(e.channels);break;default:throw new Error("Unsupported color notation")}}else o.channels=e.channels.map((e=>Number.isNaN(e)?0:e));if(a===e.colorNotation)o.channels=carryForwardMissingComponents(e.channels,[0,1,2],o.channels,[0,1,2]);else if(d.has(a)&&d.has(e.colorNotation))o.channels=carryForwardMissingComponents(e.channels,[0,1,2],o.channels,[0,1,2]);else switch(a){case b.HSL:switch(e.colorNotation){case b.HWB:o.channels=carryForwardMissingComponents(e.channels,[0],o.channels,[0]);break;case b.Lab:case b.OKLab:o.channels=carryForwardMissingComponents(e.channels,[2],o.channels,[0]);break;case b.LCH:case b.OKLCH:o.channels=carryForwardMissingComponents(e.channels,[0,1,2],o.channels,[2,1,0])}break;case b.HWB:switch(e.colorNotation){case b.HSL:o.channels=carryForwardMissingComponents(e.channels,[0],o.channels,[0]);break;case b.LCH:case b.OKLCH:o.channels=carryForwardMissingComponents(e.channels,[0],o.channels,[2])}break;case b.Lab:case b.OKLab:switch(e.colorNotation){case b.HSL:o.channels=carryForwardMissingComponents(e.channels,[0],o.channels,[2]);break;case b.Lab:case b.OKLab:o.channels=carryForwardMissingComponents(e.channels,[0,1,2],o.channels,[0,1,2]);break;case b.LCH:case b.OKLCH:o.channels=carryForwardMissingComponents(e.channels,[0],o.channels,[0])}break;case b.LCH:case b.OKLCH:switch(e.colorNotation){case b.HSL:o.channels=carryForwardMissingComponents(e.channels,[0,1,2],o.channels,[2,1,0]);break;case b.HWB:o.channels=carryForwardMissingComponents(e.channels,[0],o.channels,[2]);break;case b.Lab:case b.OKLab:o.channels=carryForwardMissingComponents(e.channels,[0],o.channels,[0]);break;case b.LCH:case b.OKLCH:o.channels=carryForwardMissingComponents(e.channels,[0,1,2],o.channels,[0,1,2])}}return o.channels=convertPowerlessComponentsToMissingComponents(o.channels,a),o}function convertPowerlessComponentsToMissingComponents(e,a){const n=[...e];switch(a){case b.HSL:reducePrecision(n[1],4)<=0&&(n[0]=NaN);break;case b.HWB:Math.max(0,reducePrecision(n[1],4))+Math.max(0,reducePrecision(n[2],4))>=100&&(n[0]=NaN);break;case b.LCH:reducePrecision(n[1],4)<=0&&(n[2]=NaN);break;case b.OKLCH:reducePrecision(n[1],6)<=0&&(n[2]=NaN)}return n}function convertPowerlessComponentsToZeroValuesForDisplay(e,a){const n=[...e];switch(a){case b.HSL:(reducePrecision(n[2])<=0||reducePrecision(n[2])>=100)&&(n[0]=NaN,n[1]=NaN),reducePrecision(n[1])<=0&&(n[0]=NaN);break;case b.HWB:Math.max(0,reducePrecision(n[1]))+Math.max(0,reducePrecision(n[2]))>=100&&(n[0]=NaN);break;case b.Lab:(reducePrecision(n[0])<=0||reducePrecision(n[0])>=100)&&(n[1]=NaN,n[2]=NaN);break;case b.LCH:reducePrecision(n[1])<=0&&(n[2]=NaN),(reducePrecision(n[0])<=0||reducePrecision(n[0])>=100)&&(n[1]=NaN,n[2]=NaN);break;case b.OKLab:(reducePrecision(n[0])<=0||reducePrecision(n[0])>=1)&&(n[1]=NaN,n[2]=NaN);break;case b.OKLCH:reducePrecision(n[1])<=0&&(n[2]=NaN),(reducePrecision(n[0])<=0||reducePrecision(n[0])>=1)&&(n[1]=NaN,n[2]=NaN)}return n}function carryForwardMissingComponents(e,a,n,o){const t=[...n];for(const n of a)Number.isNaN(e[a[n]])&&(t[o[n]]=NaN);return t}function normalizeRelativeColorDataChannels(e){const a=new Map;switch(e.colorNotation){case b.RGB:case b.HEX:a.set("r",dummyNumberToken(255*e.channels[0])),a.set("g",dummyNumberToken(255*e.channels[1])),a.set("b",dummyNumberToken(255*e.channels[2])),"number"==typeof e.alpha&&a.set("alpha",dummyNumberToken(e.alpha));break;case b.HSL:a.set("h",dummyNumberToken(e.channels[0])),a.set("s",dummyNumberToken(e.channels[1])),a.set("l",dummyNumberToken(e.channels[2])),"number"==typeof e.alpha&&a.set("alpha",dummyNumberToken(e.alpha));break;case b.HWB:a.set("h",dummyNumberToken(e.channels[0])),a.set("w",dummyNumberToken(e.channels[1])),a.set("b",dummyNumberToken(e.channels[2])),"number"==typeof e.alpha&&a.set("alpha",dummyNumberToken(e.alpha));break;case b.Lab:case b.OKLab:a.set("l",dummyNumberToken(e.channels[0])),a.set("a",dummyNumberToken(e.channels[1])),a.set("b",dummyNumberToken(e.channels[2])),"number"==typeof e.alpha&&a.set("alpha",dummyNumberToken(e.alpha));break;case b.LCH:case b.OKLCH:a.set("l",dummyNumberToken(e.channels[0])),a.set("c",dummyNumberToken(e.channels[1])),a.set("h",dummyNumberToken(e.channels[2])),"number"==typeof e.alpha&&a.set("alpha",dummyNumberToken(e.alpha));break;case b.sRGB:case b.A98_RGB:case b.Display_P3:case b.Rec2020:case b.Linear_sRGB:case b.ProPhoto_RGB:a.set("r",dummyNumberToken(e.channels[0])),a.set("g",dummyNumberToken(e.channels[1])),a.set("b",dummyNumberToken(e.channels[2])),"number"==typeof e.alpha&&a.set("alpha",dummyNumberToken(e.alpha));break;case b.XYZ_D50:case b.XYZ_D65:a.set("x",dummyNumberToken(e.channels[0])),a.set("y",dummyNumberToken(e.channels[1])),a.set("z",dummyNumberToken(e.channels[2])),"number"==typeof e.alpha&&a.set("alpha",dummyNumberToken(e.alpha))}return a}function noneToZeroInRelativeColorDataChannels(e){const a=new Map;for(const[n,o]of e)Number.isNaN(o[4].value)?a.set(n,dummyNumberToken(0)):a.set(n,o);return a}function dummyNumberToken(n){return[e.Number,n.toString(),-1,-1,{value:n,type:a.Number}]}function reducePrecision(e,a=7){if(Number.isNaN(e))return 0;const n=Math.pow(10,a);return Math.round(e*n)/n}function colorDataFitsRGB_Gamut(e){const a=JSON.parse(JSON.stringify(e));a.channels=convertPowerlessComponentsToZeroValuesForDisplay(a.channels,a.colorNotation);return!colorDataTo(a,b.RGB).channels.find((e=>e<-1e-5||e>1.00001))}function normalize(e,a,n,o){return Math.min(Math.max(e/a,n),o)}const f=/[A-Z]/g;function toLowerCaseAZ(e){return e.replace(f,(e=>String.fromCharCode(e.charCodeAt(0)+32)))}function normalize_Color_ChannelValues(n,o){const t=[];for(let r=0;r<n.length;r++){const l=n[r];if(l[0]!==e.Ident||"none"!==toLowerCaseAZ(l[4].value))if(l[0]!==e.Percentage){if(l[0]!==e.Number)return!1;{3!==r&&o.syntaxFlags.add(g.HasNumberValues);let n=normalize(l[4].value,1,-1/0,1/0);3===r&&(n=normalize(l[4].value,1,0,1)),t.push([e.Number,n.toString(),l[2],l[3],{value:n,type:a.Number}])}}else{3!==r&&o.syntaxFlags.add(g.HasPercentageValues);let n=normalize(l[4].value,100,-1/0,1/0);3===r&&(n=normalize(l[4].value,100,0,1)),t.push([e.Number,n.toString(),l[2],l[3],{value:n,type:a.Number}])}else o.syntaxFlags.add(g.HasNoneKeywords),t.push([e.Number,"none",l[2],l[3],{value:NaN,type:a.Number}])}return t}const v=new Set(["srgb","srgb-linear","display-p3","a98-rgb","prophoto-rgb","rec2020","xyz","xyz-d50","xyz-d65"]);function color$1(a,n){const o=[],t=[],r=[],l=[];let m,p,d=!1,f=!1;const y={colorNotation:b.sRGB,channels:[0,0,0],alpha:1,syntaxFlags:new Set([])};let C=o;for(let b=0;b<a.value.length;b++){let w=a.value[b];if(s(w)||c(w))for(;s(a.value[b+1])||c(a.value[b+1]);)b++;else if(C===o&&o.length&&(C=t),C===t&&t.length&&(C=r),u(w)&&w.value[0]===e.Delim&&"/"===w.value[4].value){if(C===l)return!1;C=l}else{if(i(w)){if(C===l&&"var"===toLowerCaseAZ(w.getName())){y.syntaxFlags.add(g.HasVariableAlpha),C.push(w);continue}if(!_.has(toLowerCaseAZ(w.getName())))return!1;const[[a]]=N([[w]],{toCanonicalUnits:!0,precision:100,globals:p});if(!a||!u(a)||(a.value[0]===e.Percentage||a.value[0]===e.Number||a.value[0]===e.Dimension)&&Number.isNaN(a.value[4].value))return!1;w=a}if(C===o&&0===o.length&&u(w)&&w.value[0]===e.Ident&&v.has(toLowerCaseAZ(w.value[4].value))){if(d)return!1;d=toLowerCaseAZ(w.value[4].value),y.colorNotation=colorSpaceNameToColorNotation(d),f&&(f.colorNotation!==y.colorNotation&&(f=colorDataTo(f,y.colorNotation)),m=normalizeRelativeColorDataChannels(f),p=noneToZeroInRelativeColorDataChannels(m))}else if(C===o&&0===o.length&&u(w)&&w.value[0]===e.Ident&&"from"===toLowerCaseAZ(w.value[4].value)){if(f)return!1;if(d)return!1;for(;s(a.value[b+1])||c(a.value[b+1]);)b++;if(b++,w=a.value[b],f=n(w),!1===f)return!1;f.syntaxFlags.has(g.Experimental)&&y.syntaxFlags.add(g.Experimental),y.syntaxFlags.add(g.RelativeColorSyntax)}else{if(!u(w))return!1;if(w.value[0]===e.Ident&&m&&m.has(toLowerCaseAZ(w.value[4].value))){C.push(new h(m.get(toLowerCaseAZ(w.value[4].value))));continue}C.push(w)}}}if(!d)return!1;if(1!==C.length)return!1;if(1!==o.length||1!==t.length||1!==r.length)return!1;if(!u(o[0])||!u(t[0])||!u(r[0]))return!1;if(m&&!m.has("alpha"))return!1;const w=[o[0].value,t[0].value,r[0].value];1===l.length?(y.syntaxFlags.add(g.HasAlpha),u(l[0])?w.push(l[0].value):y.alpha=l[0]):m&&m.has("alpha")&&w.push(m.get("alpha"));const L=normalize_Color_ChannelValues(w,y);return!1!==L&&(y.channels=[L[0][4].value,L[1][4].value,L[2][4].value],4===L.length&&(y.alpha=L[3][4].value),y)}function colorSpaceNameToColorNotation(e){switch(e){case"srgb":return b.sRGB;case"srgb-linear":return b.Linear_sRGB;case"display-p3":return b.Display_P3;case"a98-rgb":return b.A98_RGB;case"prophoto-rgb":return b.ProPhoto_RGB;case"rec2020":return b.Rec2020;case"xyz":case"xyz-d65":return b.XYZ_D65;case"xyz-d50":return b.XYZ_D50;default:throw new Error("Unknown color space name: "+e)}}const y=new Set(["srgb","srgb-linear","lab","oklab","xyz","xyz-d50","xyz-d65"]),C=new Set(["hsl","hwb","lch","oklch"]),w=new Set(["shorter","longer","increasing","decreasing"]);function colorMix(a,n){let o=null,t=null,r=null,l=!1;for(let i=0;i<a.value.length;i++){const h=a.value[i];if(!s(h)&&!c(h)){if(u(h)&&h.value[0]===e.Ident){if(!o&&"in"===toLowerCaseAZ(h.value[4].value)){o=h;continue}if(o&&!t){t=toLowerCaseAZ(h.value[4].value);continue}if(o&&t&&!r&&C.has(t)){r=toLowerCaseAZ(h.value[4].value);continue}if(o&&t&&r&&!l&&"hue"===toLowerCaseAZ(h.value[4].value)){l=!0;continue}return!1}return!(!u(h)||h.value[0]!==e.Comma)&&(!!t&&(r||l?!!(t&&r&&l&&C.has(t)&&w.has(r))&&colorMixPolar(t,r,colorMixComponents(a.value.slice(i+1),n)):y.has(t)?colorMixRectangular(t,colorMixComponents(a.value.slice(i+1),n)):!!C.has(t)&&colorMixPolar(t,"shorter",colorMixComponents(a.value.slice(i+1),n))))}}return!1}function colorMixComponents(a,n){const o=[];let t=1,r=!1,l=!1;for(let t=0;t<a.length;t++){let h=a[t];if(!s(h)&&!c(h)){if(!u(h)||h.value[0]!==e.Comma){if(!r){const e=n(h);if(e){r=e;continue}}if(!l){if(i(h)&&_.has(toLowerCaseAZ(h.getName()))&&([[h]]=N([[h]],{toCanonicalUnits:!0,precision:100}),!h||!u(h)||(h.value[0]===e.Percentage||h.value[0]===e.Number||h.value[0]===e.Dimension)&&Number.isNaN(h.value[4].value)))return!1;if(u(h)&&h.value[0]===e.Percentage&&h.value[4].value>=0){l=h.value[4].value;continue}}return!1}if(!r)return!1;o.push({color:r,percentage:l}),r=!1,l=!1}}if(r&&o.push({color:r,percentage:l}),2!==o.length)return!1;let h=o[0].percentage,m=o[1].percentage;return(!1===h||!(h<0||h>100))&&((!1===m||!(m<0||m>100))&&(!1===h&&!1===m?(h=50,m=50):!1!==h&&!1===m?m=100-h:!1===h&&!1!==m&&(h=100-m),(0!==h||0!==m)&&(!1!==h&&!1!==m&&(h+m>100&&(h=h/(h+m)*100,m=m/(h+m)*100),h+m<100&&(t=(h+m)/100,h=h/(h+m)*100,m=m/(h+m)*100),{a:{color:o[0].color,percentage:h},b:{color:o[1].color,percentage:m},alphaMultiplier:t}))))}function colorMixRectangular(e,a){if(!a)return!1;const n=a.a.color,o=a.b.color,t=a.a.percentage/100;let r=n.channels,l=o.channels,s=b.RGB,c=n.alpha;if("number"!=typeof c)return!1;let u=o.alpha;if("number"!=typeof u)return!1;switch(c=Number.isNaN(c)?u:c,u=Number.isNaN(u)?c:u,e){case"srgb":s=b.RGB;break;case"srgb-linear":s=b.Linear_sRGB;break;case"lab":s=b.Lab;break;case"oklab":s=b.OKLab;break;case"xyz-d50":s=b.XYZ_D50;break;case"xyz":case"xyz-d65":s=b.XYZ_D65}r=colorDataTo(n,s).channels,l=colorDataTo(o,s).channels,r[0]=premultiply(r[0],c),r[1]=premultiply(r[1],c),r[2]=premultiply(r[2],c),l[0]=premultiply(l[0],u),l[1]=premultiply(l[1],u),l[2]=premultiply(l[2],u);const i=interpolate(c,u,t),h={colorNotation:s,channels:[un_premultiply(interpolate(r[0],l[0],t),i),un_premultiply(interpolate(r[1],l[1],t),i),un_premultiply(interpolate(r[2],l[2],t),i)],alpha:i*a.alphaMultiplier,syntaxFlags:new Set([g.ColorMix])};return(a.a.color.syntaxFlags.has(g.Experimental)||a.b.color.syntaxFlags.has(g.Experimental))&&h.syntaxFlags.add(g.Experimental),h}function colorMixPolar(e,a,n){if(!n)return!1;const o=n.a.color,t=n.b.color,r=n.a.percentage/100;let l=o.channels,s=t.channels,c=0,u=0,i=0,h=0,m=0,p=0,_=b.RGB,N=o.alpha;if("number"!=typeof N)return!1;let d=t.alpha;if("number"!=typeof d)return!1;switch(N=Number.isNaN(N)?d:N,d=Number.isNaN(d)?N:d,e){case"hsl":_=b.HSL;break;case"hwb":_=b.HWB;break;case"lch":_=b.LCH;break;case"oklch":_=b.OKLCH}switch(l=colorDataTo(o,_).channels,s=colorDataTo(t,_).channels,e){case"hsl":case"hwb":c=l[0],u=s[0],i=l[1],h=s[1],m=l[2],p=s[2];break;case"lch":case"oklch":i=l[0],h=s[0],m=l[1],p=s[1],c=l[2],u=s[2]}if(!Number.isNaN(c)&&!Number.isNaN(u)){const e=u-c;switch(a){case"shorter":e>180?c+=360:e<-180&&(u+=360);break;case"longer":-180<e&&e<180&&(e>0?c+=360:u+=360);break;case"increasing":e<0&&(u+=360);break;case"decreasing":e>0&&(c+=360);break;default:throw new Error("Unknown hue interpolation method")}}i=premultiply(i,N),m=premultiply(m,N),h=premultiply(h,d),p=premultiply(p,d);let f=[0,0,0];const v=interpolate(N,d,r);switch(e){case"hsl":case"hwb":f=[interpolate(c,u,r),un_premultiply(interpolate(i,h,r),v),un_premultiply(interpolate(m,p,r),v)];break;case"lch":case"oklch":f=[un_premultiply(interpolate(i,h,r),v),un_premultiply(interpolate(m,p,r),v),interpolate(c,u,r)]}const y={colorNotation:_,channels:f,alpha:v*n.alphaMultiplier,syntaxFlags:new Set([g.ColorMix])};return(n.a.color.syntaxFlags.has(g.Experimental)||n.b.color.syntaxFlags.has(g.Experimental))&&y.syntaxFlags.add(g.Experimental),y}function interpolate(e,a,n){return Number.isNaN(e)?a:Number.isNaN(a)?e:e*n+a*(1-n)}function premultiply(e,a){return Number.isNaN(a)?e:Number.isNaN(e)?NaN:e*a}function un_premultiply(e,a){return 0===a||Number.isNaN(a)?e:Number.isNaN(e)?NaN:e/a}function hex(e){const a=toLowerCaseAZ(e[4].value);if(a.match(/[^a-f0-9]/))return!1;const n={colorNotation:b.HEX,channels:[0,0,0],alpha:1,syntaxFlags:new Set([g.Hex])},o=a.length;if(3===o){const e=a[0],o=a[1],t=a[2];return n.channels=[parseInt(e+e,16)/255,parseInt(o+o,16)/255,parseInt(t+t,16)/255],n}if(6===o){const e=a[0]+a[1],o=a[2]+a[3],t=a[4]+a[5];return n.channels=[parseInt(e,16)/255,parseInt(o,16)/255,parseInt(t,16)/255],n}if(4===o){const e=a[0],o=a[1],t=a[2],r=a[3];return n.channels=[parseInt(e+e,16)/255,parseInt(o+o,16)/255,parseInt(t+t,16)/255],n.alpha=parseInt(r+r,16)/255,n.syntaxFlags.add(g.HasAlpha),n}if(8===o){const e=a[0]+a[1],o=a[2]+a[3],t=a[4]+a[5],r=a[6]+a[7];return n.channels=[parseInt(e,16)/255,parseInt(o,16)/255,parseInt(t,16)/255],n.alpha=parseInt(r,16)/255,n.syntaxFlags.add(g.HasAlpha),n}return!1}function normalizeHue(n){if(n[0]===e.Number)return n[4].value=n[4].value%360,n[1]=n[4].value.toString(),n;if(n[0]===e.Dimension){let o=n[4].value;switch(toLowerCaseAZ(n[4].unit)){case"deg":break;case"rad":o=180*n[4].value/Math.PI;break;case"grad":o=.9*n[4].value;break;case"turn":o=360*n[4].value;break;default:return!1}return o%=360,[e.Number,o.toString(),n[2],n[3],{value:o,type:a.Number}]}return!1}function normalize_legacy_HSL_ChannelValues(n,o){const t=[];for(let r=0;r<n.length;r++){const l=n[r];if(0!==r)if(l[0]!==e.Percentage){if(l[0]!==e.Number)return!1;{3!==r&&o.syntaxFlags.add(g.HasNumberValues);let n=normalize(l[4].value,1,0,100);3===r&&(n=normalize(l[4].value,1,0,1)),t.push([e.Number,n.toString(),l[2],l[3],{value:n,type:a.Number}])}}else{3===r?o.syntaxFlags.add(g.HasPercentageAlpha):o.syntaxFlags.add(g.HasPercentageValues);let n=normalize(l[4].value,1,0,100);3===r&&(n=normalize(l[4].value,100,0,1)),t.push([e.Number,n.toString(),l[2],l[3],{value:n,type:a.Number}])}else{const a=normalizeHue(l);if(!1===a)return!1;l[0]===e.Dimension&&o.syntaxFlags.add(g.HasDimensionValues),t.push(a)}}return!o.syntaxFlags.has(g.HasNumberValues)&&t}function normalize_modern_HSL_ChannelValues(n,o){const t=[];for(let r=0;r<n.length;r++){const l=n[r];if(l[0]!==e.Ident||"none"!==toLowerCaseAZ(l[4].value))if(0!==r)if(l[0]!==e.Percentage){if(l[0]!==e.Number)return!1;{3!==r&&o.syntaxFlags.add(g.HasNumberValues);let n=normalize(l[4].value,1,0,100);3===r&&(n=normalize(l[4].value,1,0,1)),t.push([e.Number,n.toString(),l[2],l[3],{value:n,type:a.Number}])}}else{3===r?o.syntaxFlags.add(g.HasPercentageAlpha):o.syntaxFlags.add(g.HasPercentageValues);let n=normalize(l[4].value,1,0,100);3===r&&(n=normalize(l[4].value,100,0,1)),t.push([e.Number,n.toString(),l[2],l[3],{value:n,type:a.Number}])}else{const a=normalizeHue(l);if(!1===a)return!1;l[0]===e.Dimension&&o.syntaxFlags.add(g.HasDimensionValues),t.push(a)}else o.syntaxFlags.add(g.HasNoneKeywords),t.push([e.Number,"none",l[2],l[3],{value:NaN,type:a.Number}])}return t}function threeChannelLegacySyntax(a,n,o,t){const r=[],l=[],h=[],m=[],p={colorNotation:o,channels:[0,0,0],alpha:1,syntaxFlags:new Set(t)};let b=r;for(let n=0;n<a.value.length;n++){let o=a.value[n];if(!s(o)&&!c(o)){if(u(o)&&o.value[0]===e.Comma){if(b===r){b=l;continue}if(b===l){b=h;continue}if(b===h){b=m;continue}if(b===m)return!1}if(i(o)){if(b===m&&"var"===toLowerCaseAZ(o.getName())){p.syntaxFlags.add(g.HasVariableAlpha),b.push(o);continue}if(!_.has(toLowerCaseAZ(o.getName())))return!1;const[[a]]=N([[o]],{toCanonicalUnits:!0,precision:100});if(!a||!u(a)||(a.value[0]===e.Percentage||a.value[0]===e.Number||a.value[0]===e.Dimension)&&Number.isNaN(a.value[4].value))return!1;o=a}if(!u(o))return!1;b.push(o)}}if(1!==b.length)return!1;if(1!==r.length||1!==l.length||1!==h.length)return!1;if(!u(r[0])||!u(l[0])||!u(h[0]))return!1;const d=[r[0].value,l[0].value,h[0].value];1===m.length&&(p.syntaxFlags.add(g.HasAlpha),u(m[0])?d.push(m[0].value):p.alpha=m[0]);const f=n(d,p);return!1!==f&&(p.channels=[f[0][4].value,f[1][4].value,f[2][4].value],4===f.length&&(p.alpha=f[3][4].value),p)}function XYZ_D50_to_sRGB_Gamut(e){const a=n.XYZ_D50_to_sRGB(e);if(o.inGamut(a))return o.clip(a);let l=e.slice();return l=t.D50_to_D65(l),l=t.XYZ_to_OKLab(l),l=t.OKLab_to_OKLCH(l),l[0]<1e-6&&(l=[0,0,0]),l[0]>.999999&&(l=[1,0,0]),r.mapGamut(l,(e=>(e=t.OKLCH_to_OKLab(e),e=t.OKLab_to_XYZ(e),e=t.XYZ_to_lin_sRGB(e),t.gam_sRGB(e))),(e=>(e=t.lin_sRGB(e),e=t.lin_sRGB_to_XYZ(e),e=t.XYZ_to_OKLab(e),t.OKLab_to_OKLCH(e))))}function threeChannelSpaceSeparated(a,n,o,r,l){const m=toLowerCaseAZ(a.getName()),p=[],d=[],f=[],v=[];let y,C,w=!1;const L={colorNotation:o,channels:[0,0,0],alpha:1,syntaxFlags:new Set(r)};let D=p;for(let n=0;n<a.value.length;n++){let r=a.value[n];if(s(r)||c(r))for(;s(a.value[n+1])||c(a.value[n+1]);)n++;else if(D===p&&p.length&&(D=d),D===d&&d.length&&(D=f),u(r)&&r.value[0]===e.Delim&&"/"===r.value[4].value){if(D===v)return!1;D=v}else{if(i(r)){if(D===v&&"var"===toLowerCaseAZ(r.getName())){L.syntaxFlags.add(g.HasVariableAlpha),D.push(r);continue}if(!_.has(toLowerCaseAZ(r.getName())))return!1;const[[a]]=N([[r]],{toCanonicalUnits:!0,precision:100,globals:C});if(!a||!u(a)||(a.value[0]===e.Percentage||a.value[0]===e.Number||a.value[0]===e.Dimension)&&Number.isNaN(a.value[4].value))return!1;r=a}if(D===p&&0===p.length&&u(r)&&r.value[0]===e.Ident&&"from"===toLowerCaseAZ(r.value[4].value)&&"hsla"!==m&&"rgba"!==m){if(w)return!1;for(;s(a.value[n+1])||c(a.value[n+1]);)n++;if(n++,r=a.value[n],w=l(r),!1===w)return!1;w.syntaxFlags.has(g.Experimental)&&L.syntaxFlags.add(g.Experimental),L.syntaxFlags.add(g.RelativeColorSyntax),w.colorNotation!==o&&(w=colorDataTo(w,o)),o===b.HEX||o===b.RGB?w.channels=XYZ_D50_to_sRGB_Gamut(colorData_to_XYZ_D50(w).channels):o===b.HSL?w.channels=t.sRGB_to_HSL(XYZ_D50_to_sRGB_Gamut(colorData_to_XYZ_D50(w).channels)):o===b.HWB&&(w.channels=t.sRGB_to_HWB(XYZ_D50_to_sRGB_Gamut(colorData_to_XYZ_D50(w).channels))),y=normalizeRelativeColorDataChannels(w),C=noneToZeroInRelativeColorDataChannels(y)}else{if(!u(r))return!1;if(r.value[0]===e.Ident&&y&&y.has(toLowerCaseAZ(r.value[4].value))){D.push(new h(y.get(toLowerCaseAZ(r.value[4].value))));continue}D.push(r)}}}if(1!==D.length)return!1;if(1!==p.length||1!==d.length||1!==f.length)return!1;if(!u(p[0])||!u(d[0])||!u(f[0]))return!1;if(y&&!y.has("alpha"))return!1;const H=[p[0].value,d[0].value,f[0].value];1===v.length?(L.syntaxFlags.add(g.HasAlpha),u(v[0])?H.push(v[0].value):L.alpha=v[0]):y&&y.has("alpha")&&H.push(y.get("alpha"));const x=n(H,L);return!1!==x&&(L.channels=[x[0][4].value,x[1][4].value,x[2][4].value],4===x.length&&(L.alpha=x[3][4].value),L)}function hsl(a,n){if(a.value.some((a=>u(a)&&a.value[0]===e.Comma))){const e=hslCommaSeparated(a);if(!1!==e)return e}{const e=hslSpaceSeparated(a,n);if(!1!==e)return e}return!1}function hslCommaSeparated(e){return threeChannelLegacySyntax(e,normalize_legacy_HSL_ChannelValues,b.HSL,[g.LegacyHSL])}function hslSpaceSeparated(e,a){return threeChannelSpaceSeparated(e,normalize_modern_HSL_ChannelValues,b.HSL,[],a)}function normalize_HWB_ChannelValues(n,o){const t=[];for(let r=0;r<n.length;r++){const l=n[r];if(l[0]!==e.Ident||"none"!==toLowerCaseAZ(l[4].value))if(0!==r)if(l[0]!==e.Percentage){if(l[0]!==e.Number)return!1;{3!==r&&o.syntaxFlags.add(g.HasNumberValues);let n=normalize(l[4].value,1,0,100);3===r&&(n=normalize(l[4].value,1,0,1)),t.push([e.Number,n.toString(),l[2],l[3],{value:n,type:a.Number}])}}else{3===r?o.syntaxFlags.add(g.HasPercentageAlpha):o.syntaxFlags.add(g.HasPercentageValues);let n=normalize(l[4].value,1,0,100);3===r&&(n=normalize(l[4].value,100,0,1)),t.push([e.Number,n.toString(),l[2],l[3],{value:n,type:a.Number}])}else{const a=normalizeHue(l);if(!1===a)return!1;l[0]===e.Dimension&&o.syntaxFlags.add(g.HasDimensionValues),t.push(a)}else o.syntaxFlags.add(g.HasNoneKeywords),t.push([e.Number,"none",l[2],l[3],{value:NaN,type:a.Number}])}return t}function normalize_Lab_ChannelValues(n,o){const t=[];for(let r=0;r<n.length;r++){const l=n[r];if(l[0]!==e.Ident||"none"!==toLowerCaseAZ(l[4].value))if(l[0]!==e.Percentage){if(l[0]!==e.Number)return!1;{3!==r&&o.syntaxFlags.add(g.HasNumberValues);let n=normalize(l[4].value,1,0,100);1===r||2===r?n=normalize(l[4].value,1,-1/0,1/0):3===r&&(n=normalize(l[4].value,1,0,1)),t.push([e.Number,n.toString(),l[2],l[3],{value:n,type:a.Number}])}}else{3!==r&&o.syntaxFlags.add(g.HasPercentageValues);let n=normalize(l[4].value,1,0,100);1===r||2===r?n=normalize(l[4].value,.8,-1/0,1/0):3===r&&(n=normalize(l[4].value,100,0,1)),t.push([e.Number,n.toString(),l[2],l[3],{value:n,type:a.Number}])}else o.syntaxFlags.add(g.HasNoneKeywords),t.push([e.Number,"none",l[2],l[3],{value:NaN,type:a.Number}])}return t}function lab(e,a){return threeChannelSpaceSeparated(e,normalize_Lab_ChannelValues,b.Lab,[],a)}function normalize_LCH_ChannelValues(n,o){const t=[];for(let r=0;r<n.length;r++){const l=n[r];if(l[0]!==e.Ident||"none"!==toLowerCaseAZ(l[4].value))if(2!==r)if(l[0]!==e.Percentage){if(l[0]!==e.Number)return!1;{3!==r&&o.syntaxFlags.add(g.HasNumberValues);let n=normalize(l[4].value,1,0,100);1===r?n=normalize(l[4].value,1,0,1/0):3===r&&(n=normalize(l[4].value,1,0,1)),t.push([e.Number,n.toString(),l[2],l[3],{value:n,type:a.Number}])}}else{3!==r&&o.syntaxFlags.add(g.HasPercentageValues);let n=normalize(l[4].value,1,0,100);1===r?n=normalize(l[4].value,100/150,0,1/0):3===r&&(n=normalize(l[4].value,100,0,1)),t.push([e.Number,n.toString(),l[2],l[3],{value:n,type:a.Number}])}else{const a=normalizeHue(l);if(!1===a)return!1;l[0]===e.Dimension&&o.syntaxFlags.add(g.HasDimensionValues),t.push(a)}else o.syntaxFlags.add(g.HasNoneKeywords),t.push([e.Number,"none",l[2],l[3],{value:NaN,type:a.Number}])}return t}function lch(e,a){return threeChannelSpaceSeparated(e,normalize_LCH_ChannelValues,b.LCH,[],a)}const L=new Map;for(const[e,a]of Object.entries(l))L.set(e,a);function namedColor(e){const a=L.get(toLowerCaseAZ(e));return!!a&&{colorNotation:b.RGB,channels:[a[0]/255,a[1]/255,a[2]/255],alpha:1,syntaxFlags:new Set([g.ColorKeyword,g.NamedColor])}}function normalize_OKLab_ChannelValues(n,o){const t=[];for(let r=0;r<n.length;r++){const l=n[r];if(l[0]!==e.Ident||"none"!==toLowerCaseAZ(l[4].value))if(l[0]!==e.Percentage){if(l[0]!==e.Number)return!1;{3!==r&&o.syntaxFlags.add(g.HasNumberValues);let n=normalize(l[4].value,1,0,1);1===r||2===r?n=normalize(l[4].value,1,-1/0,1/0):3===r&&(n=normalize(l[4].value,1,0,1)),t.push([e.Number,n.toString(),l[2],l[3],{value:n,type:a.Number}])}}else{3!==r&&o.syntaxFlags.add(g.HasPercentageValues);let n=normalize(l[4].value,100,0,1);1===r||2===r?n=normalize(l[4].value,250,-1/0,1/0):3===r&&(n=normalize(l[4].value,100,0,1)),t.push([e.Number,n.toString(),l[2],l[3],{value:n,type:a.Number}])}else o.syntaxFlags.add(g.HasNoneKeywords),t.push([e.Number,"none",l[2],l[3],{value:NaN,type:a.Number}])}return t}function oklab(e,a){return threeChannelSpaceSeparated(e,normalize_OKLab_ChannelValues,b.OKLab,[],a)}function normalize_OKLCH_ChannelValues(n,o){const t=[];for(let r=0;r<n.length;r++){const l=n[r];if(l[0]!==e.Ident||"none"!==toLowerCaseAZ(l[4].value))if(2!==r)if(l[0]!==e.Percentage){if(l[0]!==e.Number)return!1;{3!==r&&o.syntaxFlags.add(g.HasNumberValues);let n=normalize(l[4].value,1,0,1);1===r?n=normalize(l[4].value,1,0,1/0):3===r&&(n=normalize(l[4].value,1,0,1)),t.push([e.Number,n.toString(),l[2],l[3],{value:n,type:a.Number}])}}else{3!==r&&o.syntaxFlags.add(g.HasPercentageValues);let n=normalize(l[4].value,100,0,1);1===r?n=normalize(l[4].value,250,0,1/0):3===r&&(n=normalize(l[4].value,100,0,1)),t.push([e.Number,n.toString(),l[2],l[3],{value:n,type:a.Number}])}else{const a=normalizeHue(l);if(!1===a)return!1;l[0]===e.Dimension&&o.syntaxFlags.add(g.HasDimensionValues),t.push(a)}else o.syntaxFlags.add(g.HasNoneKeywords),t.push([e.Number,"none",l[2],l[3],{value:NaN,type:a.Number}])}return t}function oklch(e,a){return threeChannelSpaceSeparated(e,normalize_OKLCH_ChannelValues,b.OKLCH,[],a)}function normalize_legacy_sRGB_ChannelValues(n,o){const t=[];for(let r=0;r<n.length;r++){const l=n[r];if(l[0]!==e.Percentage){if(l[0]!==e.Number)return!1;{3!==r&&o.syntaxFlags.add(g.HasNumberValues);let n=normalize(l[4].value,255,0,1);3===r&&(n=normalize(l[4].value,1,0,1)),t.push([e.Number,n.toString(),l[2],l[3],{value:n,type:a.Number}])}}else{3===r?o.syntaxFlags.add(g.HasPercentageAlpha):o.syntaxFlags.add(g.HasPercentageValues);const n=normalize(l[4].value,100,0,1);t.push([e.Number,n.toString(),l[2],l[3],{value:n,type:a.Number}])}}return(!o.syntaxFlags.has(g.HasNumberValues)||!o.syntaxFlags.has(g.HasPercentageValues))&&t}function normalize_modern_sRGB_ChannelValues(n,o){const t=[];for(let r=0;r<n.length;r++){const l=n[r];if(l[0]!==e.Ident||"none"!==toLowerCaseAZ(l[4].value))if(l[0]!==e.Percentage){if(l[0]!==e.Number)return!1;{3!==r&&o.syntaxFlags.add(g.HasNumberValues);let n=normalize(l[4].value,255,0,1);3===r&&(n=normalize(l[4].value,1,0,1)),t.push([e.Number,n.toString(),l[2],l[3],{value:n,type:a.Number}])}}else{3!==r&&o.syntaxFlags.add(g.HasPercentageValues);const n=normalize(l[4].value,100,0,1);t.push([e.Number,n.toString(),l[2],l[3],{value:n,type:a.Number}])}else o.syntaxFlags.add(g.HasNoneKeywords),t.push([e.Number,"none",l[2],l[3],{value:NaN,type:a.Number}])}return t}function rgb(a,n){if(a.value.some((a=>u(a)&&a.value[0]===e.Comma))){const e=rgbCommaSeparated(a);if(!1!==e)return e}else{const e=rgbSpaceSeparated(a,n);if(!1!==e)return e}return!1}function rgbCommaSeparated(e){return threeChannelLegacySyntax(e,normalize_legacy_sRGB_ChannelValues,b.RGB,[g.LegacyRGB])}function rgbSpaceSeparated(e,a){return threeChannelSpaceSeparated(e,normalize_modern_sRGB_ChannelValues,b.RGB,[],a)}
/** @preserve
/////    SAPC APCA - Advanced Perceptual Contrast Algorithm
/////           Beta 0.1.9 W3 • contrast function only
/////           DIST: W3 • Revision date: July 3, 2022
/////    Function to parse color values and determine Lc contrast
/////    Copyright © 2019-2022 by Andrew Somers. All Rights Reserved.
/////    LICENSE: W3 LICENSE
/////    CONTACT: Please use the ISSUES or DISCUSSIONS tab at:
/////    https://github.com/Myndex/SAPC-APCA/
/////
// */const D={mainTRC:2.4,get mainTRCencode(){return 1/this.mainTRC},sRco:.2126729,sGco:.7151522,sBco:.072175,normBG:.56,normTXT:.57,revTXT:.62,revBG:.65,blkThrs:.022,blkClmp:1.414,scaleBoW:1.14,scaleWoB:1.14,loBoWoffset:.027,loWoBoffset:.027,deltaYmin:5e-4,loClip:.1,mFactor:1.9468554433171,get mFactInv(){return 1/this.mFactor},mOffsetIn:.0387393816571401,mExpAdj:.283343396420869,get mExp(){return this.mExpAdj/this.blkClmp},mOffsetOut:.312865795870758};function apca_contrast(e,a){const n=[0,1.1];if(isNaN(e)||isNaN(a)||Math.min(e,a)<n[0]||Math.max(e,a)>n[1])return 0;let o=0,t=0;return e=e>D.blkThrs?e:e+Math.pow(D.blkThrs-e,D.blkClmp),a=a>D.blkThrs?a:a+Math.pow(D.blkThrs-a,D.blkClmp),Math.abs(a-e)<D.deltaYmin?0:(a>e?(o=(Math.pow(a,D.normBG)-Math.pow(e,D.normTXT))*D.scaleBoW,t=o<D.loClip?0:o-D.loBoWoffset):(o=(Math.pow(a,D.revBG)-Math.pow(e,D.revTXT))*D.scaleWoB,t=o>-D.loClip?0:o+D.loWoBoffset),100*t)}function apca_sRGBtoY(e=[0,0,0]){function simpleExp(e){return Math.pow(e,D.mainTRC)}return D.sRco*simpleExp(e[0])+D.sGco*simpleExp(e[1])+D.sBco*simpleExp(e[2])}function apca_displayP3toY(e=[0,0,0]){function simpleExp(e){return Math.pow(e,2.4)}return.228982959480578*simpleExp(e[0])+.691749262585238*simpleExp(e[1])+.0792677779341829*simpleExp(e[2])}function apca_adobeRGBtoY(e=[0,0,0]){function simpleExp(e){return Math.pow(e,2.35)}return.297355022711381*simpleExp(e[0])+.627372749714528*simpleExp(e[1])+.0752722275740913*simpleExp(e[2])}function XYZ_D50_to_P3_Gamut(e){const a=n.XYZ_D50_to_P3(e);if(o.inGamut(a))return o.clip(a);let l=e.slice();return l=t.D50_to_D65(l),l=t.XYZ_to_OKLab(l),l=t.OKLab_to_OKLCH(l),l[0]<1e-6&&(l=[0,0,0]),l[0]>.999999&&(l=[1,0,0]),r.mapGamut(l,(e=>(e=t.OKLCH_to_OKLab(e),e=t.OKLab_to_XYZ(e),e=t.XYZ_to_lin_P3(e),t.gam_P3(e))),(e=>(e=t.lin_P3(e),e=t.lin_P3_to_XYZ(e),e=t.XYZ_to_OKLab(e),t.OKLab_to_OKLCH(e))))}function XYZ_D50_to_a98_Gamut(e){const a=n.XYZ_D50_to_a98_RGB(e);if(o.inGamut(a))return o.clip(a);let l=e.slice();return l=t.D50_to_D65(l),l=t.XYZ_to_OKLab(l),l=t.OKLab_to_OKLCH(l),l[0]<1e-6&&(l=[0,0,0]),l[0]>.999999&&(l=[1,0,0]),r.mapGamut(l,(e=>(e=t.OKLCH_to_OKLab(e),e=t.OKLab_to_XYZ(e),e=t.XYZ_to_lin_a98rgb(e),t.gam_a98rgb(e))),(e=>(e=t.lin_a98rgb(e),e=t.lin_a98rgb_to_XYZ(e),e=t.XYZ_to_OKLab(e),t.OKLab_to_OKLCH(e))))}function contrastColor(e,a){let n=!1;for(let o=0;o<e.value.length;o++){const t=e.value[o];if(s(t)||c(t))continue;if(n)return!1;const r=a(t);if(!r)return!1;n=r}if(!n)return!1;switch(n.colorNotation){case b.HEX:case b.RGB:case b.sRGB:n=colorDataTo(n,b.sRGB);break;case b.Display_P3:n=colorDataTo(n,b.Display_P3);break;case b.A98_RGB:n=colorDataTo(n,b.A98_RGB);break;case b.HSL:n=colorDataTo(n,b.sRGB);break;default:n=colorDataTo(n,b.A98_RGB)}switch(n.channels=n.channels.map((e=>Number.isNaN(e)?0:e)),n.colorNotation){case b.HEX:case b.RGB:case b.sRGB:{const e=apca_sRGBtoY(XYZ_D50_to_sRGB_Gamut(colorData_to_XYZ_D50(n).channels)),a=Math.abs(apca_contrast(1,e)),o=Math.abs(apca_contrast(0,e)),t={colorNotation:b.sRGB,channels:[0,0,0],alpha:1,syntaxFlags:new Set([g.ContrastColor,g.Experimental])};return a>o&&(t.channels=[1,1,1]),t}case b.Display_P3:{const e=apca_displayP3toY(XYZ_D50_to_P3_Gamut(colorData_to_XYZ_D50(n).channels)),a=Math.abs(apca_contrast(1,e)),o=Math.abs(apca_contrast(0,e)),t={colorNotation:b.Display_P3,channels:[0,0,0],alpha:1,syntaxFlags:new Set([g.ContrastColor,g.Experimental])};return a>o&&(t.channels=[1,1,1]),t}case b.A98_RGB:{const e=apca_adobeRGBtoY(XYZ_D50_to_a98_Gamut(colorData_to_XYZ_D50(n).channels)),a=Math.abs(apca_contrast(1,e)),o=Math.abs(apca_contrast(0,e)),t={colorNotation:b.A98_RGB,channels:[0,0,0],alpha:1,syntaxFlags:new Set([g.ContrastColor,g.Experimental])};return a>o&&(t.channels=[1,1,1]),t}default:return!1}}function toPrecision(e,a=7){e=+e,a=+a;const n=(Math.floor(e)+"").length;if(a>n)return+e.toFixed(a-n);{const o=10**(n-a);return Math.round(e/o)*o}}function serializeWithAlpha(n,o,t,r){const l=[e.CloseParen,")",-1,-1,void 0];if("number"==typeof n.alpha){const s=Math.min(1,Math.max(0,toPrecision(Number.isNaN(n.alpha)?0:n.alpha)));return 1===toPrecision(s,4)?new m(o,l,r):new m(o,l,[...r,new p([t]),new h([e.Delim,"/",-1,-1,{value:"/"}]),new p([t]),new h([e.Number,toPrecision(s,4).toString(),-1,-1,{value:n.alpha,type:a.Integer}])])}return new m(o,l,[...r,new p([t]),new h([e.Delim,"/",-1,-1,{value:"/"}]),new p([t]),n.alpha])}function serializeP3(o,t=!0){o.channels=convertPowerlessComponentsToZeroValuesForDisplay(o.channels,o.colorNotation);let r=o.channels.map((e=>Number.isNaN(e)?0:e));o.colorNotation!==b.Display_P3&&(r=t?XYZ_D50_to_P3_Gamut(colorData_to_XYZ_D50(o).channels):n.XYZ_D50_to_P3(colorData_to_XYZ_D50(o).channels));const l=toPrecision(r[0],6),s=toPrecision(r[1],6),c=toPrecision(r[2],6),u=[e.Function,"color(",-1,-1,{value:"color"}],i=[e.Whitespace," ",-1,-1,void 0];return serializeWithAlpha(o,u,i,[new h([e.Ident,"display-p3",-1,-1,{value:"display-p3"}]),new p([i]),new h([e.Number,l.toString(),-1,-1,{value:r[0],type:a.Number}]),new p([i]),new h([e.Number,s.toString(),-1,-1,{value:r[1],type:a.Number}]),new p([i]),new h([e.Number,c.toString(),-1,-1,{value:r[2],type:a.Number}])])}function serializeRGB(o,r=!0){o.channels=convertPowerlessComponentsToZeroValuesForDisplay(o.channels,o.colorNotation);let l=o.channels.map((e=>Number.isNaN(e)?0:e));o.colorNotation===b.HWB?l=t.HWB_to_sRGB(l):o.colorNotation===b.HSL?l=t.HSL_to_sRGB(l):o.colorNotation!==b.RGB&&o.colorNotation!==b.HEX&&(l=r?XYZ_D50_to_sRGB_Gamut(colorData_to_XYZ_D50(o).channels):n.XYZ_D50_to_sRGB(colorData_to_XYZ_D50(o).channels));const s=Math.min(255,Math.max(0,Math.round(255*toPrecision(l[0])))),c=Math.min(255,Math.max(0,Math.round(255*toPrecision(l[1])))),u=Math.min(255,Math.max(0,Math.round(255*toPrecision(l[2])))),i=[e.CloseParen,")",-1,-1,void 0],_=[e.Whitespace," ",-1,-1,void 0],N=[e.Comma,",",-1,-1,void 0],g=[new h([e.Number,s.toString(),-1,-1,{value:l[0],type:a.Integer}]),new h(N),new p([_]),new h([e.Number,c.toString(),-1,-1,{value:l[1],type:a.Integer}]),new h(N),new p([_]),new h([e.Number,u.toString(),-1,-1,{value:l[2],type:a.Integer}])];if("number"==typeof o.alpha){const n=Math.min(1,Math.max(0,toPrecision(Number.isNaN(o.alpha)?0:o.alpha)));return 1===toPrecision(n,4)?new m([e.Function,"rgb(",-1,-1,{value:"rgb"}],i,g):new m([e.Function,"rgba(",-1,-1,{value:"rgba"}],i,[...g,new h(N),new p([_]),new h([e.Number,toPrecision(n,4).toString(),-1,-1,{value:o.alpha,type:a.Number}])])}return new m([e.Function,"rgba(",-1,-1,{value:"rgba"}],i,[...g,new h(N),new p([_]),o.alpha])}function serializeOKLCH(o){o.channels=convertPowerlessComponentsToZeroValuesForDisplay(o.channels,o.colorNotation);let t=o.channels.map((e=>Number.isNaN(e)?0:e));o.colorNotation!==b.OKLCH&&(t=n.XYZ_D50_to_OKLCH(colorData_to_XYZ_D50(o).channels));const r=toPrecision(t[0],6),l=toPrecision(t[1],6),s=toPrecision(t[2],6),c=[e.Function,"oklch(",-1,-1,{value:"oklch"}],u=[e.Whitespace," ",-1,-1,void 0];return serializeWithAlpha(o,c,u,[new h([e.Number,r.toString(),-1,-1,{value:t[0],type:a.Number}]),new p([u]),new h([e.Number,l.toString(),-1,-1,{value:t[1],type:a.Number}]),new p([u]),new h([e.Number,s.toString(),-1,-1,{value:t[2],type:a.Number}])])}function color(a){if(i(a)){switch(toLowerCaseAZ(a.getName())){case"rgb":case"rgba":return rgb(a,color);case"hsl":case"hsla":return hsl(a,color);case"hwb":return n=color,threeChannelSpaceSeparated(a,normalize_HWB_ChannelValues,b.HWB,[],n);case"lab":return lab(a,color);case"lch":return lch(a,color);case"oklab":return oklab(a,color);case"oklch":return oklch(a,color);case"color":return color$1(a,color);case"color-mix":return colorMix(a,color);case"contrast-color":return contrastColor(a,color)}}var n;if(u(a)){if(a.value[0]===e.Hash)return hex(a.value);if(a.value[0]===e.Ident){const e=namedColor(a.value[4].value);return!1!==e?e:"transparent"===toLowerCaseAZ(a.value[4].value)&&{colorNotation:b.RGB,channels:[0,0,0],alpha:0,syntaxFlags:new Set([g.ColorKeyword])}}}return!1}export{b as ColorNotation,g as SyntaxFlag,color,colorDataFitsRGB_Gamut,colorDataTo,serializeOKLCH,serializeP3,serializeRGB};
