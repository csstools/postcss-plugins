import{isWhitespaceNode as e,isCommentNode as n,isTokenNode as r,isFunctionNode as a,TokenNode as t}from"@csstools/css-parser-algorithms";import{TokenType as l,NumberType as o}from"@csstools/css-tokenizer";import{calcFromComponentValues as u}from"@csstools/css-calc";import{xyz as c,namedColors as s}from"@csstools/color-helpers";var i;function colorDataChannelsToCalcGlobals(e){const n=new Map;switch(e.currentColorSpace){case i.XYZ_D50:n.set("x",dummyNumberToken(e.channels[0])),n.set("y",dummyNumberToken(e.channels[1])),n.set("z",dummyNumberToken(e.channels[2])),n.set("alpha",dummyNumberToken(e.alpha));break;case i.sRGB:n.set("r",dummyNumberToken(255*e.channels[0])),n.set("g",dummyNumberToken(255*e.channels[1])),n.set("b",dummyNumberToken(255*e.channels[2])),n.set("alpha",dummyNumberToken(e.alpha))}return n}function dummyNumberToken(e){return[l.Number,e.toString(),-1,-1,{value:e,type:o.Number}]}function threeChannelLegacySyntax(t,o,c,s){const f=[],h=[],m=[],p=[];let v=f;for(let c=0;c<t.value.length;c++){let s=t.value[c];if(!e(s)&&!n(s)){if(r(s)&&s.value[0]===l.Comma){if(v===f){v=h;continue}if(v===h){v=m;continue}if(v===m){v=p;continue}if(v===p)return-1}if(a(s)){if("calc"!==s.getName().toLowerCase())return-1;const[[e]]=u([[s]],{toCanonicalUnits:!0,precision:100});if(!e||!r(e))return-1;s=e}if(!r(s))return-1;{let e=0;if(v===f)e=0;else if(v===h)e=1;else if(v===m)e=2;else{if(v!==p)return-1;e=3}const n=o(s.value,e);if(-1===n)return-1;v.push(n)}}}return 1!==v.length||1!==f.length||1!==h.length||1!==m.length?-1:{channels:s([f[0][4].value,h[0][4].value,m[0][4].value]),alpha:1===p.length?p[0][4].value:1,currentColorSpace:i.XYZ_D50,sourceColorSpace:c}}function threeChannelSpaceSeparated(t,o,c,s){const f=[],h=[],m=[],p=[];let v=f;for(let c=0;c<t.value.length;c++){let s=t.value[c];if(e(s)||n(s)){for(;e(t.value[c+1])||n(t.value[c+1]);)c++;if(!f.length)continue;if(v===f){v=h;continue}if(v===h){v=m;continue}}else if(r(s)&&s.value[0]===l.Delim&&"/"===s.value[4].value){if(v===p)return-1;v=p}else{if(a(s)){if("calc"!==s.getName().toLowerCase())return-1;const[[e]]=u([[s]],{toCanonicalUnits:!0,precision:100});if(!e||!r(e))return-1;s=e}if(!r(s))return-1;{let e=0;if(v===f)e=0;else if(v===h)e=1;else if(v===m)e=2;else{if(v!==p)return-1;e=3}const n=o(s.value,e);if(-1===n)return-1;v.push(n)}}}return 1!==v.length||1!==f.length||1!==h.length||1!==m.length?-1:{channels:s([f[0][4].value,h[0][4].value,m[0][4].value]),alpha:1===p.length?p[0][4].value:1,currentColorSpace:i.XYZ_D50,sourceColorSpace:c}}function normalize_sRGB_ChannelValue(e,n){if(e[0]===l.Percentage)return[l.Number,(e[4].value/100).toString(),e[2],e[3],{value:e[4].value/100,type:o.Number}];if(e[0]===l.Number){let r=255;return 3===n&&(r=1),[l.Number,(e[4].value/r).toString(),e[2],e[3],{value:e[4].value/r,type:o.Number}]}return-1}function rgb(e,n){{const n=rgbCommaSeparated(e);if(-1!==n)return n}{const n=rgbSpaceSeparated(e);if(-1!==n)return n}{const r=rgbSpaceSeparated_RCS(e,n);if(-1!==r)return r}return-1}function rgbCommaSeparated(e){return threeChannelLegacySyntax(e,normalize_sRGB_ChannelValue,i.sRGB,c.sRGB_to_XYZ_D50)}function rgbSpaceSeparated(e){return threeChannelSpaceSeparated(e,normalize_sRGB_ChannelValue,i.sRGB,c.sRGB_to_XYZ_D50)}function rgbSpaceSeparated_RCS(f,h){let m=null,p=1;const v=[],g=[],C=[],b=[];let S=v;for(let N=0;N<f.value.length;N++){let _=f.value[N];if(e(_)||n(_)){for(;e(f.value[N+1])||n(f.value[N+1]);)N++;if(!v.length)continue;if(S===v){S=g;continue}if(S===g){S=C;continue}}else{if(r(_)&&!m&&_.value[0]===l.Ident&&"from"===_.value[4].value.toLowerCase()){for(;e(f.value[N+1])||n(f.value[N+1]);)N++;const t=f.value[N+1];if(r(t)&&t.value[0]===l.Ident){const e=t.value[4].value.toLowerCase();if("currentcolor"===e)return-1;if("transparent"===e){m=colorDataChannelsToCalcGlobals({channels:[0,0,0],alpha:0,currentColorSpace:i.sRGB,sourceColorSpace:i.sRGB}),p=0,N++;continue}if(!Object.prototype.hasOwnProperty.call(s,e))return-1;const n=s[e];if(!n)return-1;m=colorDataChannelsToCalcGlobals({channels:[n[0]/255,n[1]/255,n[2]/255],alpha:1,currentColorSpace:i.sRGB,sourceColorSpace:i.sRGB}),p=1,N++;continue}if(a(t)){if("var"===t.getName().toLowerCase())return-1;const e=h(t);if(-1===e)return-1;m=colorDataChannelsToCalcGlobals({channels:c.XYZ_D50_to_sRGB(e.channels),alpha:e.alpha,currentColorSpace:i.sRGB,sourceColorSpace:e.sourceColorSpace}),p=e.alpha,N++;continue}}if(!m)return-1;if(!r(_)||_.value[0]!==l.Delim||"/"!==_.value[4].value){if(a(_)){if("calc"!==_.getName().toLowerCase())return-1;const[[e]]=u([[_]],{toCanonicalUnits:!0,precision:100,globals:m});if(!e||!r(e))return-1;_=e}if(r(_)){if(_.value[0]===l.Ident){const e=_.value,n=m.get(e[4].value.toLowerCase());if(!n)return-1;_=new t(n)}if(_.value[0]===l.Percentage){const e=_.value;S.push([l.Number,(e[4].value/100).toString(),e[2],e[3],{value:e[4].value/100,type:o.Number}]);continue}if(_.value[0]===l.Number){let e=255;S===b&&(e=1);const n=_.value;S.push([l.Number,(n[4].value/e).toString(),n[2],n[3],{value:n[4].value/e,type:o.Number}]);continue}}return-1}if(S===b)return-1;S=b}}return 1!==S.length||1!==v.length||1!==g.length||1!==C.length?-1:{channels:c.sRGB_to_XYZ_D50([v[0][4].value,g[0][4].value,C[0][4].value]),alpha:1===b.length?b[0][4].value:p,currentColorSpace:i.XYZ_D50,sourceColorSpace:i.sRGB}}function color(e){return a(e)&&("rgb"===e.getName().toLowerCase()||"rgba"===e.getName().toLowerCase())?rgb(e,color):-1}!function(e){e.XYZ_D50="xyz-d50",e.XYZ_D65="xyz-d65",e.sRGB="srgb"}(i||(i={}));export{i as ColorSpace,color};
