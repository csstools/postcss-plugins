import e from"@csstools/postcss-progressive-custom-properties";import{color as o,serializeRGB as t}from"@csstools/css-color-parser";import{WhitespaceNode as s,TokenNode as i,FunctionNode as n,stringify as r,replaceComponentValues as l,parseCommaSeparatedListOfComponentValues as a,isFunctionNode as u,isTokenNode as c,isCommentNode as p,isWhitespaceNode as v}from"@csstools/css-parser-algorithms";import{TokenType as f,tokenize as h}from"@csstools/css-tokenizer";function interpolateColorsInColorStopsList(e,r,l){const a=[];for(let u=0;u<e.length-1;u++){const c=e[u],p=e[u+1];a.push(c.color,new s([[f.Whitespace," ",-1,-1,void 0]]),c.position,new i([f.Comma,",",-1,-1,void 0]),new s([[f.Whitespace," ",-1,-1,void 0]]));for(let e=1;e<=9;e++){const u=10*e;let v=[];l&&(v=[new s([[f.Whitespace," ",-1,-1,void 0]]),l,new s([[f.Whitespace," ",-1,-1,void 0]]),new i([f.Ident,"hue",-1,-1,{value:"hue"}])]);const h=new n([f.Function,"color-mix(",-1,-1,{value:"color-mix"}],[f.CloseParen,")",-1,-1,void 0],[new i([f.Ident,"in",-1,-1,{value:"in"}]),new s([[f.Whitespace," ",-1,-1,void 0]]),r,...v,new i([f.Comma,",",-1,-1,void 0]),new s([[f.Whitespace," ",-1,-1,void 0]]),c.color,new s([[f.Whitespace," ",-1,-1,void 0]]),new i([f.Percentage,100-u+"%",-1,-1,{value:100-u}]),new i([f.Comma,",",-1,-1,void 0]),new s([[f.Whitespace," ",-1,-1,void 0]]),p.color,new s([[f.Whitespace," ",-1,-1,void 0]]),new i([f.Percentage,`${u}%`,-1,-1,{value:u}])]),d=o(h);if(!d)return!1;const m=t(d);a.push(m,new i([f.Comma,",",-1,-1,void 0]),new s([[f.Whitespace," ",-1,-1,void 0]]))}u===e.length-2&&a.push(p.color,new s([[f.Whitespace," ",-1,-1,void 0]]),p.position)}return a}const d=/(repeating-)?(linear|radial|conic)-gradient\(/i,m=/^(repeating-)?(linear|radial|conic)-gradient$/i;function hasSupportsAtRuleAncestor(e){let o=e.parent;for(;o;)if("atrule"===o.type){if("supports"===o.name&&d.test(o.params))return!0;o=o.parent}else o=o.parent;return!1}const g=/^(srgb|srgb-linear|lab|oklab|xyz|xyz-d50|xyz-d65|hsl|hwb|lch|oklch)$/i,w=/^(hsl|hwb|lch|oklch)$/i,C=/^(shorter|longer|increasing|decreasing)$/i,A=/^in$/i,W=/^hue$/i,basePlugin=e=>({postcssPlugin:"postcss-gradients-interpolation-method",Declaration(t){if(!d.test(t.value))return;if(hasSupportsAtRuleAncestor(t))return;const s=h({css:t.value}),n=r(l(a(s),(e=>{if(!u(e))return;const t=e.getName();if(!m.test(t))return;let s="srgb",n=null,r=null,l=null,a=null,h=null,d=[];{let o=0,t=e.value[o];for(;!c(t)||t.value[0]!==f.Ident||!A.test(t.value[4].value);){if(c(t)&&t.value[0]===f.Comma)return;o++,t=e.value[o]}for(n=t,o++,t=e.value[o];p(t)||v(t);)o++,t=e.value[o];if(c(t)&&t.value[0]===f.Ident&&g.test(t.value[4].value)){if(r)return;r=t,s=t.value[4].value,o++,t=e.value[o]}for(;p(t)||v(t);)o++,t=e.value[o];if(c(t)&&t.value[0]===f.Ident&&C.test(t.value[4].value)&&w.test(s)){if(l||!r)return;l=t,o++,t=e.value[o]}for(;p(t)||v(t);)o++,t=e.value[o];if(c(t)&&t.value[0]===f.Ident&&W.test(t.value[4].value)){if(a||!r||!l)return;a=t,o++,t=e.value[o]}for(;!c(t)||t.value[0]!==f.Comma;)o++,t=e.value[o];h=t,d=e.value.slice(o+1)}if(!r)return;if(l&&!a)return;if(a&&!l)return;const b=[];let x={};for(let e=0;e<d.length;e++){const t=d[e];if(p(t)||v(t))continue;if(c(t)&&t.value[0]===f.Comma){if(x.color&&x.positionA){b.push({color:x.color,position:x.positionA}),x.positionB&&b.push({color:x.color,position:x.positionB}),x={};continue}return}const s=o(t);if(s&&x.color)return;if(s)x.color=t;else{if(x.positionA)return void(x.positionA&&!x.positionB&&(x.positionB=t));x.positionA=t}}if(!x.color||!x.positionA)return;b.push({color:x.color,position:x.positionA}),x.positionB&&b.push({color:x.color,position:x.positionB});const P=interpolateColorsInColorStopsList(b,r,l);if(!P)return;const I=[...e.value.slice(0,e.value.indexOf(n)),...e.value.slice(e.value.indexOf(a||r)+1,e.value.indexOf(h))];I.length>0&&I.some((e=>!p(e)&&!v(e)))&&I.push(new i([f.Comma,",",-1,-1,void 0])),e.value=[...I,...P]})));n!==t.value&&(t.cloneBefore({value:n}),null!=e&&e.preserve||t.remove())}});basePlugin.postcss=!0;const postcssPlugin=o=>{const t=Object.assign({enableProgressiveCustomProperties:!0,preserve:!0},o);return t.enableProgressiveCustomProperties&&t.preserve?{postcssPlugin:"postcss-gradients-interpolation-method",plugins:[e(),basePlugin(t)]}:basePlugin(t)};postcssPlugin.postcss=!0;export{postcssPlugin as default};
