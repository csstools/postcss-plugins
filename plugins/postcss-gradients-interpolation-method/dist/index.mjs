import e from"@csstools/postcss-progressive-custom-properties";import o from"postcss-value-parser";function t(e,t){const n=[];let r={color:"",colorStopLength:"",colorHintBetween:[],nodes:[]};for(let o=0;o<e.length;o++){const t=e[o];"div"!==t.type||","!==t.value?r.nodes.push(t):(n.push(r),r={color:"",colorStopLength:"",colorHintBetween:[],nodes:[]})}n.push(r);const s=[];for(let e=0;e<n.length;e++){const t=n[e];switch(t.nodes.length){case 0:break;case 1:return!1;case 2:t.color=o.stringify(t.nodes[0]),t.colorStopLength=o.stringify(t.nodes[1]),s.push(t);break;case 3:s.push({color:o.stringify(t.nodes[0]),colorStopLength:o.stringify(t.nodes[1]),colorHintBetween:[],nodes:[t.nodes[0],t.nodes[1]]}),s.push({color:o.stringify(t.nodes[0]),colorStopLength:o.stringify(t.nodes[2]),colorHintBetween:[],nodes:[t.nodes[0],t.nodes[2]]})}}for(let e=0;e<s.length;e++){const o=s[e];o.color||(o.color=`color-mix(in ${t}, ${s[e-1].color} 50%, ${s[e+1].color} 50%)`,o.colorHintBetween=[s[e-1],s[e+1]])}return s}function n(e){return e.includes("in ")&&(e.includes("conic-gradient(")||e.includes("linear-gradient(")||e.includes("radial-gradient(")||e.includes("repeating-conic-gradient(")||e.includes("repeating-linear-gradient(")||e.includes("repeating-radial-gradient("))}const r=["shorter","longer","increasing","decreasing","specified"],s=e=>({postcssPlugin:"postcss-gradients-interpolation-method",Declaration(s,{result:i}){if(!n(s.value))return;if(function(e){let o=e.parent;for(;o;)if("atrule"===o.type){if("supports"===o.name&&n(o.params))return!0;o=o.parent}else o=o.parent;return!1}(s))return;let l;try{l=o(s.value)}catch(e){s.warn(i,`Failed to parse value '${s.value}' as a CSS gradient. Leaving the original value intact.`)}if(void 0===l)return;let a=!1;if(l.walk((e=>{if("function"!==e.type||"conic-gradient"!==(n=e.value)&&"linear-gradient"!==n&&"radial-gradient"!==n&&"repeating-conic-gradient"!==n&&"repeating-linear-gradient"!==n&&"repeating-radial-gradient"!==n)return;var n;const s=e.nodes.filter((e=>"comment"!==e.type&&"space"!==e.type)),i={interpolationArguments:[],argumentsRemainder:[],colorStops:[]};for(let e=0;e<s.length;e++){const n=s[e];if("div"===n.type&&","===n.value){const n=i.interpolationArguments.map((e=>o.stringify(e))).join(" "),r=t(s.slice(e),n);if(r){i.colorStops=r;break}n&&(a=!0);break}if("word"===n.type&&"in"===n.value&&s[e+1]){if(i.interpolationArguments.push(s[e+1]),e++,s[e+1]&&"word"===s[e+1].type&&r.includes(s[e+1].value)){i.interpolationArguments.push(s[e+1]),e++;continue}}else i.argumentsRemainder.push(n)}if(!i.interpolationArguments.length||!i.colorStops.length)return;e.nodes=[],i.argumentsRemainder.length&&(e.nodes.push(...i.argumentsRemainder.flatMap((e=>[e,{type:"space",value:" "}]))),e.nodes.push({type:"div",value:","}));const l=i.interpolationArguments.map((e=>o.stringify(e))).join(" ");for(let t=0;t<i.colorStops.length;t++){const n=i.colorStops[t],r=i.colorStops[t+1];if(r)if(n.color!==r.color)for(let t=0;t<10;t++){if(0===t){e.nodes.push(o(`${n.color} ${n.colorStopLength}`),{type:"div",value:","});continue}const s=`color-mix(in ${l}, ${n.color} ${100-10*t}%, ${r.color} ${10*t}%)`,i=`calc(${n.colorStopLength} + ((${r.colorStopLength} - ${n.colorStopLength}) * ${t/10}))`;e.nodes.push(o(`${s} ${i}`),{type:"div",value:","})}else e.nodes.push(o(`${n.color} ${n.colorStopLength}`),{type:"div",value:","});else e.nodes.push(o(`${n.color} ${n.colorStopLength}`))}})),a)return void s.warn(i,`Failed to parse value '${s.value}' as a CSS gradient with interpolation. Leaving the original value intact.`);const c=o.stringify(l);c!==s.value&&(e.preserve?s.cloneBefore({prop:s.prop,value:c}):s.value=c)}});s.postcss=!0;const i=o=>{const t=Object.assign({enableProgressiveCustomProperties:!0,preserve:!0},o);return t.enableProgressiveCustomProperties&&t.preserve?{postcssPlugin:"postcss-gradients-interpolation-method",plugins:[e(),s(t)]}:s(t)};i.postcss=!0;export{i as default};
