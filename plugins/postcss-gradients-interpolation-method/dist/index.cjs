"use strict";var e=require("@csstools/postcss-progressive-custom-properties"),o=require("@csstools/css-parser-algorithms"),t=require("@csstools/css-color-parser"),n=require("@csstools/css-tokenizer");const s=/(repeating-)?(linear|radial|conic)-gradient\(/i,i=/^(repeating-)?(linear|radial|conic)-gradient$/i;function hasFallback(e){const o=e.parent;if(!o)return!1;const t=e.prop.toLowerCase(),n=o.index(e);for(let e=0;e<n;e++){const n=o.nodes[e];if("decl"===n.type&&n.prop.toLowerCase()===t)return!0}return!1}function hasSupportsAtRuleAncestor(e){let o=e.parent;for(;o;)if("atrule"===o.type){if("supports"===o.name&&s.test(o.params))return!0;o=o.parent}else o=o.parent;return!1}function interpolateColorsInColorStopsList(e,s,i){const r=[],a=[];for(let r=0;r<e.length-1;r++){const l=e[r],p=e[r+1];if(a.push(l),t.serializeP3(l.colorData).toString()!==t.serializeP3(p.colorData).toString()&&l.position.toString()!==p.position.toString())for(let e=1;e<=9;e++){const r=10*e;let c=[];i&&(c=[new o.WhitespaceNode([[n.TokenType.Whitespace," ",-1,-1,void 0]]),i,new o.WhitespaceNode([[n.TokenType.Whitespace," ",-1,-1,void 0]]),new o.TokenNode([n.TokenType.Ident,"hue",-1,-1,{value:"hue"}])]);const u=new o.FunctionNode([n.TokenType.Function,"color-mix(",-1,-1,{value:"color-mix"}],[n.TokenType.CloseParen,")",-1,-1,void 0],[new o.TokenNode([n.TokenType.Ident,"in",-1,-1,{value:"in"}]),new o.WhitespaceNode([[n.TokenType.Whitespace," ",-1,-1,void 0]]),s,...c,new o.TokenNode([n.TokenType.Comma,",",-1,-1,void 0]),new o.WhitespaceNode([[n.TokenType.Whitespace," ",-1,-1,void 0]]),l.color,new o.WhitespaceNode([[n.TokenType.Whitespace," ",-1,-1,void 0]]),new o.TokenNode([n.TokenType.Percentage,100-r+"%",-1,-1,{value:100-r}]),new o.TokenNode([n.TokenType.Comma,",",-1,-1,void 0]),new o.WhitespaceNode([[n.TokenType.Whitespace," ",-1,-1,void 0]]),p.color,new o.WhitespaceNode([[n.TokenType.Whitespace," ",-1,-1,void 0]]),new o.TokenNode([n.TokenType.Percentage,`${r}%`,-1,-1,{value:r}])]),d=t.color(u);if(!d)return!1;a.push({colorData:d})}r===e.length-2&&a.push(p)}for(let e=0;e<a.length;e++)t.colorDataFitsRGB_Gamut(a[e].colorData)?a[e].color=t.serializeRGB(a[e].colorData):a[e].color=t.serializeP3(a[e].colorData);for(let e=0;e<a.length;e++){const t=a[e];t.position?r.push(t.color,new o.WhitespaceNode([[n.TokenType.Whitespace," ",-1,-1,void 0]]),t.position):r.push(t.color),e!==a.length-1&&r.push(new o.TokenNode([n.TokenType.Comma,",",-1,-1,void 0]),new o.WhitespaceNode([[n.TokenType.Whitespace," ",-1,-1,void 0]]))}return r}function parseColorStops(e){const s=[];let i={};for(let r=0;r<e.length;r++){const a=e[r];if(o.isCommentNode(a)||o.isWhitespaceNode(a))continue;if(o.isTokenNode(a)&&a.value[0]===n.TokenType.Comma){if(i.color&&i.colorData&&i.positionA){s.push({color:i.color,colorData:i.colorData,position:i.positionA}),i.positionB&&s.push({color:i.color,colorData:i.colorData,position:i.positionB}),i={};continue}return!1}const l=t.color(a);if(l&&i.color)return!1;if(l)i.color=a,i.colorData=l;else if(i.positionA){if(!i.positionA||i.positionB)return!1;i.positionB=a}else i.positionA=a}return!(!i.color||!i.positionA)&&(i.color&&i.colorData&&i.positionA&&(s.push({color:i.color,colorData:i.colorData,position:i.positionA}),i.positionB&&s.push({color:i.color,colorData:i.colorData,position:i.positionB})),!(s.length<2)&&s)}const r=/^(srgb|srgb-linear|lab|oklab|xyz|xyz-d50|xyz-d65|hsl|hwb|lch|oklch)$/i,a=/^(hsl|hwb|lch|oklch)$/i,l=/^(shorter|longer|increasing|decreasing)$/i,p=/^in$/i,c=/^hue$/i,basePlugin=e=>({postcssPlugin:"postcss-gradients-interpolation-method",Declaration(t){if(!s.test(t.value))return;if(hasFallback(t))return;if(hasSupportsAtRuleAncestor(t))return;const u=n.tokenize({css:t.value}),d=o.stringify(o.replaceComponentValues(o.parseCommaSeparatedListOfComponentValues(u),(e=>{if(!o.isFunctionNode(e))return;const t=e.getName();if(!i.test(t))return;let s="srgb",u=null,d=null,T=null,v=null,h=null,f=[];{let t=0,i=e.value[t];for(;!o.isTokenNode(i)||i.value[0]!==n.TokenType.Ident||!p.test(i.value[4].value);){if(o.isTokenNode(i)&&i.value[0]===n.TokenType.Comma)return;t++,i=e.value[t]}for(u=i,t++,i=e.value[t];o.isCommentNode(i)||o.isWhitespaceNode(i);)t++,i=e.value[t];if(o.isTokenNode(i)&&i.value[0]===n.TokenType.Ident&&r.test(i.value[4].value)){if(d)return;d=i,s=i.value[4].value,t++,i=e.value[t]}for(;o.isCommentNode(i)||o.isWhitespaceNode(i);)t++,i=e.value[t];if(o.isTokenNode(i)&&i.value[0]===n.TokenType.Ident&&l.test(i.value[4].value)&&a.test(s)){if(T||!d)return;T=i,t++,i=e.value[t]}for(;o.isCommentNode(i)||o.isWhitespaceNode(i);)t++,i=e.value[t];if(o.isTokenNode(i)&&i.value[0]===n.TokenType.Ident&&c.test(i.value[4].value)){if(v||!d||!T)return;v=i,t++,i=e.value[t]}for(;!o.isTokenNode(i)||i.value[0]!==n.TokenType.Comma;)t++,i=e.value[t];h=i,f=e.value.slice(t+1)}if(!d)return;if(T&&!v)return;if(v&&!T)return;const k=parseColorStops(f);if(!k)return;const m=interpolateColorsInColorStopsList(k,d,T);if(!m)return;const N=[...e.value.slice(0,e.value.indexOf(u)),...e.value.slice(e.value.indexOf(v||d)+1,e.value.indexOf(h))];N.length>0&&N.some((e=>!o.isCommentNode(e)&&!o.isWhitespaceNode(e)))&&N.push(new o.TokenNode([n.TokenType.Comma,",",-1,-1,void 0]),new o.WhitespaceNode([[n.TokenType.Whitespace," ",-1,-1,void 0]])),e.value=[...N,...m]})));d!==t.value&&(t.cloneBefore({value:d}),null!=e&&e.preserve||t.remove())}});basePlugin.postcss=!0;const postcssPlugin=o=>{const t=Object.assign({enableProgressiveCustomProperties:!0,preserve:!0},o);return t.enableProgressiveCustomProperties&&t.preserve?{postcssPlugin:"postcss-gradients-interpolation-method",plugins:[e(),basePlugin(t)]}:basePlugin(t)};postcssPlugin.postcss=!0,module.exports=postcssPlugin;
