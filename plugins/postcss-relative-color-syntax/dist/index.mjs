import s from"@csstools/postcss-progressive-custom-properties";import{color as e,SyntaxFlag as o,serializeRGB as r,colorDataFitsRGB_Gamut as t,serializeP3 as a}from"@csstools/css-color-parser";import{hasFallback as l,hasSupportsAtRuleAncestor as i}from"@csstools/utilities";import{replaceComponentValues as c,parseCommaSeparatedListOfComponentValues as n,isFunctionNode as u,stringify as p}from"@csstools/css-parser-algorithms";import{tokenize as b}from"@csstools/css-tokenizer";const m=/\b(?:rgb|hsl|hwb|lab|lch|oklch|oklab|color)\(/i,g=/\b(?:rgb|hsl|hwb|lab|lch|oklch|oklab|color)\(\s*?from/i,h=/^(?:rgb|hsl|hwb|lab|lch|oklch|oklab|color)$/i,y=/from/i,basePlugin=s=>({postcssPlugin:"postcss-relative-color-syntax",Declaration:f=>{const v=f.value;if(!m.test(v)||!y.test(v))return;if(l(f))return;if(i(f,g))return;const x=b({css:v}),F=c(n(x),(s=>{if(!u(s)||!h.test(s.getName()))return;const t=e(s);return t&&!t.syntaxFlags.has(o.Experimental)&&!t.syntaxFlags.has(o.HasNoneKeywords)&&t.syntaxFlags.has(o.RelativeColorSyntax)?r(t):void 0})),P=p(F);if(P===v)return;let d=P;s?.subFeatures.displayP3&&(d=p(c(n(x),(s=>{if(!u(s)||!h.test(s.getName()))return;const l=e(s);return l&&!l.syntaxFlags.has(o.Experimental)&&!l.syntaxFlags.has(o.HasNoneKeywords)&&l.syntaxFlags.has(o.RelativeColorSyntax)?t(l)?r(l):a(l):void 0})))),f.cloneBefore({value:P}),s?.subFeatures.displayP3&&d!==P&&f.cloneBefore({value:d}),s?.preserve||f.remove()}});basePlugin.postcss=!0;const postcssPlugin=e=>{const o=Object.assign({enableProgressiveCustomProperties:!0,preserve:!1,subFeatures:{displayP3:!0}},e);return o.subFeatures=Object.assign({displayP3:!0},o.subFeatures),o.enableProgressiveCustomProperties&&(o.preserve||o.subFeatures.displayP3)?{postcssPlugin:"postcss-relative-color-syntax",plugins:[s(),basePlugin(o)]}:basePlugin(o)};postcssPlugin.postcss=!0;export{postcssPlugin as default};
