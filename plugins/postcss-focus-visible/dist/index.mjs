import e from"postcss-selector-parser";const s=":focus-visible",creator=o=>{const l=Object.assign({preserve:!0,replaceWith:".focus-visible",disablePolyfillReadyClass:!1},o),n=e().astSync(l.replaceWith);return{postcssPlugin:"postcss-focus-visible",Rule(o,{result:t}){if(!o.selector.toLowerCase().includes(s))return;const r=o.selectors.flatMap((r=>{if(!r.toLowerCase().includes(s))return[r];let a;try{a=e().astSync(r)}catch(e){return o.warn(t,`Failed to parse selector : "${r}" with message: "${e.message}"`),r}if(void 0===a)return[r];let i=!1;if(a.walkPseudos((e=>{e.value.toLowerCase()===s&&(e.nodes&&e.nodes.length||(i=!0,e.replaceWith(n.clone({}))))})),!i)return[r];const c=a.clone();if(!l.disablePolyfillReadyClass){var u,d,f,p,v;if(null!=(u=a.nodes)&&null!=(d=u[0])&&null!=(f=d.nodes)&&f.length)for(let s=0;s<a.nodes[0].nodes.length;s++){const o=a.nodes[0].nodes[s];if("combinator"===o.type||e.isPseudoElement(o)){a.nodes[0].insertBefore(o,e.className({value:"js-focus-visible"}));break}if(s===a.nodes[0].nodes.length-1){a.nodes[0].append(e.className({value:"js-focus-visible"}));break}}null!=(p=a.nodes)&&null!=(v=p[0])&&v.nodes&&(c.nodes[0].prepend(e.combinator({value:" "})),c.nodes[0].prepend(e.className({value:"js-focus-visible"})))}return[a.toString(),c.toString()]}));r.join(",")!==o.selectors.join(",")&&(o.cloneBefore({selectors:r}),l.preserve||o.remove())}}};creator.postcss=!0;export{creator as default};
