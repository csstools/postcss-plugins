"use strict";var e=require("@csstools/css-parser-algorithms"),s=require("@csstools/css-tokenizer");const t=/^apply$/i;function processableApplyRule(t){if(!t.params||!t.params.includes("--"))return!1;if(!isInStyleRule(t))return!1;if(t.nodes?.length)return!1;const n=e.parseComponentValue(s.tokenize({css:t.params}));return e.isTokenNode(n)&&s.isTokenIdent(n.value)?n.value[4].value:!!e.isFunctionNode(n)&&(!n.value.length&&n.getName())}const n=/^scope$/i;function isInStyleRule(e){const s=e.parent;return!(!s||"root"===s.type)&&("rule"===s.type||(!("atrule"!==s.type||!n.test(s.name))||isInStyleRule(s)))}const r=/^(?:apply|contents|result)$/i;function processableMixinRule(t){if("mixin"!==t.name.toLowerCase())return!1;if(!t.params||!t.params.includes("--"))return!1;if(!t.nodes?.length)return!1;if(t.parent!==t.root())return!1;const n=e.parseComponentValue(s.tokenize({css:t.params}));if(!e.isFunctionNode(n))return!1;if(n.value.length)return!1;let o=!1;return t.walk(e=>{"atrule"===e.type&&r.test(e.name)&&(o=!0)}),!o&&n.getName()}const creator=e=>{const s=Object.assign({preserve:!1},e);return{postcssPlugin:"postcss-mixins",prepare(){const e=new Map,n=new Set;return{postcssPlugin:"mixins",Once(r){r.each(s=>{if("atrule"!==s.type)return;const t=processableMixinRule(s);t&&(n.has(t)?e.delete(t):(e.set(t,s),n.add(t)))});for(const t of e.values())s.preserve||t.remove();r.walkAtRules(t,t=>{const n=processableApplyRule(t);if(!n)return;const r=e.get(n);r&&r.nodes&&(r.each(e=>{t.before(e.clone())}),s.preserve||t.remove())})}}}}};creator.postcss=!0,module.exports=creator;
