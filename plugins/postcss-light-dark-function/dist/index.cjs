"use strict";var e=require("@csstools/postcss-progressive-custom-properties"),o=require("@csstools/css-tokenizer"),r=require("@csstools/utilities"),n=require("@csstools/css-parser-algorithms");const s="--csstools-color-scheme--light",t="--csstools-color-scheme--dark",a="initial",i=" ",c=/dark/i,p=/light/i;function colorSchemes(e){const r=o.tokenize({css:e});let n=!1,s=!1;return r.forEach((e=>{e[0]===o.TokenType.Ident&&(p.test(e[4].value)?n=!0:c.test(e[4].value)&&(s=!0))})),[n,s]}const l=/^light-dark$/i;function isComma(e){return n.isTokenNode(e)&&e.value[0]===o.TokenType.Comma}function parseLightDark(e){if(!n.isFunctionNode(e)||!l.test(e.getName()))return!1;const o=e.value.filter((e=>!n.isWhitespaceNode(e)&&!n.isCommentNode(e)&&!n.isSimpleBlockNode(e)));if(3!==o.length)return!1;let r=o[0];const s=o[1];let t=o[2];if(!r||!s||!t)return!1;if(!isComma(s))return!1;if(isComma(r)||isComma(t))return!1;if(n.isFunctionNode(r)){const e=[r];n.walk(e,(({node:e,parent:o},r)=>{recurseLightDark(e,o,r,!0)})),[r]=e}if(n.isFunctionNode(t)){const e=[t];n.walk(e,(({node:e,parent:o},r)=>{recurseLightDark(e,o,r,!1)})),[t]=e}return[r,t]}function recurseLightDark(e,o,r,s){if("number"!=typeof r)return;const t=parseLightDark(e);if(!t)return;let a=t[s?0:1];if(n.isFunctionNode(a)){const e=[a];n.walk(e,(({node:e,parent:o},r)=>{recurseLightDark(e,o,r,s)})),[a]=e}o.value[r]=a}function transformLightDark(e){const r=n.replaceComponentValues(n.parseCommaSeparatedListOfComponentValues(o.tokenize({css:e})),(e=>{const r=parseLightDark(e);if(!r)return;const[a,i]=r;return[new n.FunctionNode([o.TokenType.Function,"var(",-1,-1,{value:"var"}],[o.TokenType.CloseParen,")",-1,-1,void 0],[new n.TokenNode([o.TokenType.Ident,s,-1,-1,{value:s}]),new n.TokenNode([o.TokenType.Comma,",",-1,-1,void 0]),new n.WhitespaceNode([[o.TokenType.Whitespace," ",-1,-1,void 0]]),a]),new n.WhitespaceNode([[o.TokenType.Whitespace," ",-1,-1,void 0]]),new n.FunctionNode([o.TokenType.Function,"var(",-1,-1,{value:"var"}],[o.TokenType.CloseParen,")",-1,-1,void 0],[new n.TokenNode([o.TokenType.Ident,t,-1,-1,{value:t}]),new n.TokenNode([o.TokenType.Comma,",",-1,-1,void 0]),new n.WhitespaceNode([[o.TokenType.Whitespace," ",-1,-1,void 0]]),i])]}));return n.stringify(r)}const u=/^color-scheme$/i,d=/\blight-dark\(/i,basePlugin=e=>({postcssPlugin:"postcss-light-dark-function",prepare(){let o,n=!1;return{Declaration(c,{atRule:p,rule:l}){const v=c.parent;if(v){if(u.test(c.prop)){const[e,o]=colorSchemes(c.value);if(e&&o){c.cloneBefore({prop:s,value:a}),c.cloneBefore({prop:t,value:i});const e=v.clone();e.removeAll(),e.append(c.clone({prop:s,value:i})),e.append(c.clone({prop:t,value:a}));const o=p({name:"media",params:"(prefers-color-scheme: dark)",source:v.source});return o.append(e),void v.after(o)}return o?(c.cloneBefore({prop:s,value:i}),void c.cloneBefore({prop:t,value:a})):e?(c.cloneBefore({prop:s,value:a}),void c.cloneBefore({prop:t,value:i})):void 0}if(d.test(c.value)){if(r.hasFallback(c))return;if(r.hasSupportsAtRuleAncestor(c,d))return;const s=transformLightDark(c.value);if(s===c.value)return;if(n=!0,o||(o=c.source),c.cloneBefore({value:s}),c.variable&&c.parent){const e=l({selector:"& *",source:c.source});e.append(c.clone({value:s})),c.parent.append(e)}e?.preserve||c.remove()}}},OnceExit(e,{atRule:r,rule:c,decl:p}){if(!n||!o)return;const l=p({prop:s,value:a}),u=p({prop:t,value:i});l.source=o,u.source=o;{const r=c({selector:":root",source:o});r.append(l,u),e.append(r)}{const n=c({selector:":root",source:o});n.append(l.clone({value:i}),u.clone({value:a}));const s=r({name:"media",params:"(prefers-color-scheme: dark)",source:o});s.append(n),e.append(s)}}}}});basePlugin.postcss=!0;const postcssPlugin=o=>{const r=Object.assign({enableProgressiveCustomProperties:!0,preserve:!0},o);return r.enableProgressiveCustomProperties&&r.preserve?{postcssPlugin:"postcss-light-dark-function",plugins:[e(),basePlugin(r)]}:basePlugin(r)};postcssPlugin.postcss=!0,module.exports=postcssPlugin;
