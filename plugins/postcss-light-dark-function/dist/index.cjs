"use strict";var e=require("@csstools/postcss-progressive-custom-properties"),o=require("@csstools/css-tokenizer"),r=require("@csstools/utilities"),s=require("@csstools/css-parser-algorithms");const n="--csstools-color-scheme--light",t="--csstools-color-scheme--dark",a="initial",i=" ",c=/dark/i,p=/light/i;function colorSchemes(e){const r=o.tokenize({css:e});let s=!1,n=!1;return r.forEach((e=>{e[0]===o.TokenType.Ident&&(p.test(e[4].value)?s=!0:c.test(e[4].value)&&(n=!0))})),[s,n]}const l=/^light-dark$/i;function isComma(e){return s.isTokenNode(e)&&e.value[0]===o.TokenType.Comma}function parseLightDark(e){if(!s.isFunctionNode(e)||!l.test(e.getName()))return!1;const o=e.value.filter((e=>!s.isWhitespaceNode(e)&&!s.isCommentNode(e)&&!s.isSimpleBlockNode(e)));if(3!==o.length)return!1;let r=o[0];const n=o[1];let t=o[2];if(!r||!n||!t)return!1;if(!isComma(n))return!1;if(isComma(r)||isComma(t))return!1;if(s.isFunctionNode(r)){const e=[r];s.walk(e,(({node:e,parent:o},r)=>{recurseLightDark(e,o,r,!0)})),[r]=e}if(s.isFunctionNode(t)){const e=[t];s.walk(e,(({node:e,parent:o},r)=>{recurseLightDark(e,o,r,!1)})),[t]=e}return[r,t]}function recurseLightDark(e,o,r,n){if("number"!=typeof r)return;const t=parseLightDark(e);if(!t)return;let a=t[n?0:1];if(s.isFunctionNode(a)){const e=[a];s.walk(e,(({node:e,parent:o},r)=>{recurseLightDark(e,o,r,n)})),[a]=e}o.value[r]=a}function transformLightDark(e){const r=s.replaceComponentValues(s.parseCommaSeparatedListOfComponentValues(o.tokenize({css:e})),(e=>{const r=parseLightDark(e);if(!r)return;const[a,i]=r;return[new s.FunctionNode([o.TokenType.Function,"var(",-1,-1,{value:"var"}],[o.TokenType.CloseParen,")",-1,-1,void 0],[new s.TokenNode([o.TokenType.Ident,n,-1,-1,{value:n}]),new s.TokenNode([o.TokenType.Comma,",",-1,-1,void 0]),new s.WhitespaceNode([[o.TokenType.Whitespace," ",-1,-1,void 0]]),a]),new s.WhitespaceNode([[o.TokenType.Whitespace," ",-1,-1,void 0]]),new s.FunctionNode([o.TokenType.Function,"var(",-1,-1,{value:"var"}],[o.TokenType.CloseParen,")",-1,-1,void 0],[new s.TokenNode([o.TokenType.Ident,t,-1,-1,{value:t}]),new s.TokenNode([o.TokenType.Comma,",",-1,-1,void 0]),new s.WhitespaceNode([[o.TokenType.Whitespace," ",-1,-1,void 0]]),i])]}));return s.stringify(r)}const u=/^color-scheme$/i,d=/\blight-dark\(/i,basePlugin=e=>({postcssPlugin:"postcss-light-dark-function",prepare(){let o,s=!1;return{postcssPlugin:"postcss-light-dark-function",Declaration(c,{atRule:p,rule:l}){const v=c.parent;if(v){if(u.test(c.prop)){const[e,o]=colorSchemes(c.value);if(e&&o){c.cloneBefore({prop:n,value:a}),c.cloneBefore({prop:t,value:i});const e=v.clone();e.removeAll(),e.append(c.clone({prop:n,value:i})),e.append(c.clone({prop:t,value:a}));const o=p({name:"media",params:"(prefers-color-scheme: dark)",source:v.source});return o.append(e),void v.after(o)}return o?(c.cloneBefore({prop:n,value:i}),void c.cloneBefore({prop:t,value:a})):e?(c.cloneBefore({prop:n,value:a}),void c.cloneBefore({prop:t,value:i})):void 0}if(d.test(c.value)){if(r.hasFallback(c))return;if(r.hasSupportsAtRuleAncestor(c,d))return;const n=transformLightDark(c.value);if(n===c.value)return;if(s=!0,o||(o=c.source),c.cloneBefore({value:n}),c.variable&&c.parent){const e=l({selector:"& *",source:c.source});e.append(c.clone({value:n})),c.parent.append(e)}e?.preserve||c.remove()}}},OnceExit(e,{atRule:r,rule:c,decl:p}){if(!s||!o)return;const l=p({prop:n,value:a}),u=p({prop:t,value:i});l.source=o,u.source=o;{const r=c({selector:":root",source:o});r.append(l,u),e.append(r)}{const s=c({selector:":root",source:o});s.append(l.clone({value:i}),u.clone({value:a}));const n=r({name:"media",params:"(prefers-color-scheme: dark)",source:o});n.append(s),e.append(n)}}}}});basePlugin.postcss=!0;const postcssPlugin=o=>{const r=Object.assign({enableProgressiveCustomProperties:!0,preserve:!0},o);return r.enableProgressiveCustomProperties&&r.preserve?{postcssPlugin:"postcss-light-dark-function",plugins:[e(),basePlugin(r)]}:basePlugin(r)};postcssPlugin.postcss=!0,module.exports=postcssPlugin;
