"use strict";var e=require("browserslist"),n=require("@csstools/css-tokenizer"),o=require("@csstools/css-parser-algorithms");function died(e){return"string"==typeof e}function matchBeforeDateCondition(e,n,o){const t=new Date;t.setUTCFullYear(e),t.setUTCMonth(n),t.setUTCDate(o);return(new Date).getTime()<t.getTime()||`Died because ${e}-${n}-${o} is in the past`}function matchBrowserslistCondition(n,o){const t=e(n);for(let e=0;e<t.length;e++){const n=t[e];if(o.has(n))return!0}return`Died because the browsers matching "${n}" do not have any overlap with your project browserslist`}function matchIfCondition(e){const o=e.a,t=e.b;if(o[0]===t[0]&&(o[0]!==n.TokenType.Dimension||t[0]!==n.TokenType.Dimension||o[4].unit.toLowerCase()===t[4].unit.toLowerCase())){switch(e.operator){case"<":if(o[4].value>=t[4].value)return`Died because A (${o[1]}) is no longer less than B (${t[1]})`;break;case">":if(o[4].value<=t[4].value)return`Died because A (${o[1]}) is no longer greater than B (${t[1]})`;break;case"=":if(o[4].value!==t[4].value)return`Died because A (${o[1]}) is no longer equal to B (${t[1]})`}return!0}}function matchNotCondition(e){const o=e.a,t=e.b;if(o[0]===t[0]&&(o[0]!==n.TokenType.Dimension||t[0]!==n.TokenType.Dimension||o[4].unit.toLowerCase()===t[4].unit.toLowerCase())){switch(e.operator){case"<":if(o[4].value<t[4].value)return`Died because A (${o[1]}) is less than B (${t[1]})`;break;case">":if(o[4].value>t[4].value)return`Died because A (${o[1]}) is greater than B (${t[1]})`;break;case"=":if(o[4].value===t[4].value)return`Died because A (${o[1]}) equals B (${t[1]})`}return!0}}function parseBeforeDateCondition(e){const t=e.value.filter((e=>!o.isWhitespaceNode(e)&&!o.isCommentNode(e)));if(t.length>3)return!1;const r=t[0],s=t[1],i=t[2];if(!r||!s||!i)return!1;if(!o.isTokenNode(r)||!o.isTokenNode(s)||!o.isTokenNode(i))return!1;const a=r.value,u=s.value,c=i.value;return a[0]===n.TokenType.Number&&a[4].type===n.NumberType.Integer&&(u[0]===n.TokenType.Number&&u[4].type===n.NumberType.Integer&&(c[0]===n.TokenType.Number&&c[4].type===n.NumberType.Integer&&{year:a[4].value,month:u[4].value,day:c[4].value}))}function parseBrowserslistCondition(e){const t=e.value.filter((e=>!o.isWhitespaceNode(e)&&!o.isCommentNode(e)));if(t.length>1)return!1;const r=t[0];if(!r)return!1;if(!o.isTokenNode(r))return!1;const s=r.value;return s[0]===n.TokenType.String&&s[4].value}const t=[n.TokenType.Ident,n.TokenType.Number,n.TokenType.Percentage,n.TokenType.Dimension],r=["<",">","="];function parseIfCondition(e){const s=e.value.filter((e=>!o.isWhitespaceNode(e)&&!o.isCommentNode(e)));if(s.length>3)return!1;const i=s[0],a=s[1],u=s[2];if(!i||!a||!u)return!1;if(!o.isTokenNode(i)||!o.isTokenNode(a)||!o.isTokenNode(u))return!1;const c=i.value,d=a.value,l=u.value;return d[0]===n.TokenType.Delim&&(!!r.includes(d[4].value)&&(!!t.includes(c[0])&&(!!t.includes(l[0])&&{a:c,b:l,operator:d[4].value})))}function parseNotCondition(e){const n=parseIfCondition(e);return!!n&&{a:n.a,b:n.b,operator:n.operator}}const creator=()=>{const t=new Set(e());return{postcssPlugin:"postcss-todo-or-die",async Once(e,{result:r}){const s=[];e.walkAtRules((e=>{if("todo-or-die"===e.name.toLowerCase()){if(!e.params.trim())throw e.error("Rule must have valid params");s.push(e)}}));for(const e of s){const errorHandler=n=>{throw e.error(n.message)},s=n.tokenizer({css:e.params},{onParseError:errorHandler}),i=[];for(;!s.endOfFile();)i.push(s.nextToken());i.push(s.nextToken());const a=o.parseCommaSeparatedListOfComponentValues(i,{onParseError:errorHandler});if(!a.length)return void e.warn(r,"Rule must have some valid params.");for(let n=0;n<a.length;n++){const s=a[n].filter((e=>!o.isWhitespaceNode(e)&&!o.isCommentNode(e)));if(1!==s.length)return void e.warn(r,"Conditions must be split by commas when adding multiple in a list.");if(!o.isFunctionNode(s[0]))return void e.warn(r,"Conditions must be one of the supported functions.");switch(s[0].name[4].value.toLowerCase()){case"if":{const n=parseIfCondition(s[0]);if(!n)return void e.warn(r,"Incorrect arguments in `if()` function.");const o=matchIfCondition(n);if(died(o))throw e.error(o);break}case"not":{const n=parseNotCondition(s[0]);if(!n)return void e.warn(r,"Incorrect arguments in `not()` function.");const o=matchNotCondition(n);if(died(o))throw e.error(o);break}case"browserslist":{const n=parseBrowserslistCondition(s[0]);if(!n)return void e.warn(r,"Incorrect arguments in `browserslist()` function.");const o=matchBrowserslistCondition(n,t);if(died(o))throw e.error(o);break}case"before-date":{const n=parseBeforeDateCondition(s[0]);if(!n)return void e.warn(r,"Incorrect arguments in `before-date()` function.");const o=matchBeforeDateCondition(n.year,n.month,n.day);if(died(o))throw e.error(o);break}}}e.nodes&&e.nodes.length?e.replaceWith(e.nodes):e.remove()}}}};creator.postcss=!0,module.exports=creator;
