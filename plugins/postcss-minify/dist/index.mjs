import{tokenize as e,TokenType as r,stringify as t}from"@csstools/css-tokenizer";const s=/(?:license|copyright)/i,o=/sourceMappingURL/i,n=/(?:[\s]|\/\*)/;function minify(s,o){if(!o)return o;if(s.has(o))return s.get(o);if(!n.test(o))return s.set(o,o),o;if(""===o.trim())return s.set(o," ")," ";const a=e({css:o});for(let e=0;e<a.length;e++){const t=a[e];if(t[0]===r.Comment||t[0]===r.Whitespace){t[1]=" ";let s=a[e+1];for(;s&&(s[0]===r.Comment||s[0]===r.Whitespace);)s[1]="",e++,s=a[e+1]}}const i=t(...a);return s.set(o,i),i}function removeEmptyNodes(e){var r;if("rule"===e.type){if(0===(null==(r=e.nodes)?void 0:r.length)){var t;const r=e.parent;return e.remove(),0===(null==r||null==(t=r.nodes)?void 0:t.length)&&removeEmptyNodes(r),!0}}else if("atrule"===e.type){var s;if(0===(null==(s=e.nodes)?void 0:s.length)&&"layer"!==e.name.toLowerCase()){var o;const r=e.parent;return e.remove(),0===(null==r||null==(o=r.nodes)?void 0:o.length)&&removeEmptyNodes(r),!0}}return!1}const creator=()=>({postcssPlugin:"postcss-minify",prepare(){const e=new Map;return{OnceExit(r){r.raws={before:"",after:"\n"},r.walk((r=>{if("comment"!==r.type)if("decl"===r.type&&r.variable)r.raws.before="";else if("atrule"!==r.type)if("rule"!==r.type){if("decl"===r.type){if(r.variable)return void(r.raws.before="");r.raws.before="",r.raws.between=":",r.raws.important=r.important?"!important":"",r.raws.semicolons=!1,r.raws.value=void 0,r.value=minify(e,r.value)}}else{if(removeEmptyNodes(r))return;if(r.raws.after="",r.raws.before="",r.raws.between="",r.raws.selector=void 0,r.raws.semicolon){const e=r.last;"decl"===(null==e?void 0:e.type)&&e.variable||(r.raws.semicolon=!1)}r.selector=minify(e,r.selector)}else{if(removeEmptyNodes(r))return;if(r.raws.after="",r.raws.afterName=" ",r.raws.before="",r.raws.between="",r.raws.params=void 0,r.raws.semicolon){const e=r.last;"decl"===(null==e?void 0:e.type)&&e.variable||(r.raws.semicolon=!1)}r.params=minify(e,r.params)}else{if(s.test(r.text)||o.test(r.text))return;r.remove()}}))}}}});creator.postcss=!0;export{creator as default};
