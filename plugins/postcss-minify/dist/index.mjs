import{tokenize as e,TokenType as t,stringify as r}from"@csstools/css-tokenizer";const s=/(?:license|copyright)/i,o=/sourceMappingURL/i,n=/(?:[\s]|\/\*)/;function minify(s,o){if(!o)return o;if(s.has(o))return s.get(o);if(!n.test(o))return s.set(o,o),o;if(""===o.trim())return s.set(o," ")," ";const i=e({css:o});for(let e=0;e<i.length;e++){const r=i[e];if(r[0]===t.Comment||r[0]===t.Whitespace){r[1]=" ";let s=i[e+1];for(;s&&(s[0]===t.Comment||s[0]===t.Whitespace);)s[1]="",e++,s=i[e+1]}}const a=r(...i);return s.set(o,a),a}function removeEmptyNodes(e){var t;if("rule"===e.type){if(0===(null==(t=e.nodes)?void 0:t.length)){var r;const t=e.parent;return e.remove(),0===(null==t||null==(r=t.nodes)?void 0:r.length)&&removeEmptyNodes(t),!0}}else if("atrule"===e.type){var s;if(0===(null==(s=e.nodes)?void 0:s.length)&&"layer"!==e.name.toLowerCase()){var o;const t=e.parent;return e.remove(),0===(null==t||null==(o=t.nodes)?void 0:o.length)&&removeEmptyNodes(t),!0}}return!1}function setSemicolon(e){if(e.raws.semicolon){const t=e.last;"decl"===(null==t?void 0:t.type)&&t.variable||(e.raws.semicolon=!1)}}const creator=()=>({postcssPlugin:"postcss-minify",prepare(){const e=new Map;return{OnceExit(t){t.raws={before:"",after:"\n"},t.walk((t=>{if("comment"!==t.type)if("decl"===t.type&&t.variable)t.raws.before="";else{if("atrule"===t.type){if(removeEmptyNodes(t))return;return t.raws.after="",t.raws.afterName=" ",t.raws.before="",t.raws.between="",t.raws.params=void 0,setSemicolon(t),void(t.params=minify(e,t.params))}if("rule"===t.type){if(removeEmptyNodes(t))return;return t.raws.after="",t.raws.before="",t.raws.between="",t.raws.selector=void 0,setSemicolon(t),void(t.selector=minify(e,t.selector))}if("decl"===t.type){if(t.variable)return void(t.raws.before="");t.raws.before="",t.raws.between=":",t.raws.important=t.important?"!important":"",t.raws.value=void 0,t.value=minify(e,t.value)}}else{if(s.test(t.text)||o.test(t.text))return;t.remove()}}))}}}});creator.postcss=!0;export{creator as default};
