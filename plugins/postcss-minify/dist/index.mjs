import{tokenize as e,TokenType as r,stringify as t}from"@csstools/css-tokenizer";const s=/(?:license|copyright)/i,o=/sourceMappingURL/i,n=/(?:[\s]|\/\*)/,a=new Map;function minify(s){if(!s)return s;if(a.has(s))return a.get(s);if(!n.test(s))return a.set(s,s),s;if(""===s.trim())return a.set(s," ")," ";const o=e({css:s});for(let e=0;e<o.length;e++){const t=o[e];if(t[0]===r.Comment||t[0]===r.Whitespace){t[1]=" ";let s=o[e+1];for(;s&&(s[0]===r.Comment||s[0]===r.Whitespace);)s[1]="",e++,s=o[e+1]}}const i=t(...o);return a.set(s,i),i}function removeEmptyNodes(e){var r;if("rule"===e.type){if(0===(null==(r=e.nodes)?void 0:r.length)){var t;const r=e.parent;return e.remove(),0===(null==r||null==(t=r.nodes)?void 0:t.length)&&removeEmptyNodes(r),!0}}else if("atrule"===e.type){var s;if(0===(null==(s=e.nodes)?void 0:s.length)&&"layer"!==e.name.toLowerCase()){var o;const r=e.parent;return e.remove(),0===(null==r||null==(o=r.nodes)?void 0:o.length)&&removeEmptyNodes(r),!0}}return!1}const creator=()=>({postcssPlugin:"postcss-minify",OnceExit(e){e.raws={before:"",after:"\n"},e.walk((e=>{if("comment"!==e.type)if("decl"===e.type&&e.variable)e.raws.before="";else if("atrule"!==e.type)if("rule"!==e.type){if("decl"===e.type){if(e.variable)return void(e.raws.before="");e.raws.before="",e.raws.between=":",e.raws.important=e.important?"!important":"",e.raws.semicolons=!1,e.raws.value=void 0,e.value=minify(e.value)}}else{if(removeEmptyNodes(e))return;if(e.raws.after="",e.raws.before="",e.raws.between="",e.raws.selector=void 0,e.raws.semicolon){const r=e.last;"decl"===(null==r?void 0:r.type)&&r.variable||(e.raws.semicolon=!1)}e.selector=minify(e.selector)}else{if(removeEmptyNodes(e))return;if(e.raws.after="",e.raws.afterName=" ",e.raws.before="",e.raws.between="",e.raws.params=void 0,e.raws.semicolon){const r=e.last;"decl"===(null==r?void 0:r.type)&&r.variable||(e.raws.semicolon=!1)}e.params=minify(e.params)}else{if(s.test(e.text)||o.test(e.text))return;e.remove()}}))}});creator.postcss=!0;export{creator as default};
