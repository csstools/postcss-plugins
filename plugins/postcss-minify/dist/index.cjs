"use strict";var e=require("@csstools/css-tokenizer");const r=/(?:license|copyright)/i,t=/sourceMappingURL/i,s=/(?:[\s]|\/\*)/,o=new Map;function minify(r){if(!r)return r;if(o.has(r))return o.get(r);if(!s.test(r))return o.set(r,r),r;if(""===r.trim())return o.set(r," ")," ";const t=e.tokenize({css:r});for(let r=0;r<t.length;r++){const s=t[r];if(s[0]===e.TokenType.Comment||s[0]===e.TokenType.Whitespace){s[1]=" ";let o=t[r+1];for(;o&&(o[0]===e.TokenType.Comment||o[0]===e.TokenType.Whitespace);)o[1]="",r++,o=t[r+1]}}const n=e.stringify(...t);return o.set(r,n),n}function removeEmptyNodes(e){var r;if("rule"===e.type){if(0===(null==(r=e.nodes)?void 0:r.length)){var t;const r=e.parent;return e.remove(),0===(null==r||null==(t=r.nodes)?void 0:t.length)&&removeEmptyNodes(r),!0}}else if("atrule"===e.type){var s;if(0===(null==(s=e.nodes)?void 0:s.length)&&"layer"!==e.name.toLowerCase()){var o;const r=e.parent;return e.remove(),0===(null==r||null==(o=r.nodes)?void 0:o.length)&&removeEmptyNodes(r),!0}}return!1}const creator=()=>({postcssPlugin:"postcss-minify",OnceExit(e){e.raws={before:"",after:"\n"},e.walk((e=>{if("comment"!==e.type)if("decl"===e.type&&e.variable)e.raws.before="";else if("atrule"!==e.type)if("rule"!==e.type){if("decl"===e.type){if(e.variable)return void(e.raws.before="");e.raws.before="",e.raws.between=":",e.raws.important=e.important?"!important":"",e.raws.semicolons=!1,e.raws.value=void 0,e.value=minify(e.value)}}else{if(removeEmptyNodes(e))return;if(e.raws.after="",e.raws.before="",e.raws.between="",e.raws.selector=void 0,e.raws.semicolon){const r=e.last;"decl"===(null==r?void 0:r.type)&&r.variable||(e.raws.semicolon=!1)}e.selector=minify(e.selector)}else{if(removeEmptyNodes(e))return;if(e.raws.after="",e.raws.afterName=" ",e.raws.before="",e.raws.between="",e.raws.params=void 0,e.raws.semicolon){const r=e.last;"decl"===(null==r?void 0:r.type)&&r.variable||(e.raws.semicolon=!1)}e.params=minify(e.params)}else{if(r.test(e.text)||t.test(e.text))return;e.remove()}}))}});creator.postcss=!0,module.exports=creator;
