"use strict";var e=require("@csstools/css-tokenizer");const r=/(?:license|copyright)/i,t=/sourceMappingURL/i,s=/(?:[\s]|\/\*)/;function minify(r,t){if(!t)return t;if(r.has(t))return r.get(t);if(!s.test(t))return r.set(t,t),t;if(""===t.trim())return r.set(t," ")," ";const o=e.tokenize({css:t});for(let r=0;r<o.length;r++){const t=o[r];if(t[0]===e.TokenType.Comment||t[0]===e.TokenType.Whitespace){t[1]=" ";let s=o[r+1];for(;s&&(s[0]===e.TokenType.Comment||s[0]===e.TokenType.Whitespace);)s[1]="",r++,s=o[r+1]}}const n=e.stringify(...o);return r.set(t,n),n}function removeEmptyNodes(e){var r;if("rule"===e.type){if(0===(null==(r=e.nodes)?void 0:r.length)){var t;const r=e.parent;return e.remove(),0===(null==r||null==(t=r.nodes)?void 0:t.length)&&removeEmptyNodes(r),!0}}else if("atrule"===e.type){var s;if(0===(null==(s=e.nodes)?void 0:s.length)&&"layer"!==e.name.toLowerCase()){var o;const r=e.parent;return e.remove(),0===(null==r||null==(o=r.nodes)?void 0:o.length)&&removeEmptyNodes(r),!0}}return!1}const creator=()=>({postcssPlugin:"postcss-minify",prepare(){const e=new Map;return{OnceExit(s){s.raws={before:"",after:"\n"},s.walk((s=>{if("comment"!==s.type)if("decl"===s.type&&s.variable)s.raws.before="";else if("atrule"!==s.type)if("rule"!==s.type){if("decl"===s.type){if(s.variable)return void(s.raws.before="");s.raws.before="",s.raws.between=":",s.raws.important=s.important?"!important":"",s.raws.semicolons=!1,s.raws.value=void 0,s.value=minify(e,s.value)}}else{if(removeEmptyNodes(s))return;if(s.raws.after="",s.raws.before="",s.raws.between="",s.raws.selector=void 0,s.raws.semicolon){const e=s.last;"decl"===(null==e?void 0:e.type)&&e.variable||(s.raws.semicolon=!1)}s.selector=minify(e,s.selector)}else{if(removeEmptyNodes(s))return;if(s.raws.after="",s.raws.afterName=" ",s.raws.before="",s.raws.between="",s.raws.params=void 0,s.raws.semicolon){const e=s.last;"decl"===(null==e?void 0:e.type)&&e.variable||(s.raws.semicolon=!1)}s.params=minify(e,s.params)}else{if(r.test(s.text)||t.test(s.text))return;s.remove()}}))}}}});creator.postcss=!0,module.exports=creator;
