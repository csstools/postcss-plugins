"use strict";var e=require("@csstools/css-tokenizer"),r=require("@csstools/css-parser-algorithms");function serializeString(e){let r="";for(const t of e){const e=t.codePointAt(0);if(void 0!==e)switch(e){case 0:r+=String.fromCodePoint(65533);break;case 127:r+=`\\${e.toString(16)}`;break;case 34:case 39:case 92:r+=`\\${t}`;break;default:if(1<=e&&e<=31){r+=`\\${e.toString(16)} `;break}r+=t}else r+=String.fromCodePoint(65533)}return r}const t=/rewrite-url\(/i,o=/^rewrite-url$/i,creator=e=>{const r=e?.rewriter??(e=>e);return{postcssPlugin:"postcss-rewrite-url",Declaration(e,{result:o}){if(!t.test(e.value))return;const s={type:"declaration-value",rootFrom:o.opts.from,from:e.source?.input.from,property:e.prop},a=rewrite(r,e.value,s);a!==e.value&&(e.value=a)},AtRule(e,{result:o}){if(!t.test(e.params))return;const s={type:"at-rule-prelude",rootFrom:o.opts.from,from:e.source?.input.from,atRuleName:e.name},a=rewrite(r,e.params,s);a!==e.params&&(e.params=a)}}};function rewrite(t,s,a){const i=r.parseCommaSeparatedListOfComponentValues(e.tokenize({css:s})),n=r.replaceComponentValues(i,(s=>{if(r.isFunctionNode(s)&&o.test(s.getName()))for(const o of s.value)if(!r.isWhitespaceNode(o)&&!r.isCommentNode(o)&&r.isTokenNode(o)&&o.value[0]===e.TokenType.String){const e=o.value[4].value.trim(),r=t({url:e},a);if(!1===r)return;if(r.url===e)break;return o.value[4].value=r.url,o.value[1]=`"${serializeString(r.url)}"`,s.name[1]="url(",s.name[4].value="url",s}}));return r.stringify(n)}creator.postcss=!0,module.exports=creator;
