import e from"path";import r from"fs";function parseImport(s,t,a,o){var n,l;let p="";if(a.startsWith("node_modules://"))try{p=require.resolve(a.slice(15),{paths:[e.dirname(a)]})}catch(e){throw new Error(`Failed to read ${a} with error ${e.message}`)}else p=e.resolve(a);if(o.has(p))return!1;o.add(p),t.result.messages.push({type:"dependency",plugin:"postcss-global-data",file:p,parent:null==(n=s.source)||null==(l=n.input)?void 0:l.file});const i=r.readFileSync(p,"utf8");return t.postcss.parse(i,{from:p})}const creator=e=>{const r=Object.assign({files:[]},e);return{postcssPlugin:"postcss-global-data",prepare(){let e=new Set,s=new Set;return{Once:(t,a)=>{r.files.forEach((r=>{if(e.has(r))return;const o=parseImport(t,a,r,e);o&&o.each((e=>{t.append(e),s.add(e)}))}))},OnceExit:()=>{s.forEach((e=>{e.remove()})),s=new Set,e=new Set}}}}};creator.postcss=!0;export{creator as default};
