import e from"path";import r from"fs";function parseImport(t,s,o){let a="";if(s.startsWith("node_modules://"))try{a=require.resolve(s.slice(15),{paths:[e.dirname(s)]})}catch(e){throw new Error(`Failed to read ${s} with error ${e.message}`)}else a=e.resolve(s);if(o.has(a))return!1;o.add(a);const n=r.readFileSync(a,"utf8");return t.parse(n,{from:s})}const creator=e=>{const r=Object.assign({files:[]},e);return{postcssPlugin:"postcss-global-data",prepare(){let e=new Set,t=new Set;return{Once:(s,{postcss:o})=>{r.files.forEach((r=>{if(e.has(r))return;const a=parseImport(o,r,e);a&&a.each((e=>{s.append(e),t.add(e)}))}))},OnceExit:()=>{t.forEach((e=>{e.remove()})),t=new Set,e=new Set}}}}};creator.postcss=!0;export{creator as default};
