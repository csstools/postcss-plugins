import e from"path";import r from"fs";function parseImport(s,t,a,o){var n;let l="";if(a.startsWith("node_modules://"))try{l=require.resolve(a.slice(15),{paths:[e.dirname(a)]})}catch(e){throw new Error(`Failed to read ${a} with error ${e.message}`)}else l=e.resolve(a);if(o.has(l))return!1;o.add(l),t.result.messages.push({type:"dependency",plugin:"postcss-global-data",file:l,parent:null==(n=s.source)||null==(n=n.input)?void 0:n.file});const p=r.readFileSync(l,"utf8");return t.postcss.parse(p,{from:l})}const creator=e=>{const r=Object.assign({files:[]},e);return{postcssPlugin:"postcss-global-data",prepare(){let e=new Set,s=new Set;return{Once:(t,a)=>{r.files.forEach((r=>{if(e.has(r))return;const o=parseImport(t,a,r,e);o&&o.each((e=>{t.append(e),s.add(e)}))}))},OnceExit:()=>{s.forEach((e=>{e.remove()})),s=new Set,e=new Set}}}}};creator.postcss=!0;export{creator as default};
